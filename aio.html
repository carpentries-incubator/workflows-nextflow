<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Introduction to Bioinformatics workflows with Nextflow and nf-core: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team." style="background-color: #001483; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link" style="color: #FFF7F1">
            <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
            Beta
          </a>
          <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Introduction to Bioinformatics workflows with Nextflow and nf-core
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Introduction to Bioinformatics workflows with Nextflow and nf-core
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">Groovy syntax</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to Bioinformatics workflows with Nextflow and nf-core
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-getting-started-with-nextflow.html">1. Getting Started with Nextflow</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-workflow_parameters.html">2. Workflow parameterisation</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-channels.html">3. Channels</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-processes-part1.html">4. Processes</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-processes-part2.html">5. Processes Part 2</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-workflow.html">6. Workflow</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-operators.html">7. Operators</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-reporting.html">8. Reporting</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-configuration.html">9. Nextflow configuration</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="10-workflow_checkpoint_caching.html">10. Workflow caching and checkpointing</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="11-Simple_Rna-Seq_pipeline.html">11. Simple RNA-Seq pipeline</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="12-nfcore.html">12. Deploying nf-core pipelines</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="discuss.html">Discussion</a></li>
<li><a href="reference.html">Groovy syntax</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-getting-started-with-nextflow"><p>Content from <a href="01-getting-started-with-nextflow.html">Getting Started with Nextflow</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/01-getting-started-with-nextflow.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a workflow and what are workflow management systems?</li>
<li>Why should I use a workflow management system?</li>
<li>What is Nextflow?</li>
<li>What are the main features of Nextflow?</li>
<li>What are the main components of a Nextflow script?</li>
<li>How do I run a Nextflow script?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand what a workflow management system is.</li>
<li>Understand the benefits of using a workflow management system.</li>
<li>Explain the benefits of using Nextflow as part of your
bioinformatics workflow.</li>
<li>Explain the components of a Nextflow script.</li>
<li>Run a Nextflow script.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="workflows"><h2 class="section-heading">Workflows<a class="anchor" aria-label="anchor" href="#workflows"></a>
</h2>
<hr class="half-width">
<p>Analysing data involves a sequence of tasks, including gathering,
cleaning, and processing data. This sequence of tasks is called a
workflow or a pipeline. These workflows typically require executing
multiple software packages, sometimes running on different computing
environments, such as a desktop or a compute cluster. Traditionally
these workflows have been joined together in scripts using general
purpose programming languages such as Bash or Python.</p>
<br><center>
<img src="https://sateeshperi.github.io/nextflow_varcal/nextflow/images/analysis_workflow.PNG" width="200" alt="Flowchart illustrating a simple bioinformatics RNA-Seq pipeline for transcript expression quantification. The process begins with inputs at the top: 'Fastq' files, a 'Reference sequence', and 'Grch38 Ensembl 91' annotations. The first step is 'quality control', using 'fastQC' software version 0.11.9. The second step is 'index creation' with 'Salmon' software version 1.3.0 using the '-i' option. The third step is 'quantification', again with 'Salmon' version 1.3.0, this time using the '-l A' option. There are two outputs from this process: 'Output 1' is a 'QC report' and 'Output 2' is 'Transcript expression' data." class="figure"><br><em> An example of a simple bioinformatics RNA-Seq pipeline. </em>
</center>
<p><br></p>
<p>However, as workflows become larger and more complex, the management
of the programming logic and software becomes difficult.</p>
</section><section id="workflow-management-systems"><h2 class="section-heading">Workflow management systems<a class="anchor" aria-label="anchor" href="#workflow-management-systems"></a>
</h2>
<hr class="half-width">
<p><em>Workflow Management Systems</em> (WfMS) such as <a href="https://snakemake.readthedocs.io/en/stable/" class="external-link">Snakemake</a>, <a href="https://usegalaxy.org/" class="external-link">Galaxy</a>, and <a href="nextflow.io">Nextflow</a> have been developed specifically to
manage computational data-analysis workflows in fields such as
bioinformatics, imaging, physics, and chemistry. These systems contain
multiple features that simplify the development, monitoring, execution
and sharing of pipelines, such as:</p>
<ul>
<li>Run time management</li>
<li>Software management</li>
<li>Portability &amp; Interoperability</li>
<li>Reproducibility</li>
<li>Re-entrancy</li>
</ul>
<br><center>
<img src="https://media.springernature.com/full/springer-static/image/art%3A10.1038%2Fs41592-021-01254-9/MediaObjects/41592_2021_1254_Fig1_HTML.png?as=webp" alt="A comparison of three bioinformatics pipeline diagrams. Panel A shows an 'Analysis workflow' for transcript expression quantification with three main steps: 1) quality control using fastQC v0.11.9, 2) index creation with Salmon v.1.3.0, and 3) quantification also using Salmon v.1.3.0. Inputs include Fastq files, a Reference sequence, and Grch38 Ensembl 91, leading to outputs of a QC report and transcript expression data. Panel B illustrates a 'Traditional pipeline' emphasizing platform-specific requirements and local execution with steps leading to two outputs. Panel C depicts a 'Workflow manager', highlighting platform-independent requirements, portability, local and cloud execution options, scalability, and containerized steps for automatic resource management, leading to an output and an execution report. The color-coding indicates input data (gray), output data (yellow), and software, versions, parameters (green and blue)" width="600" class="figure"><br><em> An example of differences between running a specific analysis
workflow using a traditional pipeline or a WfMS-based pipeline. Source:
Wratten, L., Wilm, A. &amp; Göke, J. Reproducible, scalable, and
shareable analysis pipelines with bioinformatics workflow managers. Nat
Methods 18, 1161–1168 (2021). <a href="https://doi.org/10.1038/s41592-021-01254-9" class="external-link uri">https://doi.org/10.1038/s41592-021-01254-9</a> </em>
</center>
<p><br></p>
</section><section id="nextflow-core-features"><h2 class="section-heading">Nextflow core features<a class="anchor" aria-label="anchor" href="#nextflow-core-features"></a>
</h2>
<hr class="half-width">
<br><center>
<img src="fig/execution_abstraction.png" alt="Infographic illustrating the components and supported platforms of a nextflow pipeline. The top section 'nextflow pipeline' is divided into three: writing code in any language (represented by R, Python, and Bash icons), orchestrating tasks with dataflow programming (represented by papers marked 'Data Flow' and 'Programming Model'), and defining software dependencies via containers (represented by Conda, Docker, and Singularity icons) and built-in version control with Git (represented by Git, GitHub, GitLab, and Bitbucket icons). Below, in the 'nextflow runtime' section, is 'Task orchestration and execution'. Arrows point downwards to the 'Supported Platforms' section, showcasing various platforms such as AWS, Google Cloud, Azure, Grid Engine, Slurm, HTCondor, Platform Computing, Kubernetes, and PBS Works." width="600" class="figure"><br><em> Overview of Nextflow core features. </em>
</center>
<p><br></p>
<ul>
<li><p><strong>Fast prototyping</strong>: A simple syntax for writing
pipelines that enables you to reuse existing scripts and tools for fast
prototyping.</p></li>
<li><p><strong>Reproducibility</strong>: Nextflow supports several
container technologies, such as <a href="https://www.docker.com/" class="external-link">Docker</a> and <a href="https://sylabs.io/singularity" class="external-link">Singularity</a>, as well as the
package manager <a href="https://docs.conda.io" class="external-link">Conda</a>. This, along
with the integration of the <a href="https://www.github.com" class="external-link">GitHub</a>
code sharing platform, allows you to write self-contained pipelines,
manage versions and to reproduce any previous result when re-run,
including on different computing platforms.</p></li>
<li><p><strong>Portability &amp; interoperability</strong>: Nextflow’s
syntax separates the functional logic (the steps of the workflow) from
the execution settings (how the workflow is executed). This allows the
pipeline to be run on multiple platforms, e.g. local compute vs. a
university compute cluster or a cloud service like <a href="https://aws.amazon.com/" class="external-link">AWS</a>, without changing the steps of
the workflow.</p></li>
<li><p><strong>Simple parallelism</strong>: Nextflow is based on the
dataflow programming model which greatly simplifies the splitting of
tasks that can be run at the same time (parallelisation).</p></li>
<li><p><strong>Continuous checkpoints &amp; re-entrancy</strong>: All
the intermediate results produced during the pipeline execution are
automatically tracked. This allows you to resume its execution from the
last successfully executed step, no matter what the reason was for it
stopping.</p></li>
</ul></section><section id="processes-channels-and-workflows"><h2 class="section-heading">Processes, channels, and workflows<a class="anchor" aria-label="anchor" href="#processes-channels-and-workflows"></a>
</h2>
<hr class="half-width">
<p>Nextflow workflows have three main parts: <em>processes</em>,
<em>channels</em>, and <em>workflows</em>.</p>
<ul>
<li><p><em>Processes</em> describe a task to be run. A process script
can be written in any scripting language that can be executed by the
Linux platform (Bash, Perl, Ruby, Python, R, etc.). Processes spawn a
task for each complete input set. Each task is executed independently
and cannot interact with other tasks. The only way data can be passed
between process tasks is via asynchronous queues, called
<em>channels</em>.</p></li>
<li><p>Processes define inputs and outputs for a task. <em>Channels</em>
are then used to manipulate the flow of data from one process to the
next.</p></li>
<li><p>The interaction between processes, and ultimately the pipeline
execution flow itself, is then explicitly defined in a <em>workflow</em>
section.</p></li>
</ul>
<p>In the following example we have a channel containing three elements,
e.g., three data files. We have a process that takes the channel as
input. Since the channel has three elements, three independent instances
(tasks) of that process are run in parallel. Each task generates an
output, which is passed to another channel and used as input for the
next process.</p>
<p align="center">
<img src="fig/channel-process_fqc.png" alt="Diagram depicting part of a bioinformatics data processing workflow. On the left, there is a 'channel' labeled 'samples' containing three items: Fastq1, Fastq2, and Fastq3. This channel flows into a 'process' called 'fastqc' represented by a rounded rectangle containing the command 'fastqc -o out ${reads}'. The output of this process goes into a channel named 'out_ch', which lists 'outdir' three times as its contents. This channel then flows into a channel operator 'collect' and then into  another 'process' called 'multiqc', indicated by a rounded rectangle with the command 'multiqc -o mqc_res .'. The output of 'multiqc' goes into a channel called 'mqc_ch', which also lists 'outdir' one time." width="700" class="figure"><br><em> Nextflow process flow diagram. </em>
</p>
</section><section id="workflow-execution"><h2 class="section-heading">Workflow execution<a class="anchor" aria-label="anchor" href="#workflow-execution"></a>
</h2>
<hr class="half-width">
<p>While a <code>process</code> defines what command or script has to be
executed, the <code>executor</code> determines how that script is
actually run in the target system.</p>
<p>If not otherwise specified, processes are executed on the local
computer. The local executor is very useful for pipeline development,
testing, and small-scale workflows, but for large-scale computational
pipelines, a High Performance Cluster (HPC) or Cloud platform is often
required.</p>
<p align="center">
<img src="fig/executor.png" alt="Diagram of a computational process within a bioinformatics workflow. The image features a large, central, rounded rectangle labeled 'process' with a smaller rectangle inside it labeled 'script', indicating the code or commands that are being executed. Above the script box, there is a smaller inset labeled 'Executors' with three icons: a desktop computer labeled 'Local', a stack of servers labeled 'High Performance Compute Cluster', and a cloud symbol labeled 'Cloud Compute'. These represent the different computing environments where the script can be executed. To the left of the process box is a green left-pointing arrowhead, suggesting input into the process, and to the right is a yellow right-pointing arrowhead, indicating the direction of output from the process." width="350" class="figure"><br><em>Nextflow Executors</em>
</p>
<p>Nextflow provides a separation between the pipeline’s functional
logic and the underlying execution platform. This makes it possible to
write a pipeline once, and then run it on your computer, compute
cluster, or the cloud, without modifying the workflow, by defining the
target execution platform in a configuration file.</p>
<p>Nextflow provides out-of-the-box support for major batch schedulers
and cloud platforms such as Sun Grid Engine, SLURM job scheduler, AWS
Batch service and Kubernetes; a full list can be found <a href="https://www.nextflow.io/docs/latest/executor.html" class="external-link">here</a>.</p>
</section><section id="your-first-script"><h2 class="section-heading">Your first script<a class="anchor" aria-label="anchor" href="#your-first-script"></a>
</h2>
<hr class="half-width">
<p>We are now going to look at a sample Nextflow script that counts the
number of lines in a file. Create the file <code>word_count.nf</code> in
the current directory using your favourite text editor and copy-paste
the following code:</p>

<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>#<span class="op">!</span><span class="st">/usr/</span>bin<span class="op">/</span>env nextflow</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">========================================================================================</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">    Workflow parameters are written as params.&lt;parameter&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">    and can be initialised using the `=` operator.</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">========================================================================================</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>params<span class="op">.</span>input <span class="op">=</span> <span class="st">"data/yeast/reads/ref1_1.fq.gz"</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">========================================================================================</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">    Input data is received through channels</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">========================================================================================</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>input_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span>params<span class="op">.</span>input<span class="op">)</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="st">/*</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="st">========================================================================================</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="st">   Main Workflow</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="st">========================================================================================</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="st">*/</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>    <span class="co">//  The script to execute is called by it's process name, and input is provided between brackets.</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>    <span class="fu">NUM_LINES</span><span class="op">(</span>input_ch<span class="op">)</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>    <span class="st">/*  Process output is accessed using the `out` channel.</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="st">        The channel operator view() is used to print process output to the terminal. */</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>    NUM_LINES<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="st">/*</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="st">========================================================================================</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="st">    A Nextflow process block. Process names are written, by convention, in uppercase.</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="st">    This convention is used to enhance workflow readability.</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="st">========================================================================================</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="st">*/</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a>process NUM_LINES <span class="op">{</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a>    path read</span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a>    stdout</span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a><span class="st">    # Print file name</span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a><span class="st">    printf '</span><span class="ss">${</span>read<span class="ss">}</span><span class="sc">\\</span><span class="st">t'</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a><span class="st">    # Unzip file and count number of lines</span></span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a><span class="st">    gunzip -c </span><span class="ss">${</span>read<span class="ss">}</span><span class="st"> | wc -l</span></span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>This is a Nextflow script, which contains the following:</p>
<ol style="list-style-type: decimal">
<li>An optional interpreter directive (“Shebang”) line, specifying the
location of the Nextflow interpreter.</li>
<li>
<code>nextflow.enable.dsl=2</code> to enable DSL2 syntax.</li>
<li>A multi-line Nextflow comment, written using C style block comments,
there are more comments later in the file.</li>
<li>A pipeline parameter <code>params.input</code> which is given a
default value, of the relative path to the location of a compressed
fastq file, as a string.</li>
<li>A Nextflow channel <code>input_ch</code> used to read in data to the
workflow.</li>
<li>An unnamed <code>workflow</code> execution block, which is the
default workflow to run.</li>
<li>A call to the process <code>NUM_LINES</code>.</li>
<li>An operation on the process output, using the channel operator
<code>.view()</code>.</li>
<li>A Nextflow process block named <code>NUM_LINES</code>, which defines
what the process does.</li>
<li>An <code>input</code> definition block that assigns the
<code>input</code> to the variable <code>read</code>, and declares that
it should be interpreted as a file path.</li>
<li>An <code>output</code> definition block that uses the Linux/Unix
standard output stream <code>stdout</code> from the script block.</li>
<li>A script block that contains the bash commands
<code>printf '${read}'</code> and
<code>gunzip -c ${read} | wc -l</code>.</li>
</ol></section><section id="running-nextflow-scripts"><h2 class="section-heading">Running Nextflow scripts<a class="anchor" aria-label="anchor" href="#running-nextflow-scripts"></a>
</h2>
<hr class="half-width">
<p>To run a Nextflow script use the command
<code>nextflow run &lt;script_name&gt;</code>.</p>
<div id="run-a-nextflow-script" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="run-a-nextflow-script" class="callout-inner">
<h3 class="callout-title">Run a Nextflow script<a class="anchor" aria-label="anchor" href="#run-a-nextflow-script"></a>
</h3>
<div class="callout-content">
<p>Run the script by entering the following command in your
terminal:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> nextflow run word_count.nf</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>You should see output similar to the text shown below:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.3
Launching `word_count.nf` [fervent_babbage] - revision: c54a707593
executor &gt;  local (1)
[21/b259be] process &gt; NUM_LINES (1) [100%] 1 of 1 ✔

 ref1_1.fq.gz 58708</code></pre>
</div>
<ol style="list-style-type: decimal">
<li>The first line shows the Nextflow version number.</li>
<li>The second line shows the run name <code>fervent_babbage</code>
(adjective and scientist name) and revision id
<code>c54a707593</code>.</li>
<li>The third line tells you the process has been executed locally
(<code>executor &gt;  local</code>).</li>
<li>The next line shows the process id <code>21/b259be</code>, process
name, number of cpus, percentage task completion, and how many instances
of the process have been run.</li>
<li>The final line is the output of the <code>.view()</code>
operator.</li>
</ol>
</div>
</div>
</div>
</div>
</section><section id="quick-recap"><h2 class="section-heading">Quick recap<a class="anchor" aria-label="anchor" href="#quick-recap"></a>
</h2>
<hr class="half-width">
<ul>
<li>A workflow is a sequence of tasks that process a set of data, and a
workflow management system (WfMS) is a computational platform that
provides an infrastructure for the set-up, execution and monitoring of
workflows.</li>
<li>Nextflow scripts comprise of <em>channels</em> for controlling
inputs and outputs, and <em>processes</em> for defining workflow
tasks.</li>
<li>You run a Nextflow script using the <code>nextflow run</code>
command.</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>A workflow is a sequence of tasks that process a set of data.</li>
<li>A workflow management system (WfMS) is a computational platform that
provides an infrastructure for the set-up, execution and monitoring of
workflows.</li>
<li>Nextflow is a workflow management system that comprises both a
runtime environment and a domain specific language (DSL).</li>
<li>Nextflow scripts comprise of channels for controlling inputs and
outputs, and processes for defining workflow tasks.</li>
<li>You run a Nextflow script using the <code>nextflow run</code>
command.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-02-workflow_parameters"><p>Content from <a href="02-workflow_parameters.html">Workflow parameterisation</a></p>
<hr>
<p>Last updated on 2024-04-25 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/02-workflow_parameters.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>“How can I change the data a workflow uses?”</li>
<li>“How can I parameterise a workflow?”</li>
<li>“How can I add my parameters to a file?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>“Use pipeline parameters to change the input to a workflow.”</li>
<li>“Add a pipeline parameters to a Nextflow script.”</li>
<li>“Understand how to create and use a parameter file.”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>In the first episode we ran the Nextflow script,
<code>word_count.nf</code>, from the command line and it counted the
number of lines in the file <code>data/yeast/reads/ref1_1.fq.gz</code>.
To change the input to script we can make use of pipeline
parameters.</p>
<section id="pipeline-parameters"><h2 class="section-heading">Pipeline parameters<a class="anchor" aria-label="anchor" href="#pipeline-parameters"></a>
</h2>
<hr class="half-width">
<p>The Nextflow <code>word_count.nf</code> script defines a pipeline
parameter <code>params.input</code>. Pipeline parameters enable you to
change the input to the workflow at runtime, via the command line or a
configuration file, so they are not hard-coded into the script.</p>
<p>Pipeline parameters are declared in the workflow by prepending the
prefix <code>params</code>, separated by the dot character, to a
variable name e.g., <code>params.input</code>.</p>
<p>Their value can be specified on the command line by prefixing the
parameter name with a <strong>double dash</strong> character, e.g.,
<code>--input</code>.</p>
<p>In the script <code>word_count.nf</code> the pipeline parameter
<code>params.input</code> was specified with a value of
<code>"data/yeast/reads/ref1_1.fq.gz"</code>.</p>
<p>To process a different file,
e.g. <code>data/yeast/reads/ref2_2.fq.gz</code>, in the
<code>word_count.nf</code> script we would run:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> nextflow run word_count.nf <span class="at">--input</span> <span class="st">'data/yeast/reads/ref2_2.fq.gz'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `word_count.nf` [gigantic_woese] - revision: 8acb5cb9b0
executor &gt;  local (1)
[26/3cf986] process &gt; NUM_LINES (1) [100%] 1 of 1 ✔
ref2_2.fq.gz 81720</code></pre>
</div>
<p>We can also use wild cards to specify multiple input files (This will
be covered in the channels episode). In the example below we use the
<code>*</code> to match any sequence of characters between
<code>ref2_</code> and <code>.fq.gz</code>. <strong>Note:</strong> If
you use wild card characters on the command line you must enclose the
value in quotes.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> nextflow run word_count.nf <span class="at">--input</span> <span class="st">'data/yeast/reads/ref2_*.fq.gz'</span></span></code></pre>
</div>
<p>This runs the process NUM_LINES twice, once for each file it
matches.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `word_count.nf` [tender_lumiere] - revision: 8acb5cb9b0
executor &gt;  local (2)
[cc/b6f793] process &gt; NUM_LINES (1) [100%] 2 of 2 ✔
ref2_2.fq.gz 81720

ref2_1.fq.gz 81720</code></pre>
</div>
<div id="change-a-pipelines-input-using-a-parameter" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="change-a-pipelines-input-using-a-parameter" class="callout-inner">
<h3 class="callout-title">Change a pipeline’s input using a
parameter<a class="anchor" aria-label="anchor" href="#change-a-pipelines-input-using-a-parameter"></a>
</h3>
<div class="callout-content">
<p>Re-run the Nextflow script <code>word_count.nf</code> by changing the
pipeline input to all files in the directory
<code>data/yeast/reads/</code> that begin with <code>ref</code> and end
with <code>.fq.gz</code>:</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> nextflow run word_count.nf <span class="at">--input</span> <span class="st">'data/yeast/reads/ref*.fq.gz'</span></span></code></pre>
</div>
<p>The string specified on the command line will override the default
value of the parameter in the script. The output will look like
this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 20.10.0
Launching `word_count.nf` [soggy_miescher] - revision: c54a707593
executor &gt;  local (6)
[d3/9ca185] process &gt; NUM_LINES (2) [100%] 6 of 6 ✔
ref3_2.fq.gz 52592

ref2_2.fq.gz 81720

ref1_1.fq.gz 58708

ref1_2.fq.gz 58708

ref3_1.fq.gz 52592

ref2_1.fq.gz 81720</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="adding-a-parameter-to-a-script"><h2 class="section-heading">Adding a parameter to a script<a class="anchor" aria-label="anchor" href="#adding-a-parameter-to-a-script"></a>
</h2>
<hr class="half-width">
<p>To add a pipeline parameter to a script prepend the prefix
<code>params</code>, separated by a dot character <code>.</code>, to a
variable name e.g., <code>params.input</code>.</p>
<p>Let’s make a copy of the <code>word_count.nf</code> script as
<code>wc-params.nf</code> and add a new input parameter.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> cp word_count.nf wc-params.nf</span></code></pre>
</div>
<p>To add a parameter <code>sleep</code> with the default value
<code>2</code> to <code>wc-params.nf</code> we add the line:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>params<span class="op">.</span>sleep <span class="op">=</span> <span class="dv">2</span></span></code></pre>
</div>
<p><strong>Note:</strong> You should always add a sensible default value
to the pipeline parameter. We can use this parameter to add another step
to our <code>NUM_LINES</code> process.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>script<span class="op">:</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a> <span class="st">"""</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="st"> sleep </span><span class="ss">${</span>params<span class="op">.</span>sleep<span class="ss">}</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="st"> printf '</span><span class="ss">${</span>read<span class="ss">}</span><span class="st"> '</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="st"> gunzip -c </span><span class="ss">${</span>read<span class="ss">}</span><span class="st"> | wc -l</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="st"> """</span></span></code></pre>
</div>
<p>This step, <code>sleep ${params.sleep}</code>, will add a delay for
the amount of time specified in the <code>params.sleep</code> variable,
by default 2 seconds. To access the value inside the script block we use
<code>{variable_name}</code> syntax
e.g. <code>${params.sleep}</code>.</p>
<p>We can now change the sleep parameter from the command line, For
Example:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">nextflow</span> run wc-params.nf <span class="at">--sleep</span> 10</span></code></pre>
</div>
<div id="add-a-pipeline-parameter" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="add-a-pipeline-parameter" class="callout-inner">
<h3 class="callout-title">Add a pipeline parameter<a class="anchor" aria-label="anchor" href="#add-a-pipeline-parameter"></a>
</h3>
<div class="callout-content">
<p>If you haven’t already make a copy of the <code>word_count.nf</code>
as <code>wc-params.nf</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> cp word_count.nf wc-params.nf</span></code></pre>
</div>
<p>Add the param <code>sleep</code> with a default value of 2 below the
<code>params.input</code> line. Add the line
<code>sleep ${params.sleep}</code> in the process <code>NUM_LINES</code>
above the line printf <code>${read}</code>.</p>
<p>Run the new script <code>wc-params.nf</code> changing the sleep input
time.</p>
<p>What input file would it run and why?</p>
<p>How would you get it to process all <code>.fq.gz</code> files in the
<code>data/yeast/reads</code> directory as well as changing the sleep
input to 1 second?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>params<span class="op">.</span>sleep<span class="op">=</span><span class="dv">2</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>script<span class="op">:</span> </span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="st">sleep </span><span class="ss">${</span>params<span class="op">.</span>sleep<span class="ss">}</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="st">printf '</span><span class="ss">${</span>read<span class="ss">}</span><span class="sc">\\</span><span class="st">t'</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="st">gunzip -c </span><span class="ss">${</span>read<span class="ss">}</span><span class="st"> | wc -l </span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="st">"""</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> nextflow run wc-params.nf <span class="at">--sleep</span> 1 </span></code></pre>
</div>
<p>This would use 1 as a value of <code>sleep</code> parameter instead
of default value (which is 2) and run the pipeline. The input file would
be <code>data/yeast/reads/ref1_1.fq.gz</code> as this is the default. To
run all input files we could add the param
<code>--input 'data/yeast/reads/*.fq.gz'</code></p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> nextflow run wc-params.nf <span class="at">--sleep</span> 1 <span class="at">--input</span> <span class="st">'data/yeast/reads/*.fq.gz'</span> </span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="parameter-file"><h2 class="section-heading">Parameter File<a class="anchor" aria-label="anchor" href="#parameter-file"></a>
</h2>
<hr class="half-width">
<p>If we have many parameters to pass to a script it is best to create a
parameters file. Parameters can be stored in JSON format. JSON is a data
serialization language, that is a way of storing data objects and
structures, such as the <code>params</code> object in a file.</p>
<p>The <code>-params-file</code> option is used to pass the parameters
file to the script.</p>
<p>For example the file <code>wc-params.json</code> contains the
parameters <code>sleep</code> and <code>input</code> in JSON format.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">JSON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode json" tabindex="0"><code class="sourceCode json"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="dt">"sleep"</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="dt">"input"</span><span class="fu">:</span> <span class="st">"data/yeast/reads/etoh60_1*.fq.gz"</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">}</span></span></code></pre>
</div>
<p>Create a file called <code>wc-params.json</code> with the above
contents.</p>
<p>To run the <code>wc-params.nf</code> script using these parameters we
add the option <code>-params-file</code> and pass the file
<code>wc-params.json</code>:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">$</span> nextflow run wc-params.nf <span class="at">-params-file</span> wc-params.json</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `wc-params.nf` [nostalgic_northcutt] - revision: 2f86c9ac7e
executor &gt;  local (2)
[b4/747eaa] process &gt; NUM_LINES (1) [100%] 2 of 2 ✔
etoh60_1_2.fq.gz 87348

etoh60_1_1.fq.gz 87348</code></pre>
</div>
<div id="create-and-use-a-parameter-file." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="create-and-use-a-parameter-file." class="callout-inner">
<h3 class="callout-title">Create and use a Parameter file.<a class="anchor" aria-label="anchor" href="#create-and-use-a-parameter-file."></a>
</h3>
<div class="callout-content">
<p>Create a parameter file <code>params.json</code> for the Nextflow
file <code>wc-params.nf</code>, and run the Nextflow script using the
created parameter file, specifying:</p>
<ul>
<li>sleep as 10</li>
<li>input as <code>data/yeast/reads/ref3_1.fq.gz</code>
</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">JSON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode json" tabindex="0"><code class="sourceCode json"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="dt">"sleep"</span><span class="fu">:</span> <span class="dv">10</span><span class="fu">,</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="dt">"input"</span><span class="fu">:</span> <span class="st">"data/yeast/reads/ref3_1.fq.gz"</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="fu">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> nextflow run wc-params.nf <span class="at">-params-file</span> params.json </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W 
 version 21.04.0 Launching `wc-params.nf` [small_wiles] - revision:
f5ef7b7a01 executor \&gt; local (1) [f3/4fa480] process \&gt; NUM_LINES
(1) [100%] 1 of 1 ✔ ref3_1.fq.gz 52592 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>“Pipeline parameters are specified by prepending the prefix
<code>params</code> to a variable name, separated by dot
character.”</li>
<li>“To specify a pipeline parameter on the command line for a Nextflow
run use <code>--variable_name</code> syntax.”</li>
<li>“You can add parameters to a JSON formatted file and pass them to
the script using option <code>-params-file</code>.”</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-03-channels"><p>Content from <a href="03-channels.html">Channels</a></p>
<hr>
<p>Last updated on 2024-05-31 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/03-channels.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I move data around in Nextflow?</li>
<li>How do I handle different types of input, e.g. files and
parameters?</li>
<li>How do I create a Nextflow channel?</li>
<li>How can I use pattern matching to select input files?</li>
<li>How do I change the way inputs are handled?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how Nextflow manages data using channels.</li>
<li>Understand the different types of Nextflow channels.</li>
<li>Create a value and queue channel using channel factory methods.</li>
<li>Select files as input based on a glob pattern.</li>
<li>Edit channel factory arguments to alter how data is read in.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="channels"><h2 class="section-heading">Channels<a class="anchor" aria-label="anchor" href="#channels"></a>
</h2>
<hr class="half-width">
<p>Earlier we learnt that channels are the way in which Nextflow sends
data around a workflow. Channels connect processes via their inputs and
outputs. Channels can store multiple items, such as files (e.g., fastq
files) or values. The number of items a channel stores determines how
many times a process will run using that channel as input.<br><em>Note:</em> When the process runs using one item from the input
channel, we will call that run a <code>task</code>.</p>
</section><section id="why-use-channels"><h2 class="section-heading">Why use Channels?<a class="anchor" aria-label="anchor" href="#why-use-channels"></a>
</h2>
<hr class="half-width">
<p>Channels are how Nextflow handles file management, allowing complex
tasks to be split up, run in parallel, and reduces ‘admin’ required to
get the right inputs to the right parts of the pipeline.</p>
<figure><img src="fig/channel-files.png" alt="Channel files" class="figure mx-auto d-block"></figure><p>Channels are asynchronous, which means that outputs from a set of
processes will not necessarily be produced in the same order as the
corresponding inputs went in. However, the first element into a channel
queue is the first out of the queue (First in - First out). This allows
processes to run as soon as they receive input from a channel. Channels
only send data in one direction, from a producer (a process/operator),
to a consumer (another process/operator).</p>
</section><section id="channel-types"><h2 class="section-heading">Channel types<a class="anchor" aria-label="anchor" href="#channel-types"></a>
</h2>
<hr class="half-width">
<p>Nextflow distinguishes between two different kinds of channels:
<strong>queue</strong> channels and <strong>value</strong> channels.</p>
<div class="section level3">
<h3 id="queue-channel">Queue channel<a class="anchor" aria-label="anchor" href="#queue-channel"></a>
</h3>
<p>Queue channels are a type of channel in which data is consumed (used
up) to make input for a process/operator. Queue channels can be created
in two ways:</p>
<ol style="list-style-type: decimal">
<li>As the outputs of a process.</li>
<li>Explicitly using channel factory methods such as <a href="https://www.nextflow.io/docs/latest/channel.html#of" class="external-link">Channel.of</a>
or <a href="https://www.nextflow.io/docs/latest/channel.html#frompath" class="external-link">Channel.fromPath</a>.</li>
</ol>
</div>
<div class="section level3">
<h3 id="value-channels">Value channels<a class="anchor" aria-label="anchor" href="#value-channels"></a>
</h3>
<p>The second type of Nextflow channel is a <code>value</code> channel.
A <strong>value</strong> channel is bound to a <strong>single</strong>
value. A value channel can be used an unlimited number times since its
content is not consumed. This is also useful for processes that need to
reuse input from a channel, for example, a reference genome sequence
file that is required by multiple steps within a process, or by more
than one process.</p>
<div id="queue-vs-value-channel." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="queue-vs-value-channel." class="callout-inner">
<h3 class="callout-title">Queue vs Value Channel.<a class="anchor" aria-label="anchor" href="#queue-vs-value-channel."></a>
</h3>
<div class="callout-content">
<p>What type of channel would you use to store the following?</p>
<ol style="list-style-type: decimal">
<li>Multiple values.</li>
<li>A list with one or more values.</li>
<li>A single value.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>A queue channels is used to store multiple values.</li>
<li>A value channel is used to store a single value, this can be a list
with multiple values.</li>
<li>A value channel is used to store a single value.</li>
</ol>
</div>
</div>
</div>
</div>

</div>
</section><section id="creating-channels-using-channel-factories"><h2 class="section-heading">Creating Channels using Channel factories<a class="anchor" aria-label="anchor" href="#creating-channels-using-channel-factories"></a>
</h2>
<hr class="half-width">
<p>Channel factories are used to explicitly create channels. In
programming, factory methods (functions) are a programming design
pattern used to create different types of objects (in this case,
different types of channels). They are implemented for things that
represent more generalised concepts, such as a <code>Channel</code>.</p>
<p>Channel factories are called using the
<code>Channel.&lt;method&gt;</code> syntax, and return a specific
instance of a <code>Channel</code>.</p>
<div class="section level3">
<h3 id="the-value-channel-factory">The value Channel factory<a class="anchor" aria-label="anchor" href="#the-value-channel-factory"></a>
</h3>
<p>The <code>value</code> factory method is used to create a value
channel. Values are put inside parentheses <code>()</code> to assign
them to a channel.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>ch1 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span> <span class="st">'GRCh38'</span> <span class="op">)</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>ch2 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span> <span class="op">[</span><span class="st">'chr1'</span><span class="op">,</span> <span class="st">'chr2'</span><span class="op">,</span> <span class="st">'chr3'</span><span class="op">,</span> <span class="st">'chr4'</span><span class="op">,</span> <span class="st">'chr5'</span><span class="op">]</span> <span class="op">)</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>ch3 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span> <span class="op">[</span><span class="st">'chr1'</span> <span class="op">:</span> <span class="dv">248956422</span><span class="op">,</span> <span class="st">'chr2'</span> <span class="op">:</span> <span class="dv">242193529</span><span class="op">,</span> <span class="st">'chr3'</span> <span class="op">:</span> <span class="dv">198295559</span><span class="op">]</span> <span class="op">)</span></span></code></pre>
</div>
<ol style="list-style-type: decimal">
<li>Creates a value channel and binds a string to it.</li>
<li>Creates a value channel and binds a list object to it that will be
emitted as a single item.</li>
<li>Creates a value channel and binds a map object to it that will be
emitted as a single item.</li>
</ol>
<p>The value method can only take 1 argument, however, this can be a
single list or map containing several elements.</p>
<p><em>Reminder:</em></p>
<ul>
<li>A <a href="https://www.tutorialspoint.com/groovy/groovy_lists.htm" class="external-link">List
object</a> can be defined by placing the values in square brackets
<code>[]</code> separated by a comma.</li>
<li>A <a href="https://www.tutorialspoint.com/groovy/groovy_maps.htm" class="external-link">Map
object</a> is similar, but with <code>key:value pairs</code> separated
by commas.</li>
</ul>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>myList <span class="op">=</span> <span class="op">[</span><span class="dv">1776</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">99</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">928734928763</span><span class="op">]</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>myMap <span class="op">=</span> <span class="op">[</span> p1 <span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> q2 <span class="op">:</span> <span class="st">"end"</span> <span class="op">]</span></span></code></pre>
</div>
<p>To view the contents of a value channel, use the <code>view</code>
operator. We will learn more about channel operators in a later
episode.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>ch1 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span> <span class="st">'GRCh38'</span> <span class="op">)</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>ch2 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span> <span class="op">[</span><span class="st">'chr1'</span><span class="op">,</span> <span class="st">'chr2'</span><span class="op">,</span> <span class="st">'chr3'</span><span class="op">,</span> <span class="st">'chr4'</span><span class="op">,</span> <span class="st">'chr5'</span><span class="op">]</span> <span class="op">)</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>ch3 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span> <span class="op">[</span><span class="st">'chr1'</span> <span class="op">:</span> <span class="dv">248956422</span><span class="op">,</span> <span class="st">'chr2'</span> <span class="op">:</span> <span class="dv">242193529</span><span class="op">,</span> <span class="st">'chr3'</span> <span class="op">:</span> <span class="dv">198295559</span><span class="op">]</span> <span class="op">)</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>ch1<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>ch2<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>ch3<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>Each item in the channel is printed on a separate line.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>GRCh38
[chr1, chr2, chr3, chr4, chr5]
[chr1:248956422, chr2:242193529, chr3:198295559]</code></pre>
</div>
</div>
</section><section id="queue-channel-factory"><h2 class="section-heading">Queue channel factory<a class="anchor" aria-label="anchor" href="#queue-channel-factory"></a>
</h2>
<hr class="half-width">
<p>Queue (consumable) channels can be created using the following
channel factory methods.</p>
<ul>
<li><code>Channel.of</code></li>
<li><code>Channel.fromList</code></li>
<li><code>Channel.fromPath</code></li>
<li><code>Channel.fromFilePairs</code></li>
<li><code>Channel.fromSRA</code></li>
</ul>
<div class="section level3">
<h3 id="the-of-channel-factory">The <strong>of</strong> Channel factory<a class="anchor" aria-label="anchor" href="#the-of-channel-factory"></a>
</h3>
<p>When you want to create a channel containing multiple values you can
use the channel factory <code>Channel.of</code>. <code>Channel.of</code>
allows the creation of a <code>queue</code> channel with the values
specified as arguments, separated by a <code>,</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>chromosome_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="st">'chr1'</span><span class="op">,</span> <span class="st">'chr3'</span><span class="op">,</span> <span class="st">'chr5'</span><span class="op">,</span> <span class="st">'chr7'</span> <span class="op">)</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>chromosome_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">chr1</span></span>
<span><span class="va">chr3</span></span>
<span><span class="va">chr5</span></span>
<span><span class="va">chr7</span></span></code></pre>
</div>
<p>The first line in this example creates a variable
<code>chromosome_ch</code>. <code>chromosome_ch</code> is a queue
channel containing the four values specified as arguments in the
<code>of</code> method. The <code>view</code> operator will print one
line per item in a list. Therefore the <code>view</code> operator on the
second line will print four lines, one for each element in the
channel:</p>
<p>You can specify a range of numbers as a single argument using the
Groovy range operator <code>..</code>. This creates each value in the
range (including the start and end values) as a value in the channel.
The Groovy range operator can also produce ranges of dates, letters, or
time. More information on the range operator can be found <a href="https://www.logicbig.com/tutorials/misc/groovy/range-operator.html" class="external-link">here</a>.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>chromosome_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="fl">1..22</span><span class="op">,</span> <span class="st">'X'</span><span class="op">,</span> <span class="st">'Y'</span><span class="op">)</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>chromosome_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>Arguments passed to the <code>of</code> method can be of varying
types e.g., combinations of numbers, strings, or objects. In the above
examples we have examples of both string and number data types.</p>
<div id="channel.from" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="channel.from" class="callout-inner">
<h3 class="callout-title">Channel.from<a class="anchor" aria-label="anchor" href="#channel.from"></a>
</h3>
<div class="callout-content">
<p>You may see the method <code>Channel.from</code> in older nextflow
scripts. This performs a similar function but is now deprecated (no
longer used), and so <code>Channel.of</code> should be used instead.</p>
</div>
</div>
</div>
<div id="create-a-value-and-queue-and-view-channel-contents" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="create-a-value-and-queue-and-view-channel-contents" class="callout-inner">
<h3 class="callout-title">Create a value and Queue and view Channel
contents<a class="anchor" aria-label="anchor" href="#create-a-value-and-queue-and-view-channel-contents"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Create a Nextflow script file called <code>channel.nf</code> .</li>
<li>Create a Value channel <code>ch_vl</code> containing the String
<code>'GRCh38'</code>.</li>
<li>Create a Queue channel <code>ch_qu</code> containing the values 1 to
4.</li>
<li>Use <code>.view()</code> operator on the channel objects to view the
contents of the channels.</li>
<li>Run the code using</li>
</ol>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> nextflow run channel.nf</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>ch_vl <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span><span class="st">'GRCh38'</span><span class="op">)</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>ch_qu <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">)</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>ch_vl<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>ch_qu<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> N E X T F L O W  ~  version 21.04.0
 Launching `channel.nf` [condescending_dalembert] - revision: c80908867b
 GRCh38
 1
 2
 3
 4</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="the-fromlist-channel-factory">The <strong>fromList</strong> Channel factory<a class="anchor" aria-label="anchor" href="#the-fromlist-channel-factory"></a>
</h3>
<p>You can use the <code>Channel.fromList</code> method to create a
queue channel from a list object.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>aligner_list <span class="op">=</span> <span class="op">[</span><span class="st">'salmon'</span><span class="op">,</span> <span class="st">'kallisto'</span><span class="op">]</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>aligner_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromList</span><span class="op">(</span>aligner_list<span class="op">)</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>aligner_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>This would produce two lines.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">salmon</span></span>
<span><span class="va">kallisto</span></span></code></pre>
</div>
<div id="channel.fromlist-vs-channel.of" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="channel.fromlist-vs-channel.of" class="callout-inner">
<h3 class="callout-title">Channel.fromList vs Channel.of<a class="anchor" aria-label="anchor" href="#channel.fromlist-vs-channel.of"></a>
</h3>
<div class="callout-content">
<p>In the above example, the channel has two elements. If you has used
the Channel.of(aligner_list) it would have contained only 1 element
<code>[salmon, kallisto]</code> and any operator or process using the
channel would run once.</p>
</div>
</div>
</div>
<div id="creating-channels-from-a-list" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-channels-from-a-list" class="callout-inner">
<h3 class="callout-title">Creating channels from a list<a class="anchor" aria-label="anchor" href="#creating-channels-from-a-list"></a>
</h3>
<div class="callout-content">
<p>Write a Nextflow script that creates both a <code>queue</code> and
<code>value</code> channel for the list</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>ids <span class="op">=</span> <span class="op">[</span><span class="st">'ERR908507'</span><span class="op">,</span> <span class="st">'ERR908506'</span><span class="op">,</span> <span class="st">'ERR908505'</span><span class="op">]</span></span></code></pre>
</div>
<p>Then print the contents of the channels using the <code>view</code>
operator. How many lines does the queue and value channel print?</p>
<p><strong>Hint:</strong> Use the <code>fromList()</code> and
<code>value()</code> Channel factory methods.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>ids <span class="op">=</span> <span class="op">[</span><span class="st">'ERR908507'</span><span class="op">,</span> <span class="st">'ERR908506'</span><span class="op">,</span> <span class="st">'ERR908505'</span><span class="op">]</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>queue_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromList</span><span class="op">(</span>ids<span class="op">)</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>value_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span>ids<span class="op">)</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>queue_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>value_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `channel_fromList.nf` [wise_hodgkin] - revision: 22d76be151
ERR908507
ERR908506
ERR908505
[ERR908507, ERR908506, ERR908505]</code></pre>
</div>
<p>The queue channel <code>queue_ch</code> will print three lines.</p>
<p>The value channel <code>value_ch</code> will print one line.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="the-frompath-channel-factory">The <strong>fromPath</strong> Channel factory<a class="anchor" aria-label="anchor" href="#the-frompath-channel-factory"></a>
</h3>
<p>The previous channel factory methods dealt with sending general
values in a channel. A special channel factory method
<code>fromPath</code> is used when wanting to pass files.</p>
<p>The <code>fromPath</code> factory method creates a <strong>queue
channel</strong> containing one or more files matching a file path.</p>
<p>The file path (written as a quoted string) can be the location of a
single file or a “glob pattern” that matches multiple files or
directories.</p>
<p>The file path can be a relative path (path to the file from the
current directory), or an absolute path (path to the file from the
system root directory - starts with <code>/</code>).</p>
<p>The script below creates a queue channel with a single file as its
content.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>read_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/yeast/reads/ref1_2.fq.gz'</span> <span class="op">)</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>read_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">data</span><span class="op">/</span><span class="va">yeast</span><span class="op">/</span><span class="va">reads</span><span class="op">/</span><span class="va">ref1_2.fq.gz</span></span></code></pre>
</div>
<p>You can also use glob syntax to specify pattern-matching behaviour
for files. A glob pattern is specified as a string and is matched
against directory or file names.</p>
<ul>
<li>An asterisk, <code>*</code>, matches any number of characters
(including none).</li>
<li>Two asterisks, <code>**</code>, works like * but will also search
sub directories. This syntax is generally used for matching complete
paths.</li>
<li>Braces <code>{}</code> specify a collection of subpatterns. For
example: <code>{bam,bai}</code> matches “bam” or “bai”</li>
</ul>
<p>For example the script below uses the <code>*.fq.gz</code> pattern to
create a queue channel that contains as many items as there are files
with <code>.fq.gz</code> extension in the <code>data/yeast/reads</code>
folder.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>read_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/yeast/reads/*.fq.gz'</span> <span class="op">)</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>read_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>data/yeast/reads/ref1_2.fq.gz
data/yeast/reads/etoh60_3_2.fq.gz
data/yeast/reads/temp33_1_2.fq.gz
data/yeast/reads/temp33_2_1.fq.gz
data/yeast/reads/ref2_1.fq.gz
data/yeast/reads/temp33_3_1.fq.gz
[..truncated..]</code></pre>
</div>
<p><strong>Note</strong> The pattern must contain at least a star
wildcard character.</p>
<p>You can change the behaviour of <code>Channel.fromPath</code> method
by changing its options. A list of <code>.fromPath</code> options is
shown below.</p>
<p>Available fromPath options:</p>
<table class="table">
<colgroup>
<col width="9%">
<col width="90%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>glob</td>
<td>When true, the characters <code>*</code>, <code>?</code>,
<code>[]</code> and <code>{}</code> are interpreted as glob wildcards,
otherwise they are treated as literal characters (default: true)</td>
</tr>
<tr class="even">
<td>type</td>
<td>The type of file paths matched by the string, either
<code>file</code>, <code>dir</code> or <code>any</code> (default:
file)</td>
</tr>
<tr class="odd">
<td>hidden</td>
<td>When true, hidden files are included in the resulting paths
(default: false)</td>
</tr>
<tr class="even">
<td>maxDepth</td>
<td>Maximum number of directory levels to visit (default: no limit)</td>
</tr>
<tr class="odd">
<td>followLinks</td>
<td>When true, symbolic links are followed during directory tree
traversal, otherwise they are managed as files (default: true)</td>
</tr>
<tr class="even">
<td>relative</td>
<td>When true returned paths are relative to the top-most common
directory (default: false)</td>
</tr>
<tr class="odd">
<td>checkIfExists</td>
<td>When true throws an exception if the specified path does not exist
in the file system (default: false)</td>
</tr>
</tbody>
</table>
<p>We can change the default options for the <code>fromPath</code>
method to give an error if the file doesn’t exist using the
<code>checkIfExists</code> parameter. In Nextflow, method parameters are
separated by a <code>,</code> and parameter values specified with a
colon <code>:</code>.</p>
<p>If we execute a Nextflow script with the contents below, it will run
and not produce an output. This is likely not what we want.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>read_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/chicken/reads/*.fq.gz'</span> <span class="op">)</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>read_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>Add the argument <code>checkIfExists</code> with the value
<code>true</code>.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>read_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/chicken/reads/*.fq.gz'</span><span class="op">,</span> checkIfExists<span class="op">:</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>read_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>This will give an error as there is no data/chicken directory.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 20.10.0
Launching `channels.nf` [intergalactic_mcclintock] - revision: d2c138894b
No files match pattern `*.fq.gz` at path: data/chicken/reads/</code></pre>
</div>
<div id="using-channel.frompath" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="using-channel.frompath" class="callout-inner">
<h3 class="callout-title">Using Channel.fromPath<a class="anchor" aria-label="anchor" href="#using-channel.frompath"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Create a Nextflow script <code>channel_fromPath.nf</code>
</li>
<li>Use the <code>Channel.fromPath</code> method to create a channel
containing all files in the <code>data/yeast/</code> directory,
including the subdirectories.</li>
<li>Add the parameter to include any hidden files.</li>
<li>Then print all file names using the <code>view</code> operator.</li>
</ol>
<p><strong>Hint:</strong> You need two asterisks, i.e. <code>**</code>,
to search subdirectories.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>all_files_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/**'</span><span class="op">,</span> hidden<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>all_files_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `channel_fromPath.nf` [reverent_mclean] - revision: cf02269bcb
data/yeast/samples.csv
data/yeast/reads/etoh60_3_2.fq.gz
data/yeast/reads/temp33_1_2.fq.gz
data/yeast/reads/temp33_2_1.fq.gz
[..truncated..]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="the-fromfilepairs-channel-factory">The <strong>fromFilePairs</strong> Channel factory<a class="anchor" aria-label="anchor" href="#the-fromfilepairs-channel-factory"></a>
</h3>
<p>We have seen how to process files individually using
<code>fromPath</code>. In Bioinformatics we often want to process files
in pairs or larger groups, such as read pairs in sequencing.</p>
<p>For example is the <code>data/yeast/reads</code> directory we have
nine groups of read pairs.</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="72%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th>Sample group</th>
<th>read1</th>
<th>read2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>ref1</td>
<td>data/yeast/reads/ref1_1.fq.gz</td>
<td>data/yeast/reads/ref1_2.fq.gz</td>
</tr>
<tr class="even">
<td>ref2</td>
<td>data/yeast/reads/ref2_1.fq.gz</td>
<td>data/yeast/reads/ref2_2.fq.gz</td>
</tr>
<tr class="odd">
<td>ref3</td>
<td>data/yeast/reads/ref3_1.fq.gz</td>
<td>data/yeast/reads/ref3_2.fq.gz</td>
</tr>
<tr class="even">
<td>temp33_1</td>
<td>data/yeast/reads/temp33_1_1.fq.gz</td>
<td>data/yeast/reads/temp33_1_2.fq.gz</td>
</tr>
<tr class="odd">
<td>temp33_2</td>
<td>data/yeast/reads/temp33_2_1.fq.gz</td>
<td>data/yeast/reads/temp33_2_2.fq.gz</td>
</tr>
<tr class="even">
<td>temp33_3</td>
<td>data/yeast/reads/temp33_3_1.fq.gz</td>
<td>data/yeast/reads/temp33_3_2.fq.gz</td>
</tr>
<tr class="odd">
<td>etoh60_1</td>
<td>data/yeast/reads/etoh60_1_1.fq.gz</td>
<td>data/yeast/reads/etoh60_1_2.fq.gz</td>
</tr>
<tr class="even">
<td>etoh60_2</td>
<td>data/yeast/reads/etoh60_2_1.fq.gz</td>
<td>data/yeast/reads/etoh60_2_2.fq.gz</td>
</tr>
<tr class="odd">
<td>etoh60_3</td>
<td>data/yeast/reads/etoh60_3_1.fq.gz</td>
<td>data/yeast/reads/etoh60_3_2.fq.gz</td>
</tr>
</tbody>
</table>
<p>Nextflow provides a convenient Channel factory method for this common
bioinformatics use case. The <code>fromFilePairs</code> method creates a
queue channel containing a <code>tuple</code> for every set of files
matching a specific glob pattern (e.g.,
<code>/path/to/*_{1,2}.fq.gz</code>).</p>
<p>A <code>tuple</code> is a grouping of data, represented as a Groovy
List.</p>
<ol style="list-style-type: decimal">
<li>The first element of the tuple emitted from
<code>fromFilePairs</code> is a string based on the shared part of the
filenames (i.e., the <code>*</code> part of the glob pattern).</li>
<li>The second element is the list of files matching the remaining part
of the glob pattern (i.e., the <code>&lt;string&gt;_{1,2}.fq.gz</code>
pattern). This will include any files ending <code>_1.fq.gz</code> or
<code>_2.fq.gz</code>.</li>
</ol>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>read_pair_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/*_{1,2}.fq.gz'</span><span class="op">)</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>read_pair_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[etoh60_3, [data/yeast/reads/etoh60_3_1.fq.gz, data/yeast/reads/etoh60_3_2.fq.gz]]
[temp33_1, [data/yeast/reads/temp33_1_1.fq.gz, data/yeast/reads/temp33_1_2.fq.gz]]
[ref1, [data/yeast/reads/ref1_1.fq.gz, data/yeast/reads/ref1_2.fq.gz]]
[ref2, [data/yeast/reads/ref2_1.fq.gz, data/yeast/reads/ref2_2.fq.gz]]
[temp33_2, [data/yeast/reads/temp33_2_1.fq.gz, data/yeast/reads/temp33_2_2.fq.gz]]
[ref3, [data/yeast/reads/ref3_1.fq.gz, data/yeast/reads/ref3_2.fq.gz]]
[temp33_3, [data/yeast/reads/temp33_3_1.fq.gz, data/yeast/reads/temp33_3_2.fq.gz]]
[etoh60_1, [data/yeast/reads/etoh60_1_1.fq.gz, data/yeast/reads/etoh60_1_2.fq.gz]]
[etoh60_2, [data/yeast/reads/etoh60_2_1.fq.gz, data/yeast/reads/etoh60_2_2.fq.gz]]</code></pre>
</div>
<p>This will produce a queue channel, <code>read_pair_ch</code> ,
containing nine elements.</p>
<p>Each element is a tuple that has;</p>
<ol style="list-style-type: decimal">
<li>string value (the file prefix matched, e.g
<code>temp33_1</code>)</li>
<li>and a list with the two files e,g.
<code>[data/yeast/reads/temp33_1_1.fq.gz, data/yeast/reads/temp33_1_2.fq.gz]</code>
.</li>
</ol>
<p>The asterisk character <code>*</code>, matches any number of
characters (including none), and the <code>{}</code> braces specify a
collection of subpatterns. Therefore the <code>*_{1,2}.fq.gz</code>
pattern matches any file name ending in <code>_1.fq.gz</code> or
<code>_2.fq.gz</code> .</p>
</div>
<div class="section level3">
<h3 id="what-if-you-want-to-capture-more-than-a-pair">What if you want to capture more than a pair?<a class="anchor" aria-label="anchor" href="#what-if-you-want-to-capture-more-than-a-pair"></a>
</h3>
<p>If you want to capture more than two files for a pattern you will
need to change the default <code>size</code> argument (the default value
is 2) to the number of expected matching files.</p>
<p>For example in the directory <code>data/yeast/reads</code> there are
six files with the prefix <code>ref</code>. If we want to group (create
a tuple) for all of these files we could write;</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>read_group_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/ref{1,2,3}*'</span><span class="op">,</span>size<span class="op">:</span><span class="dv">6</span><span class="op">)</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>read_group_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>The code above will create a queue channel containing one element.
The element is a tuple of which contains a string value, that is the
pattern <strong>ref</strong>, and a list of six files matching the
pattern.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[ref, [data/yeast/reads/ref1_1.fq.gz, data/yeast/reads/ref1_2.fq.gz, data/yeast/reads/ref2_1.fq.gz, data/yeast/reads/ref2_2.fq.gz, data/yeast/reads/ref3_1.fq.gz, data/yeast/reads/ref3_2.fq.gz]]</code></pre>
</div>
<p>See more information about the channel factory
<code>fromFilePairs</code> <a href="https://www.nextflow.io/docs/latest/channel.html#fromfilepairs" class="external-link">here</a></p>
<div id="more-complex-patterns" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="more-complex-patterns" class="callout-inner">
<h3 class="callout-title">More complex patterns<a class="anchor" aria-label="anchor" href="#more-complex-patterns"></a>
</h3>
<div class="callout-content">
<p>If you need to match more complex patterns you should create a sample
sheet specifying the files and create a channel from that. This will be
covered in the operator episode.</p>
</div>
</div>
</div>
<div id="create-a-channel-containing-groups-of-files" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="create-a-channel-containing-groups-of-files" class="callout-inner">
<h3 class="callout-title">Create a channel containing groups of
files<a class="anchor" aria-label="anchor" href="#create-a-channel-containing-groups-of-files"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Create a Nextflow script file <code>channel_fromFilePairs.nf</code>
.</li>
<li>Use the <code>fromFilePairs</code> method to create a channel
containing three tuples. Each tuple will contain the pairs of fastq
reads for the three temp33 samples in the <code>data/yeast/reads</code>
directory</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>pairs_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/temp33*_{1,2}.fq.gz'</span><span class="op">)</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>pairs_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `channels.nf` [stupefied_lumiere] - revision: a3741edde2
[temp33_1, [data/yeast/reads/temp33_1_1.fq.gz, data/yeast/reads/temp33_1_2.fq.gz]]
[temp33_3, [data/yeast/reads/temp33_3_1.fq.gz, data/yeast/reads/temp33_3_2.fq.gz]]
[temp33_2, [data/yeast/reads/temp33_2_1.fq.gz, data/yeast/reads/temp33_2_2.fq.gz]]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="the-fromsra-channel-factory">The <strong>fromSRA</strong> Channel factory<a class="anchor" aria-label="anchor" href="#the-fromsra-channel-factory"></a>
</h3>
<p>Another useful factory method is <code>fromSRA</code>. The
<code>fromSRA</code> method makes it possible to query the <a href="https://www.ncbi.nlm.nih.gov/sra" class="external-link">NCBI SRA</a> archive and returns
a queue channel emitting the FASTQ files matching the specified
selection criteria.</p>
<p>The queries can be project IDs or accession numbers supported by the
<a href="https://www.ncbi.nlm.nih.gov/books/NBK25499/#chapter4.ESearch" class="external-link">NCBI
ESearch API</a>.</p>
<p>If you want to use this functionality, you will need an <a href="https://ncbiinsights.ncbi.nlm.nih.gov/2017/11/02/new-api-keys-for-the-e-utilities/" class="external-link">NCBI
API KEY</a>, and to set the environment variable
<code>NCBI_API_KEY</code> to its value.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>sra_ch <span class="op">=</span><span class="bu">Channel</span><span class="op">.</span><span class="fu">fromSRA</span><span class="op">(</span><span class="st">'SRP043510'</span><span class="op">)</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>sra_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>This will print a tuple for every fastq file associated with that SRA
project accession.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[SRR1448794, ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR144/004/SRR1448794/SRR1448794.fastq.gz]
[SRR1448795, ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR144/005/SRR1448795/SRR1448795.fastq.gz]
[SRR1448792, ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR144/002/SRR1448792/SRR1448792.fastq.gz]
[SRR1448793, ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR144/003/SRR1448793/SRR1448793.fastq.gz]
[SRR1910483, ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR191/003/SRR1910483/SRR1910483.fastq.gz]
[SRR1910482, ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR191/002/SRR1910482/SRR1910482.fastq.gz]
(remaining omitted)</code></pre>
</div>
<p>Multiple accession IDs can be specified using a list object:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>ids <span class="op">=</span> <span class="op">[</span><span class="st">'ERR908507'</span><span class="op">,</span> <span class="st">'ERR908506'</span><span class="op">,</span> <span class="st">'ERR908505'</span><span class="op">]</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>sra_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromSRA</span><span class="op">(</span>ids<span class="op">)</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>sra_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[ERR908507, [ftp://ftp.sra.ebi.ac.uk/vol1/fastq/ERR908/ERR908507/ERR908507_1.fastq.gz, ftp://ftp.sra.ebi.ac.uk/vol1/fastq/ERR908/ERR908507/ERR908507_2.fastq.gz]]
[ERR908506, [ftp://ftp.sra.ebi.ac.uk/vol1/fastq/ERR908/ERR908506/ERR908506_1.fastq.gz, ftp://ftp.sra.ebi.ac.uk/vol1/fastq/ERR908/ERR908506/ERR908506_2.fastq.gz]]
[ERR908505, [ftp://ftp.sra.ebi.ac.uk/vol1/fastq/ERR908/ERR908505/ERR908505_1.fastq.gz, ftp://ftp.sra.ebi.ac.uk/vol1/fastq/ERR908/ERR908505/ERR908505_2.fastq.gz]]</code></pre>
</div>
<div id="read-pairs-from-sra" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="read-pairs-from-sra" class="callout-inner">
<h3 class="callout-title">Read pairs from SRA<a class="anchor" aria-label="anchor" href="#read-pairs-from-sra"></a>
</h3>
<div class="callout-content">
<p>Read pairs are implicitly managed, and are returned as a list of
files.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Channels must be used to import data into Nextflow.</li>
<li>Nextflow has two different kinds of channels: queue channels and
value channels.</li>
<li>Data in value channels can be used multiple times in workflow.</li>
<li>Data in queue channels are consumed when they are used by a process
or an operator.</li>
<li>Channel factory methods, such as <code>Channel.of</code>, are used
to create channels.</li>
<li>Channel factory methods have optional parameters e.g.,
<code>checkIfExists</code>, that can be used to alter the creation and
behaviour of a channel.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-04-processes-part1"><p>Content from <a href="04-processes-part1.html">Processes</a></p>
<hr>
<p>Last updated on 2024-04-25 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/04-processes-part1.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I run tasks/processes in Nextflow?</li>
<li>How do I get data, files and values, into a processes?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how Nextflow uses processes to execute tasks.</li>
<li>Create a Nextflow process.</li>
<li>Define inputs to a process.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="processes"><h2 class="section-heading">Processes<a class="anchor" aria-label="anchor" href="#processes"></a>
</h2>
<hr class="half-width">
<p>We now know how to create and use Channels to send data around a
workflow. We will now see how to run tasks within a workflow using
processes.</p>
<p>A <code>process</code> is the way Nextflow executes commands you
would run on the command line or custom scripts.</p>
<p>A process can be thought of as a particular step in a workflow,
e.g. an alignment step in RNA-seq analysis. Processes are independent of
each other (don’t require any another process to execute) and can not
communicate/write to each other. Data is passed between processes via
input and output Channels.</p>
<p>For example, below is the command you would run to count the number
of sequence records in a FASTA format file such as the yeast
transcriptome:</p>
<div id="fasta-format" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="fasta-format" class="callout-inner">
<h3 class="callout-title">FASTA format<a class="anchor" aria-label="anchor" href="#fasta-format"></a>
</h3>
<div class="callout-content">
<p>FASTA format is a text-based format for representing either
nucleotide sequences or peptide sequences. A sequence in FASTA format
begins with a single-line description, followed by lines of sequence
data. The description line is distinguished from the sequence data by a
greater-than (“&gt;”) symbol in the first column.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="op">&gt;</span>YBR024W_mRNA <span class="ex">cdna</span> chromosome:R64-1-1:II:289445:290350:1 gene:YBR024W gene_biotype:protein_coding transcript_biotype:protein_coding gene_symbol:SCO2 description:Protein anchored to mitochondrial inner membrane<span class="kw">;</span> <span class="ex">may</span> have a redundant function with Sco1p in delivery of copper to cytochrome c oxidase<span class="kw">;</span> <span class="ex">interacts</span> with Cox2p<span class="kw">;</span> <span class="ex">SCO2</span> has a paralog, SCO1, that arose from the whole genome duplication [Source:SGD<span class="kw">;</span><span class="ex">Acc:S000000228]</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">ATGTTGAATAGTTCAAGAAAATATGCTTGTCGTTCCCTATTCAGACAAGCGAACGTCTCA</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">ATAAAAGGACTCTTTTATAATGGAGGCGCATATCGAAGAGGGTTTTCAACGGGATGTTGT</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="zgrep--c" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="zgrep--c" class="callout-inner">
<h3 class="callout-title">zgrep -c ‘^&gt;’<a class="anchor" aria-label="anchor" href="#zgrep--c"></a>
</h3>
<div class="callout-content">
<p>The command
<code>zgrep -c '^&gt;' data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz</code>
is used in Unix-like systems for a specific purpose: it counts the
number of sequences in a compressed FASTA file. The tool
<code>zgrep</code> combines the functionalities of ‘grep’ for pattern
searching and ‘gzip’ for handling compressed files. The <code>-c</code>
option modifies this command to count the occurrences of lines matching
the pattern, instead of displaying them. The pattern
<code>'^&gt;'</code> is designed to find lines that start with ‘&gt;’,
which in FASTA files, denotes the beginning of a new sequence. Thus,
this command efficiently counts how many sequences are contained within
the specified compressed FASTA file.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> zgrep <span class="at">-c</span> <span class="st">'^&gt;'</span> data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">6612</span></span></code></pre>
</div>
<p>Now we will show how to convert this into a simple Nextflow
process.</p>
</section><section id="process-definition"><h2 class="section-heading">Process definition<a class="anchor" aria-label="anchor" href="#process-definition"></a>
</h2>
<hr class="half-width">
<p>The process definition starts with keyword <code>process</code>,
followed by process name, in this case <code>NUMSEQ</code>, and finally
the process <code>body</code> delimited by curly brackets
<code>{}</code>. The process body must contain a string which represents
the command or, more generally, a script that is executed by it.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>process NUMSEQ <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="st">"zgrep -c '^&gt;' </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>This process would run once.</p>
<div id="implicit-variables" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="implicit-variables" class="callout-inner">
<h3 class="callout-title">Implicit variables<a class="anchor" aria-label="anchor" href="#implicit-variables"></a>
</h3>
<div class="callout-content">
<p>We use the Nextflow implicit variable <code>${projectDir}</code> to
specify the directory where the main script is located. This is
important as Nextflow scripts are executed in a separate working
directory. A full list of implicit variables can be found <a href="https://www.nextflow.io/docs/latest/script.html?highlight=implicit%20variables#implicit-variables" class="external-link">here</a></p>
</div>
</div>
</div>
<p>To add the process to a workflow add a <code>workflow</code> block,
and call the process like a function. We will learn more about the
<code>workflow</code> block in the workflow episode.</p>
<p><strong>Note:</strong> As we are using DSL2 we need to include
<code>nextflow.enable.dsl=2</code> in the script.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">//process_01.nf</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>process NUMSEQ <span class="op">{</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="st">"zgrep -c '^&gt;' </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="co">//process is called like a function in the workflow block</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="fu">NUMSEQ</span><span class="op">()</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>We can now run the process:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_01.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<p><strong>Note</strong> We need to add the Nextflow run option
<code>-process.debug</code> to print the output to the terminal.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.10.6
Launching `process_01.nf` [modest_pike] - revision: 3eaa812b17
executor &gt;  local (1)
[cd/eab1fd] process &gt; NUMSEQ [100%] 1 of 1 ✔
6612</code></pre>
</div>
<div id="a-simple-process" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="a-simple-process" class="callout-inner">
<h3 class="callout-title">A Simple Process<a class="anchor" aria-label="anchor" href="#a-simple-process"></a>
</h3>
<div class="callout-content">
<p>Create a Nextflow script <code>simple_process.nf</code> that has one
process <code>COUNT_BASES</code> that runs the command.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">zgrep</span> <span class="at">-v</span> <span class="st">'^&gt;'</span> <span class="va">${projectDir}</span>/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz<span class="kw">|</span><span class="fu">tr</span> <span class="at">-d</span> <span class="st">'\n'</span><span class="kw">|</span><span class="fu">wc</span> <span class="at">-m</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>process COUNT_BASES <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>   </span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>script<span class="op">:</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="st">zgrep -v '^&gt;' </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz|tr -d '</span><span class="sc">\n</span><span class="st">'|wc -m</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="fu">COUNT_BASES</span><span class="op">()</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> nextflow run simple_process.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `simple_process.nf`` [prickly_gilbert] - revision: 471a79c65c
executor &gt;  local (1)
[56/5e6001] process &gt; COUNT_BASES [100%] 1 of 1 ✔
8772368</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="definition-blocks">Definition blocks<a class="anchor" aria-label="anchor" href="#definition-blocks"></a>
</h3>
<p>The previous example was a simple <code>process</code> with no
defined inputs and outputs that ran only once. To control inputs,
outputs and how a command is executed a process may contain five
definition blocks:</p>
<ol style="list-style-type: decimal">
<li>
<strong>directives - 0, 1, or more</strong>: allow the definition of
optional settings that affect the execution of the current process
e.g. the number of cpus a task uses and the amount of memory
allocated.</li>
<li>
<strong>inputs - 0, 1, or more</strong>: Define the input
dependencies, usually channels, which determines the number of times a
process is executed.</li>
<li>
<strong>outputs - 0, 1, or more</strong>: Defines the output
channels used by the process to send results/data produced by the
process.</li>
<li>
<strong>when clause - optional</strong>: Allows you to define a
condition that must be verified in order to execute the process.</li>
<li>
<strong>script block - required</strong>: A statement within quotes
that defines the commands that are executed by the process to carry out
its task.</li>
</ol>
<p>The syntax is defined as follows:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>process <span class="op">&lt;</span> NAME <span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="op">[</span> directives <span class="op">]</span>        </span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  input<span class="op">:</span>                </span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="op">&lt;</span> process inputs <span class="op">&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  output<span class="op">:</span>               </span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="op">&lt;</span> process outputs <span class="op">&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  when<span class="op">:</span>                 </span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="op">&lt;</span> condition <span class="op">&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="op">[</span>script<span class="op">|</span>shell<span class="op">|</span>exec<span class="op">]:</span>  </span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  <span class="op">&lt;</span> user script to be executed <span class="op">&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</section><section id="script"><h2 class="section-heading">Script<a class="anchor" aria-label="anchor" href="#script"></a>
</h2>
<hr class="half-width">
<p>At minimum a process block must contain a <code>script</code>
block.</p>
<p>The <code>script</code> block is a String “statement” that defines
the command that is executed by the process to carry out its task. These
are normally the commands you would run on a terminal.</p>
<p>A process contains only one <code>script</code> block, and it must be
the last statement when the process contains <code>input</code> and
<code>output</code> declarations.</p>
<p>The <code>script</code> block can be a simple one line string in
quotes e.g.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>process NUMSEQ <span class="op">{</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    <span class="st">"zgrep -c '^&gt;' </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  <span class="fu">NUMSEQ</span><span class="op">()</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>Or, for commands that span multiple lines you can encase the command
in triple quotes <code>"""</code>.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">//process_multi_line.nf</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>process NUMSEQ_CHR <span class="op">{</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="st">    zgrep  '^&gt;' </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz &gt; ids.txt</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="st">    zgrep -c '&gt;YA' ids.txt</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  <span class="fu">NUMSEQ_CHR</span><span class="op">()</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_multi_line.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.10.6
Launching `process_multi_line.nf` [focused_jang] - revision: e32caf0dcb
executor &gt;  local (1)
[00/14ce67] process &gt; CHR_COUNT (1) [100%] 1 of 1 ✔
Number of sequences for chromosome A:118</code></pre>
</div>

<p>By default the process command is interpreted as a
<strong>Bash</strong> script. However, any other scripting language can
be used just simply starting the script with the corresponding <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)" class="external-link">Shebang</a>
declaration. For example:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co">//process_python.nf</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>process PROCESS_READS <span class="op">{</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="st">  #!/usr/bin/env python</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="st">  import gzip</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="st">  reads = 0</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="st">  bases = 0</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="st">  with gzip.open('</span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/reads/ref1_1.fq.gz', 'rb') as read:</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="st">      for id in read:</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="st">          seq = next(read)</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="st">          reads += 1</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="st">          bases += len(seq.strip())</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="st">          next(read)</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="st">          next(read)</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="st">  print("reads", reads)</span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="st">  print("bases", bases)</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>  <span class="fu">PROCESS_READS</span><span class="op">()</span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>This allows the use of a different programming languages which may
better fit a particular job. However, for large chunks of code it is
suggested to save them into separate files and invoke them from the
process script.</p>
</section><section id="associated-scripts"><h2 class="section-heading">Associated scripts<a class="anchor" aria-label="anchor" href="#associated-scripts"></a>
</h2>
<hr class="half-width">
<p>Scripts such as the one in the example below,
<code>process_reads.py</code>, can be stored in a <code>bin</code>
folder at the same directory level as the Nextflow workflow script that
invokes them, and given execute permission. Nextflow will automatically
add this folder to the <code>PATH</code> environment variable. To invoke
the script in a Nextflow process, simply use its filename on its own
rather than invoking the interpreter e.g. <code>process_reads.py</code>
instead of <code>python process_reads.py</code>. <strong>Note</strong>
The script <code>process_reads.py</code> must be executable to run.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">mkdir</span> bin</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">mv</span> process_reads.py bin</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="fu">chmod</span> 755 bin/process_reads.py</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># process_reads.py</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="im">import</span> gzip</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>reads <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>bases <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="cf">with</span> gzip.<span class="bu">open</span>(sys.argv[<span class="dv">1</span>], <span class="st">'rb'</span>) <span class="im">as</span> read:</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">id</span> <span class="kw">in</span> read:</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>      seq <span class="op">=</span> <span class="bu">next</span>(read)</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>      reads <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>      bases <span class="op">+=</span> <span class="bu">len</span>(seq.strip())</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>      <span class="bu">next</span>(read)</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>      <span class="bu">next</span>(read)</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"reads"</span>, reads)</span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"bases"</span>, bases)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co">//process_python_script.nf</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>process PROCESS_READS <span class="op">{</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="st">  process_reads.py </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/reads/ref1_1.fq.gz</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>  <span class="fu">PROCESS_READS</span><span class="op">()</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 23.10.1
Launching `pr.nf` [kickass_legentil] DSL2 - revision: 3b9eee1d47
executor &gt;  local (1)
[88/759311] process &gt; PROCESS_READS [100%] 1 of 1 ✔
reads 14677
bases 1482377</code></pre>
</div>
<div id="associated-scripts-1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="associated-scripts-1" class="callout-inner">
<h3 class="callout-title">Associated scripts<a class="anchor" aria-label="anchor" href="#associated-scripts-1"></a>
</h3>
<div class="callout-content">
<p>Scripts such as the one in the example above,
<code>process_reads.py</code>, can be stored in a <code>bin</code>
folder at the same directory level as the Nextflow workflow script that
invokes them, and given execute permission. Nextflow will automatically
add this folder to the <code>PATH</code> environment variable. To invoke
the script in a Nextflow process, simply use its filename on its own
rather than invoking the interpreter e.g. <code>process_reads.py</code>
instead of <code>python process_reads.py</code>.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="script-parameters">Script parameters<a class="anchor" aria-label="anchor" href="#script-parameters"></a>
</h3>
<p>The command in the <code>script</code> block can be defined
dynamically using Nextflow variables e.g. <code>${projectDir}</code>. To
reference a variable in the script block you can use the <code>$</code>
in front of the Nextflow variable name, and additionally you can add
<code>{}</code> around the variable name
e.g. <code>${projectDir}</code>.</p>
<div id="variable-substitutions" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="variable-substitutions" class="callout-inner">
<h3 class="callout-title">Variable substitutions<a class="anchor" aria-label="anchor" href="#variable-substitutions"></a>
</h3>
<div class="callout-content">
<p>Similar to bash scripting Nextflow uses the <code>$</code> character
to introduce variable substitutions. The variable name to be expanded
may be enclosed in braces <code>{variable_name}</code>, which are
optional but serve to protect the variable to be expanded from
characters immediately following it which could be interpreted as part
of the name. It is a good rule of thumb to always use the
<code>{}</code> syntax because it enhances readability and clarity,
ensures correct variable interpretation, and prevents potential syntax
errors in complex expressions.</p>
</div>
</div>
</div>
<p>In the example below the variable <code>chr</code> is set to the
value A at the top of the Nextflow script. The variable is referenced
using the <code>$chr</code> syntax within the multi-line string
statement in the <code>script</code> block. A Nextflow variable can be
used multiple times in the script block.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co">//process_script.nf</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>chr <span class="op">=</span> <span class="st">"A"</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>process CHR_COUNT <span class="op">{</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a><span class="st">  printf "Number of sequences for chromosome </span><span class="ss">${</span>chr<span class="ss">}</span><span class="st"> :"</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="st">  zgrep -c '&gt;Y'</span><span class="ss">${</span>chr<span class="ss">}</span><span class="st"> </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>  <span class="fu">CHR_COUNT</span><span class="op">()</span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>In most cases we do not want to hard code parameter values. We saw in
the parameter episode the use of a special Nextflow variable
<code>params</code> that can be used to assign values from the command
line. You would do this by adding a key name to the params variable and
specifying a value, like <code>params.keyname = value</code></p>
<p>In the example below we define the variable <code>params.chr</code>
with a default value of <code>A</code> in the Nextflow script.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co">//process_script_params.nf</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>params<span class="op">.</span>chr <span class="op">=</span> <span class="st">"A"</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>process CHR_COUNT <span class="op">{</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="st">  printf  'Number of sequences for chromosome '</span><span class="ss">${</span>params<span class="op">.</span>chr<span class="ss">}</span><span class="st">':'</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="st">  zgrep  -c '^&gt;Y'</span><span class="ss">${</span>params<span class="op">.</span>chr<span class="ss">}</span><span class="st"> </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>  <span class="fu">CHR_COUNT</span><span class="op">()</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>Remember, we can change the default value of <code>chr</code> to a
different value such as <code>B</code>, by running the Nextflow script
using the command below. <strong>Note:</strong> parameters to the
workflow have two hyphens <code>--</code>.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">nextflow</span> run process_script_params.nf <span class="at">--chr</span> B</span></code></pre>
</div>
<div id="script-parameters-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="script-parameters-1" class="callout-inner">
<h3 class="callout-title">Script parameters<a class="anchor" aria-label="anchor" href="#script-parameters-1"></a>
</h3>
<div class="callout-content">
<p>For the Nextflow script below.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co">//process_exercise_script_params.nf</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>process COUNT_BASES <span class="op">{</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>script<span class="op">:</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="st">zgrep -v  '^&gt;'   </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz|grep -o A|wc -l   </span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>   <span class="fu">COUNT_BASES</span><span class="op">()</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a> <span class="op">}</span></span></code></pre>
</div>
<p>Add a parameter <code>params.base</code> to the script and uses the
variable <code>${param.base}</code> insides the script. Run the pipeline
using a base value of <code>C</code> using the <code>--base</code>
command line option.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_script_params.nf <span class="at">--base</span> <span class="op">&lt;</span>some value<span class="op">&gt;</span> -process.debug</span></code></pre>
</div>
<p><strong>Note:</strong> The Nextflow option
<code>-process.debug</code> will print the process’ stdout to the
terminal.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a> <span class="co">//process_exercise_script_params.nf</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a> nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a> params<span class="op">.</span>base<span class="op">=</span><span class="st">'A'</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a> process COUNT_BASES <span class="op">{</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>  </span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a> script<span class="op">:</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="st">  zgrep -v  '^&gt;'   </span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz|grep -o </span><span class="ss">${</span>params<span class="op">.</span>base<span class="ss">}</span><span class="st">|wc -l   </span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a> workflow <span class="op">{</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>   <span class="fu">COUNT_BASES</span><span class="op">()</span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a> <span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_script_params.nf <span class="at">--base</span> C <span class="at">-process.debug</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  N E X T F L O W  ~  version 21.04.0
  Launching `process_script_params.nf ` [nostalgic_jones] - revision: 9feb8de4fe
  executor &gt;  local (1)
  [92/cdc9de] process &gt; COUNT_BASES [100%] 1 of 1 ✔
  1677188</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="bash-variables">Bash variables<a class="anchor" aria-label="anchor" href="#bash-variables"></a>
</h3>
<p>Nextflow uses the same Bash syntax for variable substitutions,
<code>$variable</code>, in strings. However, Bash variables need to be
escaped using <code>\</code> character in front of
<code>\$variable</code> name.</p>
<p>In the example below we will set a bash variable <code>NUMIDS</code>
then echo the value of <code>NUMIDS</code> in our script block.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>process NUM_IDS <span class="op">{</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="st">  #set bash variable NUMIDS</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="st">  NUMIDS=`zgrep -c '^&gt;' </span><span class="ss">$params</span><span class="op">.</span><span class="ss">transcriptome</span><span class="st">`</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="st">  echo 'Number of sequences'</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="st">  printf "%'d</span><span class="sc">\n</span><span class="st">" </span><span class="er">\$</span><span class="st">NUMIDS</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>params<span class="op">.</span>transcriptome <span class="op">=</span> <span class="st">"</span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a>  <span class="fu">NUM_IDS</span><span class="op">()</span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="shell">Shell<a class="anchor" aria-label="anchor" href="#shell"></a>
</h3>
<p>Another alternative is to use a <code>shell</code> block definition
instead of <code>script</code>. When using the <code>shell</code>
statement Bash variables are referenced in the normal way
<code>$my_bash_variable</code>; However, the <code>shell</code>
statement uses a different syntax for Nextflow variable substitutions:
<code>!{nextflow_variable}</code>, which is needed to use both Nextflow
and Bash variables in the same script.</p>
<p>For example in the script below that uses the <code>shell</code>
statement we reference the Nextflow variables as
<code>!{projectDir}</code> , and the Bash variable as
<code>${NUMCHAR}</code> and <code>${NUMLINES}</code>.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co">//process_shell.nf</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>process NUM_IDS <span class="op">{</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  shell<span class="op">:</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>  <span class="co">//Shell script definition requires the use of single-quote ' delimited strings</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>  <span class="st">'''</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="st">  #set bash variable NUMIDS</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="st">  NUMIDS=`zgrep -c '^&gt;' !{params.transcriptome}`</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="st">  echo 'Number of sequences'</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="st">  printf  $NUMIDS</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="st">  '''</span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>params<span class="op">.</span>transcriptome <span class="op">=</span> <span class="st">"</span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a>  <span class="fu">NUM_IDS</span><span class="op">()</span></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="conditional-script-execution">Conditional script execution<a class="anchor" aria-label="anchor" href="#conditional-script-execution"></a>
</h3>
<p>Sometimes you want to change how a process is run depending on some
condition. In Nextflow scripts we can use conditional statements such as
the <code>if</code> statement or any other expression evaluating to
boolean value <code>true</code> or <code>false</code>.</p>
</div>
<div class="section level3">
<h3 id="if-statement">If statement<a class="anchor" aria-label="anchor" href="#if-statement"></a>
</h3>
<p>The <code>if</code> statement uses the same syntax common to other
programming languages such Java, C, JavaScript, etc.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span> <span class="op">&lt;</span> <span class="dt">boolean</span> expression <span class="op">&gt;</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>    <span class="co">// true branch</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span> <span class="op">&lt;</span> <span class="dt">boolean</span> expression <span class="op">&gt;</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>    <span class="co">// true branch</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="cf">else</span> <span class="op">{</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>    <span class="co">// false branch</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>For example, the Nextflow script below will use the <code>if</code>
statement to change what the COUNT process counts depending on the
Nextflow variable <code>params.method</code>.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co">//process_conditional.nf</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>params<span class="op">.</span>method <span class="op">=</span> <span class="st">'ids'</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>params<span class="op">.</span>transcriptome <span class="op">=</span> <span class="st">"</span><span class="ss">$projectDir</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>process COUNT <span class="op">{</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>  <span class="cf">if</span><span class="op">(</span> params<span class="op">.</span>method <span class="op">==</span> <span class="st">'ids'</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="st">    echo Number of sequences in transciptome</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="st">    zgrep -c "^&gt;" </span><span class="ss">$params</span><span class="op">.</span><span class="ss">transcriptome</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>  <span class="op">}</span>  </span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span> params<span class="op">.</span>method <span class="op">==</span> <span class="st">'bases'</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a><span class="st">    echo Number of bases in transciptome</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a><span class="st">    zgrep -v "^&gt;" </span><span class="ss">$params</span><span class="op">.</span><span class="ss">transcriptome</span><span class="st">|grep -o "."|wc -l</span></span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a>  <span class="op">}</span>  </span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a>  <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a><span class="st">    echo Unknown method </span><span class="ss">$params</span><span class="op">.</span><span class="ss">method</span></span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a>  <span class="op">}</span>  </span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a>  <span class="fu">COUNT</span><span class="op">()</span></span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_conditional.nf <span class="at">-process.debug</span> <span class="at">--method</span> ids</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `juggle_processes.nf` [cheeky_shirley] - revision: 588f20ae5a
[01/60b08d] process &gt; COUNT [100%] 1 of 1 ✔
Number of sequences in transciptome
6612</code></pre>
</div>
</div>
</section><section id="inputs"><h2 class="section-heading">Inputs<a class="anchor" aria-label="anchor" href="#inputs"></a>
</h2>
<hr class="half-width">
<p>Processes are isolated from each other but can communicate by sending
values and files via Nextflow channels from <code>input</code> and into
<code>output</code> blocks.</p>
<p>The <code>input</code> block defines which channels the process is
expecting to receive input from. The number of elements in input
channels determines the process dependencies and the number of times a
process executes.</p>
<figure><img src="fig/channel-process.png" alt="Process Flow" class="figure mx-auto d-block"><div class="figcaption">Process Flow</div>
</figure><p>You can only define one input block at a time and it must contain one
or more input declarations.</p>
<p>The input block follows the syntax shown below:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>input<span class="op">:</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="op">&lt;</span>input qualifier<span class="op">&gt;</span> <span class="op">&lt;</span>input name<span class="op">&gt;</span></span></code></pre>
</div>
<p>The input qualifier declares the type of data to be received.</p>
<div id="input-qualifiers" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="input-qualifiers" class="callout-inner">
<h3 class="callout-title">Input qualifiers<a class="anchor" aria-label="anchor" href="#input-qualifiers"></a>
</h3>
<div class="callout-content">
<ul>
<li>
<code>val</code>: Lets you access the received input value by its
name as a variable in the process script.</li>
<li>
<code>env</code>: Lets you use the input value to set an environment
variable named as the specified input name.</li>
<li>
<code>path</code>: Lets you handle the received value as a file,
staging the file properly in the execution context.</li>
<li>
<code>stdin</code>: Lets you forward the received value to the
process stdin special file.</li>
<li>
<code>tuple</code>: Lets you handle a group of input values having
one of the above qualifiers.</li>
<li>
<code>each</code>: Lets you execute the process for each entry in
the input collection. A complete list of inputs can be found <a href="https://www.nextflow.io/docs/latest/process.html#inputs" class="external-link">here</a>.</li>
</ul>
</div>
</div>
</div>
<div class="section level3">
<h3 id="input-values">Input values<a class="anchor" aria-label="anchor" href="#input-values"></a>
</h3>
<p>The <code>val</code> qualifier allows you to receive value data as
input. It can be accessed in the process script by using the specified
input name, as shown in the following example:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="co">//process_input_value.nf</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>process PRINTCHR <span class="op">{</span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>  val chr</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a><span class="st">  echo processing chromosome </span><span class="ss">$chr</span></span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>chr_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="st">'A'</span> <span class="op">..</span> <span class="st">'P'</span> <span class="op">)</span></span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a>  <span class="fu">PRINTCHR</span><span class="op">(</span>chr_ch<span class="op">)</span></span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_input_value.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `process_input_value.nf` [wise_kalman] - revision: 7f90e1bfc5
executor &gt;  local (24)
[b1/88df3f] process &gt; PRINTCHR (16) [100%] 24 of 24 ✔
processing chromosome C
processing chromosome L
processing chromosome A
..truncated...</code></pre>
</div>
<p>In the above example the process is executed 16 times; each time a
value is received from the queue channel <code>chr_ch</code> it is used
to run the process.</p>
<div id="channel-order" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="channel-order" class="callout-inner">
<h3 class="callout-title">Channel order<a class="anchor" aria-label="anchor" href="#channel-order"></a>
</h3>
<div class="callout-content">
<p>The channel guarantees that items are delivered in the same order as
they have been sent, but since the process is executed in a parallel
manner, there is no guarantee that they are processed in the same order
as they are received.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="input-files">Input files<a class="anchor" aria-label="anchor" href="#input-files"></a>
</h3>
<p>When you need to handle files as input, you need the
<code>path</code> qualifier. Using the <code>path</code> qualifier means
that Nextflow will stage it in the process execution directory, and it
can be accessed in the script by using the name specified in the input
declaration.</p>
<p>The input file name can be defined dynamically by defining the input
name as a Nextflow variable and referenced in the script using the
<code>$variable_name</code> syntax.</p>
<p>For example, in the script below, we assign the variable name
<code>read</code> to the input files using the <code>path</code>
qualifier. The file is referenced using the variable substitution syntax
<code>${read}</code> in the script block:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co">//process_input_file.nf</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>process NUMLINES <span class="op">{</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>    path read</span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a><span class="st">    printf '</span><span class="ss">${</span>read<span class="ss">}</span><span class="st"> '</span></span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a><span class="st">    gunzip -c </span><span class="ss">${</span>read<span class="ss">}</span><span class="st"> | wc -l</span></span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb40-13"><a href="#cb40-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb40-14"><a href="#cb40-14" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" tabindex="-1"></a>reads_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/yeast/reads/ref*.fq.gz'</span> <span class="op">)</span></span>
<span id="cb40-16"><a href="#cb40-16" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb40-18"><a href="#cb40-18" tabindex="-1"></a>  <span class="fu">NUMLINES</span><span class="op">(</span>reads_ch<span class="op">)</span></span>
<span id="cb40-19"><a href="#cb40-19" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_input_file.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[cd/77af6d] process &gt; NUMLINES (1) [100%] 6 of 6 ✔
ref1_1.fq.gz 58708

ref3_2.fq.gz 52592

ref2_2.fq.gz 81720

ref2_1.fq.gz 81720

ref3_1.fq.gz 52592

ref1_2.fq.gz 58708</code></pre>
</div>
<div id="callout8" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout8"></a>
</h3>
<div class="callout-content">
<p>The input name can also be defined as a user-specified filename
inside quotes. For example, in the script below, the name of the file is
specified as <code>'sample.fq.gz'</code> in the input definition and can
be referenced by that name in the script block.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="co">//process_input_file_02.nf</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>process NUMLINES <span class="op">{</span></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>    path <span class="st">'sample.fq.gz'</span></span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a><span class="st">    printf 'sample.fq.gz '</span></span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a><span class="st">    gunzip -c sample.fq.gz | wc -l</span></span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a>reads_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/yeast/reads/ref*.fq.gz'</span> <span class="op">)</span></span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb43-18"><a href="#cb43-18" tabindex="-1"></a>  <span class="fu">NUMLINES</span><span class="op">(</span>reads_ch<span class="op">)</span></span>
<span id="cb43-19"><a href="#cb43-19" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_input_file_02.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[d2/eb0e9d] process &gt; NUMLINES (1) [100%] 6 of 6 ✔
sample.fq.gz 58708

sample.fq.gz 52592

sample.fq.gz 81720

sample.fq.gz 81720

sample.fq.gz 52592

sample.fq.gz 58708</code></pre>
</div>
</div>
</div>
</div>
<div id="file-objects-as-inputs" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="file-objects-as-inputs" class="callout-inner">
<h3 class="callout-title">File Objects as inputs<a class="anchor" aria-label="anchor" href="#file-objects-as-inputs"></a>
</h3>
<div class="callout-content">
<p>When a process declares an input file, the corresponding channel
elements must be file objects, i.e. created with the path helper
function from the file specific channel factories,
e.g. <code>Channel.fromPath</code> or
<code>Channel.fromFilePairs</code>.</p>
</div>
</div>
</div>
<div id="add-input-channel" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="add-input-channel" class="callout-inner">
<h3 class="callout-title">Add input channel<a class="anchor" aria-label="anchor" href="#add-input-channel"></a>
</h3>
<div class="callout-content">
<p>For the script <code>process_exercise_input.nf</code>:</p>
<ol style="list-style-type: decimal">
<li>Define a Channel using <code>fromPath</code> for the transcriptome
<code>params.transcriptome</code>.<br>
</li>
<li>Add an input channel that takes the transcriptome channel as a file
input.</li>
<li>Replace <code>params.transcriptome</code> in the
<code>script:</code> block with the input variable you defined in the
<code>input:</code> definition.</li>
</ol>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="co">//process_exercise_input.nf</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>params<span class="op">.</span>chr <span class="op">=</span> <span class="st">"A"</span></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a>params<span class="op">.</span>transcriptome <span class="op">=</span> <span class="st">"</span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>process CHR_COUNT <span class="op">{</span></span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" tabindex="-1"></a>script<span class="op">:</span></span>
<span id="cb46-9"><a href="#cb46-9" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb46-10"><a href="#cb46-10" tabindex="-1"></a><span class="st">printf  'Number of sequences for chromosome '</span><span class="ss">${</span>params<span class="op">.</span>chr<span class="ss">}</span><span class="st">':'</span></span>
<span id="cb46-11"><a href="#cb46-11" tabindex="-1"></a><span class="st">zgrep  -c '^&gt;Y'</span><span class="ss">${</span>params<span class="op">.</span>chr<span class="ss">}</span><span class="st"> </span><span class="ss">${</span>params<span class="op">.</span>transcriptome<span class="ss">}</span></span>
<span id="cb46-12"><a href="#cb46-12" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb46-13"><a href="#cb46-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb46-14"><a href="#cb46-14" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb46-16"><a href="#cb46-16" tabindex="-1"></a><span class="fu">CHR_COUNT</span><span class="op">()</span></span>
<span id="cb46-17"><a href="#cb46-17" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>Then run your script using</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="ex">nextflow</span> run process_exercise_input.nf <span class="at">-process.debug</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>## Solution</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a> nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a> params<span class="op">.</span>chr <span class="op">=</span> <span class="st">"A"</span></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a> params<span class="op">.</span>transcriptome <span class="op">=</span> <span class="st">"</span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a> process CHR_COUNT <span class="op">{</span></span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a>  path transcriptome</span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb48-11"><a href="#cb48-11" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb48-12"><a href="#cb48-12" tabindex="-1"></a><span class="st">  printf  'Number of sequences for chromosome '</span><span class="ss">${</span>params<span class="op">.</span>chr<span class="ss">}</span><span class="st">':'</span></span>
<span id="cb48-13"><a href="#cb48-13" tabindex="-1"></a><span class="st">  zgrep  -c '^&gt;Y'</span><span class="ss">${</span>params<span class="op">.</span>chr<span class="ss">}</span><span class="st"> </span><span class="ss">${</span>transcriptome<span class="ss">}</span></span>
<span id="cb48-14"><a href="#cb48-14" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb48-15"><a href="#cb48-15" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb48-16"><a href="#cb48-16" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" tabindex="-1"></a> transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span>params<span class="op">.</span>transcriptome<span class="op">)</span></span>
<span id="cb48-18"><a href="#cb48-18" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" tabindex="-1"></a> workflow <span class="op">{</span></span>
<span id="cb48-20"><a href="#cb48-20" tabindex="-1"></a>  <span class="fu">CHR_COUNT</span><span class="op">(</span>transcriptome_ch<span class="op">)</span></span>
<span id="cb48-21"><a href="#cb48-21" tabindex="-1"></a> <span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.10.6
Launching `process_exercise_input.nf` [focused_jang] - revision: e32caf0dcb
executor &gt;  local (1)
[00/14ce67] process &gt; CHR_COUNT (1) [100%] 1 of 1 ✔
Number of sequences for chromosome A:118</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="combining-input-channels">Combining input channels<a class="anchor" aria-label="anchor" href="#combining-input-channels"></a>
</h3>
<p>A key feature of processes is the ability to handle inputs from
multiple channels. However, it’s important to understand how the number
of items within the multiple channels affect the execution of a
process.</p>
<p>Consider the following example:</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="co">//process_combine.nf</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a>process COMBINE <span class="op">{</span></span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a>  val x</span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a>  val y</span>
<span id="cb50-8"><a href="#cb50-8" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb50-10"><a href="#cb50-10" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb50-11"><a href="#cb50-11" tabindex="-1"></a><span class="st">  echo </span><span class="ss">$x</span><span class="st"> and </span><span class="ss">$y</span></span>
<span id="cb50-12"><a href="#cb50-12" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb50-13"><a href="#cb50-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-14"><a href="#cb50-14" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" tabindex="-1"></a>num_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">)</span></span>
<span id="cb50-16"><a href="#cb50-16" tabindex="-1"></a>letters_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'a'</span><span class="op">,</span> <span class="st">'b'</span><span class="op">,</span> <span class="st">'c'</span><span class="op">)</span></span>
<span id="cb50-17"><a href="#cb50-17" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb50-19"><a href="#cb50-19" tabindex="-1"></a>  <span class="fu">COMBINE</span><span class="op">(</span>num_ch<span class="op">,</span> letters_ch<span class="op">)</span></span>
<span id="cb50-20"><a href="#cb50-20" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_combine.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<p>Both channels contain three elements, therefore the process is
executed three times, each time with a different pair:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>2 and b

1 and a

3 and c</code></pre>
</div>
<p>What is happening is that the process waits until it receives an
input value from all the queue channels declared as input.</p>
<p>When this condition is verified, it uses up the input values coming
from the respective queue channels, runs the task. This logic repeats
until one or more queue channels have no more content. The process then
stops.</p>
<p>What happens when not all channels have the same number of
elements?</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="co">//process_combine_02.nf</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a>process COMBINE <span class="op">{</span></span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a>  val x</span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a>  val y</span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb53-10"><a href="#cb53-10" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb53-11"><a href="#cb53-11" tabindex="-1"></a><span class="st">  echo </span><span class="ss">$x</span><span class="st"> and </span><span class="ss">$y</span></span>
<span id="cb53-12"><a href="#cb53-12" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb53-13"><a href="#cb53-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb53-14"><a href="#cb53-14" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" tabindex="-1"></a>ch_num <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb53-16"><a href="#cb53-16" tabindex="-1"></a>ch_letters <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'a'</span><span class="op">,</span> <span class="st">'b'</span><span class="op">,</span> <span class="st">'c'</span><span class="op">,</span> <span class="st">'d'</span><span class="op">)</span></span>
<span id="cb53-17"><a href="#cb53-17" tabindex="-1"></a></span>
<span id="cb53-18"><a href="#cb53-18" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb53-19"><a href="#cb53-19" tabindex="-1"></a>  <span class="fu">COMBINE</span><span class="op">(</span>ch_num<span class="op">,</span> ch_letters<span class="op">)</span></span>
<span id="cb53-20"><a href="#cb53-20" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_combine_02.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<p>In the above example the process is executed only two times, because
when a queue channel has no more data to be processed it stops the
process execution.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>2 and b

1 and a</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="value-channels-and-process-termination">Value channels and process termination<a class="anchor" aria-label="anchor" href="#value-channels-and-process-termination"></a>
</h3>
<p><strong>Note</strong> however that value channels,
<code>Channel.value</code>, do not affect the process termination.</p>
<p>To better understand this behaviour compare the previous example with
the following one:</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="co">//process_combine_03.nf</span></span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a>process COMBINE <span class="op">{</span></span>
<span id="cb56-5"><a href="#cb56-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb56-6"><a href="#cb56-6" tabindex="-1"></a>  val x</span>
<span id="cb56-7"><a href="#cb56-7" tabindex="-1"></a>  val y</span>
<span id="cb56-8"><a href="#cb56-8" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb56-10"><a href="#cb56-10" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb56-11"><a href="#cb56-11" tabindex="-1"></a><span class="st">  echo </span><span class="ss">$x</span><span class="st"> and </span><span class="ss">$y</span></span>
<span id="cb56-12"><a href="#cb56-12" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb56-13"><a href="#cb56-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb56-14"><a href="#cb56-14" tabindex="-1"></a>ch_num <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">value</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb56-15"><a href="#cb56-15" tabindex="-1"></a>ch_letters <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'a'</span><span class="op">,</span> <span class="st">'b'</span><span class="op">,</span> <span class="st">'c'</span><span class="op">)</span></span>
<span id="cb56-16"><a href="#cb56-16" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb56-18"><a href="#cb56-18" tabindex="-1"></a>  <span class="fu">COMBINE</span><span class="op">(</span>ch_num<span class="op">,</span> ch_letters<span class="op">)</span></span>
<span id="cb56-19"><a href="#cb56-19" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_combine_03.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<p>In this example the process is run three times.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>1 and b
1 and a
1 and c</code></pre>
</div>
<div id="combining-input-channels-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="combining-input-channels-1" class="callout-inner">
<h3 class="callout-title">Combining input channels<a class="anchor" aria-label="anchor" href="#combining-input-channels-1"></a>
</h3>
<div class="callout-content">
<p>Write a nextflow script <code>process_exercise_combine.nf</code> that
combines two input channels</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a> transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz'</span><span class="op">)</span></span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a> chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'A'</span><span class="op">)</span></span></code></pre>
</div>
<p>And include the command below in the script directive</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a><span class="st">  zgrep -c "&gt;Y</span><span class="ss">${</span>chr<span class="ss">}</span><span class="st">" </span><span class="ss">${</span>transcriptome<span class="ss">}</span></span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a><span class="st">  """</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>## Solution</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a> <span class="co">// process_exercise_combine_answer.nf</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a> nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a> process COMBINE <span class="op">{</span></span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a>  path transcriptome</span>
<span id="cb61-6"><a href="#cb61-6" tabindex="-1"></a>  val chr</span>
<span id="cb61-7"><a href="#cb61-7" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb61-9"><a href="#cb61-9" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb61-10"><a href="#cb61-10" tabindex="-1"></a><span class="st">  zgrep -c "&gt;Y</span><span class="ss">${</span>chr<span class="ss">}</span><span class="st">" </span><span class="ss">${</span>transcriptome<span class="ss">}</span></span>
<span id="cb61-11"><a href="#cb61-11" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb61-12"><a href="#cb61-12" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb61-13"><a href="#cb61-13" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" tabindex="-1"></a> transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz'</span><span class="op">,</span> checkIfExists<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb61-15"><a href="#cb61-15" tabindex="-1"></a> chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span></span>
<span id="cb61-16"><a href="#cb61-16" tabindex="-1"></a></span>
<span id="cb61-17"><a href="#cb61-17" tabindex="-1"></a> workflow <span class="op">{</span></span>
<span id="cb61-18"><a href="#cb61-18" tabindex="-1"></a>   <span class="fu">COMBINE</span><span class="op">(</span>transcriptome_ch<span class="op">,</span> chr_ch<span class="op">)</span></span>
<span id="cb61-19"><a href="#cb61-19" tabindex="-1"></a> <span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="input-repeaters"><h2 class="section-heading">Input repeaters<a class="anchor" aria-label="anchor" href="#input-repeaters"></a>
</h2>
<hr class="half-width">
<p>We saw previously that by default the number of times a process runs
is defined by the queue channel with the fewest items. However, the
<code>each</code> qualifier allows you to repeat the execution of a
process for each item in a list or a queue channel, every time new data
is received.</p>
<p>For example if we can fix the previous example by using the input
qualifer <code>each</code> for the letters queue channel:</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="co">//process_repeat.nf</span></span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a>process COMBINE <span class="op">{</span></span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a>  val x</span>
<span id="cb62-7"><a href="#cb62-7" tabindex="-1"></a>  each y</span>
<span id="cb62-8"><a href="#cb62-8" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb62-10"><a href="#cb62-10" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb62-11"><a href="#cb62-11" tabindex="-1"></a><span class="st">  echo </span><span class="ss">$x</span><span class="st"> and </span><span class="ss">$y</span></span>
<span id="cb62-12"><a href="#cb62-12" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb62-13"><a href="#cb62-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb62-14"><a href="#cb62-14" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" tabindex="-1"></a>ch_num <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb62-16"><a href="#cb62-16" tabindex="-1"></a>ch_letters <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'a'</span><span class="op">,</span> <span class="st">'b'</span><span class="op">,</span> <span class="st">'c'</span><span class="op">,</span> <span class="st">'d'</span><span class="op">)</span></span>
<span id="cb62-17"><a href="#cb62-17" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb62-19"><a href="#cb62-19" tabindex="-1"></a>  <span class="fu">COMBINE</span><span class="op">(</span>ch_num<span class="op">,</span> ch_letters<span class="op">)</span></span>
<span id="cb62-20"><a href="#cb62-20" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_repeat.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<p>The process will run eight times.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>2 and d
1 and a
1 and c
2 and b
2 and c
1 and d
1 and b
2 and a</code></pre>
</div>
<div id="input-repeaters-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="input-repeaters-1" class="callout-inner">
<h3 class="callout-title">Input repeaters<a class="anchor" aria-label="anchor" href="#input-repeaters-1"></a>
</h3>
<div class="callout-content">
<p>Extend the script <code>process_exercise_repeat.nf</code> by adding
more values to the <code>chr</code> queue channel e.g. A to P and
running the process for each value.</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="co">//process_exercise_repeat.nf</span></span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>process COMBINE <span class="op">{</span></span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb65-5"><a href="#cb65-5" tabindex="-1"></a>    path transcriptome</span>
<span id="cb65-6"><a href="#cb65-6" tabindex="-1"></a>    val chr</span>
<span id="cb65-7"><a href="#cb65-7" tabindex="-1"></a>   </span>
<span id="cb65-8"><a href="#cb65-8" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb65-9"><a href="#cb65-9" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb65-10"><a href="#cb65-10" tabindex="-1"></a><span class="st">     printf "Number of sequences for chromosome </span><span class="ss">$chr</span><span class="st">: "</span></span>
<span id="cb65-11"><a href="#cb65-11" tabindex="-1"></a><span class="st">    zgrep -c "^&gt;Y</span><span class="ss">${</span>chr<span class="ss">}</span><span class="st">" </span><span class="ss">${</span>transcriptome<span class="ss">}</span></span>
<span id="cb65-12"><a href="#cb65-12" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb65-13"><a href="#cb65-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb65-14"><a href="#cb65-14" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" tabindex="-1"></a>transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz'</span><span class="op">,</span> checkIfExists<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb65-16"><a href="#cb65-16" tabindex="-1"></a>chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'A'</span><span class="op">)</span></span>
<span id="cb65-17"><a href="#cb65-17" tabindex="-1"></a></span>
<span id="cb65-18"><a href="#cb65-18" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb65-19"><a href="#cb65-19" tabindex="-1"></a>  <span class="fu">COMBINE</span><span class="op">(</span>transcriptome_ch<span class="op">,</span> chr_ch<span class="op">)</span></span>
<span id="cb65-20"><a href="#cb65-20" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>How many times does this process run?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a> <span class="co">//process_exercise_repeat_answer.nf</span></span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a> nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a> process COMBINE <span class="op">{</span></span>
<span id="cb66-5"><a href="#cb66-5" tabindex="-1"></a>   input<span class="op">:</span></span>
<span id="cb66-6"><a href="#cb66-6" tabindex="-1"></a>   path transcriptome</span>
<span id="cb66-7"><a href="#cb66-7" tabindex="-1"></a>   each chr</span>
<span id="cb66-8"><a href="#cb66-8" tabindex="-1"></a>  </span>
<span id="cb66-9"><a href="#cb66-9" tabindex="-1"></a>   script<span class="op">:</span></span>
<span id="cb66-10"><a href="#cb66-10" tabindex="-1"></a>   <span class="st">"""</span></span>
<span id="cb66-11"><a href="#cb66-11" tabindex="-1"></a><span class="st">   printf "Number of sequences for chromosome </span><span class="ss">$chr</span><span class="st">: "</span></span>
<span id="cb66-12"><a href="#cb66-12" tabindex="-1"></a><span class="st">   zgrep -c "^&gt;Y</span><span class="ss">${</span>chr<span class="ss">}</span><span class="st">" </span><span class="ss">${</span>transcriptome<span class="ss">}</span></span>
<span id="cb66-13"><a href="#cb66-13" tabindex="-1"></a><span class="st">   """</span></span>
<span id="cb66-14"><a href="#cb66-14" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb66-15"><a href="#cb66-15" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" tabindex="-1"></a> transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz'</span><span class="op">,</span> checkIfExists<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb66-17"><a href="#cb66-17" tabindex="-1"></a> chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'A'</span><span class="op">..</span><span class="st">'P'</span><span class="op">)</span></span>
<span id="cb66-18"><a href="#cb66-18" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" tabindex="-1"></a> workflow <span class="op">{</span></span>
<span id="cb66-20"><a href="#cb66-20" tabindex="-1"></a>   <span class="fu">COMBINE</span><span class="op">(</span>transcriptome_ch<span class="op">,</span> chr_ch<span class="op">)</span></span>
<span id="cb66-21"><a href="#cb66-21" tabindex="-1"></a> <span class="op">}</span></span></code></pre>
</div>
<p>Then run the script.</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_exercise_repeat.nf <span class="at">-process.debug</span></span></code></pre>
</div>
<p>This process runs 16 times.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>A Nextflow process is an independent step in a workflow.</li>
<li>Processes contain up to five definition blocks including:
directives, inputs, outputs, when clause and finally a script
block.</li>
<li>The script block contains the commands you would like to run.</li>
<li>A process should have a script but the other four blocks are
optional.</li>
<li>Inputs are defined in the input block with a type qualifier and a
name.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-05-processes-part2"><p>Content from <a href="05-processes-part2.html">Processes Part 2</a></p>
<hr>
<p>Last updated on 2024-04-24 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/05-processes-part2.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I get data, files, and values, out of processes?</li>
<li>How do I handle grouped input and output?</li>
<li>How can I control when a process is executed?</li>
<li>How do I control resources, such as number of CPUs and memory,
available to processes?</li>
<li>How do I save output/results from a process?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Define outputs to a process.</li>
<li>Understand how to handle grouped input and output using the tuple
qualifier.</li>
<li>Understand how to use conditionals to control process
execution.</li>
<li>Use process directives to control execution of a process.</li>
<li>Use the <code>publishDir</code> directive to save result files to a
directory.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="outputs"><h2 class="section-heading">Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a>
</h2>
<hr class="half-width">
<p>We have seen how to input data into a process; now we will see how to
output files and values from a process.</p>
<p>The <code>output</code> declaration block allows us to define the
channels used by the process to send out the files and values
produced.</p>
<p>An output block is not required, but if it is present it can contain
one or more output declarations.</p>
<p>The output block follows the syntax shown below:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>output<span class="op">:</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="op">&lt;</span>output qualifier<span class="op">&gt;</span> <span class="op">&lt;</span>output name<span class="op">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="op">&lt;</span>output qualifier<span class="op">&gt;</span> <span class="op">&lt;</span>output name<span class="op">&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="op">...</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="output-values">Output values<a class="anchor" aria-label="anchor" href="#output-values"></a>
</h3>
<p>Like the input, the type of output data is defined using type
qualifiers.</p>
<p>The <code>val</code> qualifier allows us to output a value defined in
the script.</p>
<p>Because Nextflow processes can only communicate through channels, if
we want to share a value output of one process as input to another
process, we would need to define that value in the output declaration
block as shown in the following example:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">//process_output_value.nf</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>params<span class="op">.</span>transcriptome<span class="op">=</span><span class="st">"</span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>process COUNT_CHR_SEQS <span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  val chr</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  val chr</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="st">  zgrep -c '^&gt;Y'</span><span class="ss">$chr</span><span class="st"> </span><span class="ss">$params</span><span class="op">.</span><span class="ss">transcriptome</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">// Both 'Channel' and 'channel' keywords work to generate channels.</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">// However, it is a good practice to be consistent through the whole pipeline development</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'A'</span><span class="op">..</span><span class="st">'P'</span><span class="op">)</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>  <span class="fu">COUNT_CHR_SEQS</span><span class="op">(</span>chr_ch<span class="op">)</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>  <span class="co">// use the view operator to display contents of the channel</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>  COUNT_CHR_SEQS<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.10.6
Launching `p1.nf` [jovial_lavoisier] - revision: a652ef75d4
executor &gt;  local (16)
executor &gt;  local (16)
[6a/d82669] process &gt; COUNT_CHR_SEQS (16) [100%] 16 of 16 ✔
B
456

A
118

C
186

[..truncated..]
</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="output-files">Output files<a class="anchor" aria-label="anchor" href="#output-files"></a>
</h3>
<p>If we want to capture a file instead of a value as output we can use
the <code>path</code> qualifier that can capture one or more files
produced by the process, over the specified channel.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co">//process_output_file.nf</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>params<span class="op">.</span>transcriptome<span class="op">=</span><span class="st">"</span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>process COUNT_CHR_SEQS <span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  val chr</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  path <span class="st">"</span><span class="ss">${</span>chr<span class="ss">}</span><span class="st">_seq_count.txt"</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="st">  zgrep -c '^&gt;Y'</span><span class="ss">$chr</span><span class="st"> </span><span class="ss">$params</span><span class="op">.</span><span class="ss">transcriptome</span><span class="st"> &gt; </span><span class="ss">${</span>chr<span class="ss">}</span><span class="st">_seq_count.txt</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">// Both 'Channel' and 'channel' keywords work to generate channels.</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">// However, it is a good practice to be consistent through the whole pipeline development</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'A'</span><span class="op">..</span><span class="st">'P'</span><span class="op">)</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>  <span class="fu">COUNT_CHR_SEQS</span><span class="op">(</span>chr_ch<span class="op">)</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>  <span class="co">// use the view operator to display contents of the channel</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>  COUNT_CHR_SEQS<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.10.6
Launching `process_output_file.nf` [angry_lichterman] - revision: 6a46c69413
executor &gt;  local (16)
[95/ec5d62] process &gt; COUNT_CHR_SEQS (13) [100%] 16 of 16 ✔
/Users/ggrimes2/Documents/process_wf/work/f2/6d5c44985a15feb0555b7b71c37a9c/J_seq_count.txt
executor &gt;  local (16)
[95/ec5d62] process &gt; COUNT_CHR_SEQS (13) [100%] 16 of 16 ✔
work/f2/6d5c44985a15feb0555b7b71c37a9c/J_seq_count.txt
work/4f/f810942341d003acc80c2603671177/B_seq_count.txt
work/23/883ccf187b5357137a9a87d98717c0/I_seq_count.txt
[..truncated..]</code></pre>
</div>
<p>In the above example the process <code>COUNT_CHR_SEQS</code> creates
a file named <code>&lt;chr&gt;_seq_count.txt</code> in the work
directory containing the number of transcripts within that
chromosome.</p>
<p>Since a file parameter using the same name,
<code>&lt;chr&gt;_seq_count.txt</code>, is declared in the output block,
when the task is completed that file is sent over the output
channel.</p>
<p>A downstream <code>operator</code>, such as <code>.view</code> or a
<code>process</code> declaring the same channel as input will be able to
receive it.</p>
</div>
<div class="section level3">
<h3 id="multiple-output-files">Multiple output files<a class="anchor" aria-label="anchor" href="#multiple-output-files"></a>
</h3>
<p>When an output file name contains a <code>*</code> or <code>?</code>
metacharacter it is interpreted as a pattern match. This allows us to
capture multiple files into a list and output them as a one item
channel.</p>
<p>For example, here we will capture the files
<code>sequence_ids.txt</code> and <code>sequence.txt</code> produced as
results from SPLIT_FASTA in the output channel.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">//process_output_multiple.nf</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>params<span class="op">.</span>transcriptome<span class="op">=</span><span class="st">"</span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>process SPLIT_FASTA <span class="op">{</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  path transcriptome</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  path <span class="st">"*"</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="st">  zgrep  '^&gt;' </span><span class="ss">$transcriptome</span><span class="st"> &gt; sequence_ids.txt</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="st">  zgrep -v '^&gt;' </span><span class="ss">$transcriptome</span><span class="st"> &gt; sequence.txt</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">// Both 'Channel' and 'channel' keywords work to generate channels.</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">// However, it is a good practice to be consistent through the whole pipeline development</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span>params<span class="op">.</span>transcriptome<span class="op">)</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>  <span class="fu">SPLIT_FASTA</span><span class="op">(</span>transcriptome_ch<span class="op">)</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>  <span class="co">// use the view operator to display contents of the channel</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>  SPLIT_FASTA<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_output_multiple.nf</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.10.6
Launching `process_output_multiple.nf` [goofy_meitner] - revision: 53cbf7e5a4
executor &gt;  local (1)
[21/01e6ba] process &gt; SPLIT_FASTA (1) [100%] 1 of 1 ✔
[/work/21/01e6baac41d2f37531f86dc7a57034/sequence.txt, work/21/01e6baac41d2f37531f86dc7a57034/sequence_ids.txt]
</code></pre>
</div>
<p><strong>Note:</strong> There are some caveats on glob pattern
behaviour:</p>
<ul>
<li>Input files are not included in the list of possible matches.</li>
<li>Glob pattern matches against both files and directories path.</li>
<li>When a two stars pattern <code>**</code> is used to recurse through
subdirectories, only file paths are matched i.e. directories are not
included in the result list.</li>
</ul>
<div id="output-channels" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="output-channels" class="callout-inner">
<h3 class="callout-title">Output channels<a class="anchor" aria-label="anchor" href="#output-channels"></a>
</h3>
<div class="callout-content">
<p>Modify the nextflow script <code>process_exercise_output.nf</code> to
include an output block that captures the different output file
<code>${chr}_seqids.txt</code>.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">//process_exercise_output.nf</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>process EXTRACT_IDS <span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  path transcriptome</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  each chr</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  <span class="co">//add output block here to capture the file "${chr}_seqids.txt"</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="st">  zgrep '^&gt;Y'</span><span class="ss">$chr</span><span class="st"> </span><span class="ss">$transcriptome</span><span class="st"> &gt; </span><span class="ss">${</span>chr<span class="ss">}</span><span class="st">_seqids.txt</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz'</span><span class="op">)</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'A'</span><span class="op">..</span><span class="st">'P'</span><span class="op">)</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>  <span class="fu">EXTRACT_IDS</span><span class="op">(</span>transcriptome_ch<span class="op">,</span> chr_ch<span class="op">)</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>  EXTRACT_IDS<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co">//process_exercise_output_answer.nf</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>process EXTRACT_IDS <span class="op">{</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  path transcriptome</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  each chr</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>  <span class="co">//add output block here to capture the file "${chr}_seqids.txt"</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>  path <span class="st">"</span><span class="ss">${</span>chr<span class="ss">}</span><span class="st">_seqids.txt"</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="st">  zgrep '^&gt;Y'</span><span class="ss">$chr</span><span class="st"> </span><span class="ss">$transcriptome</span><span class="st"> &gt; </span><span class="ss">${</span>chr<span class="ss">}</span><span class="st">_seqids.txt</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz'</span><span class="op">)</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'A'</span><span class="op">..</span><span class="st">'P'</span><span class="op">)</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>  <span class="fu">EXTRACT_IDS</span><span class="op">(</span>transcriptome_ch<span class="op">,</span> chr_ch<span class="op">)</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>  EXTRACT_IDS<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="grouped-inputs-and-outputs">Grouped inputs and outputs<a class="anchor" aria-label="anchor" href="#grouped-inputs-and-outputs"></a>
</h3>
<p>So far we have seen how to declare multiple input and output
channels, but each channel was handling only one value at time. However
Nextflow can handle groups of values using the <code>tuple</code>
qualifiers.</p>
<p>In tuples the first item is the grouping key and the second item is
the list.</p>
<pre><code>[group_key,[file1,file2,...]]</code></pre>
<p>When using channel containing a tuple, such a one created with
<code>.filesFromPairs</code> factory method, the corresponding input
declaration must be declared with a <code>tuple</code> qualifier,
followed by definition of each item in the tuple.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co">//process_tuple_input.nf</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>process TUPLEINPUT<span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="st">  echo </span><span class="ss">$sample_id</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="st">  echo </span><span class="ss">$reads</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>reads_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/ref1_{1,2}.fq.gz'</span><span class="op">)</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>  <span class="fu">TUPLEINPUT</span><span class="op">(</span>reads_ch<span class="op">)</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>outputs</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ref1
ref1_1.fq.gz ref1_2.fq.gz</code></pre>
</div>
<p>In the same manner an output channel containing tuple of values can
be declared using the <code>tuple</code> qualifier following by the
definition of each tuple element in the tuple.</p>
<p>In the code snippet below the output channel would contain a tuple
with the grouping key value as the Nextflow variable
<code>sample_id</code> and a list containing the files matching the
following pattern <code>"${sample_id}.fq.gz"</code>.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>output<span class="op">:</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span><span class="st">"</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">.fq.gz"</span><span class="op">)</span></span></code></pre>
</div>
<p>An example can be seen in this script below.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co">//process_tuple_io.nf</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>process COMBINE_FQ <span class="op">{</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span><span class="st">"</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">.fq.gz"</span><span class="op">)</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="st">  cat </span><span class="ss">$reads</span><span class="st"> &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">.fq.gz</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>reads_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/ref1_{1,2}.fq.gz'</span><span class="op">)</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>  <span class="fu">COMBINE_FQ</span><span class="op">(</span>reads_ch<span class="op">)</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>  COMBINE_FQ<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">nextflow</span> run process_tuple_io.nf</span></code></pre>
</div>
<p>The output is now a tuple containing the sample id and the combined
fastq files.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[ref1, work/2d/a073d34b5b3231b1f57872599bd308/ref1.fq]</code></pre>
</div>
<div id="composite-inputs-and-outputs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="composite-inputs-and-outputs" class="callout-inner">
<h3 class="callout-title">Composite inputs and outputs<a class="anchor" aria-label="anchor" href="#composite-inputs-and-outputs"></a>
</h3>
<div class="callout-content">
<p>Fill in the blank ___ input and output qualifiers for
<code>process_exercise_tuple.nf</code>. <strong>Note:</strong> the
output for the COMBINE_REPS process.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co">//process_exercise_tuple.nf</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>process COMBINE_REPS <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  tuple <span class="fu">___</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">___</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  tuple <span class="fu">___</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">___</span><span class="op">(</span><span class="st">"*.fq.gz"</span><span class="op">)</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="st">  cat *_1.fq.gz &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_R1.fq.gz</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="st">  cat *_2.fq.gz &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_R2.fq.gz</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>reads_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/ref{1,2,3}*.fq.gz'</span><span class="op">,</span>size<span class="op">:-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a>workflow<span class="op">{</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a>  <span class="fu">COMBINE_REPS</span><span class="op">(</span>reads_ch<span class="op">)</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a>  COMBINE_REPS<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co">//process_exercise_tuple_answer.nf</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>process COMBINE_REPS <span class="op">{</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span><span class="st">"*.fq.gz"</span><span class="op">)</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="st">  cat *_1.fq.gz &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_R1.fq.gz</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="st">  cat *_2.fq.gz &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_R2.fq.gz</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>reads_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/ref*_{1,2,3}.fq.gz'</span><span class="op">,</span>size<span class="op">:-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>workflow<span class="op">{</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>  <span class="fu">COMBINE_REPS</span><span class="op">(</span>reads_ch<span class="op">)</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a>  COMBINE_REPS<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `process_exercise_tuple.nf` [spontaneous_coulomb] - revision: 06ff22f1a9
executor &gt;  local (3)
[75/f4a44d] process &gt; COMBINE_REPS (3) [100%] 3 of 3 ✔
[ref3, work/99/a7d9176e332fdc0988973dbb89df63/ref3_R1.fq.gz, work/99/a7d9176e332fdc0988973dbb89df63/ref3_R2.fq.gz]
[ref2, /work/53/e3cbd39afa9f0f84a3d9cd060d991a/ref2_R1.fq.gz, /work/53/e3cbd39afa9f0f84a3d9cd060d991a/ref2_R2.fq.gz]
[ref1, work/75/f4a44d0bc761fa4774c2f23a465766/ref1_R1.fq.gz, work/75/f4a44d0bc761fa4774c2f23a465766/ref1_R2.fq.gz]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="conditional-execution-of-a-process"><h2 class="section-heading">Conditional execution of a process<a class="anchor" aria-label="anchor" href="#conditional-execution-of-a-process"></a>
</h2>
<hr class="half-width">
<p>The <code>when</code> declaration allows you to define a condition
that must be verified in order to execute the process. This can be any
expression that evaluates a boolean value; <code>true</code> or
<code>false</code>.</p>
<p>It is useful to enable/disable the process execution depending on the
state of various inputs and parameters.</p>
<p>In the example below the process <code>CONDITIONAL</code> will only
execute when the value of the <code>chr</code> variable is less than or
equal to 5:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co">//process_when.nf</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>process CONDITIONAL <span class="op">{</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  val chr</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  when<span class="op">:</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>  chr <span class="op">&lt;=</span> <span class="dv">5</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="st">  echo </span><span class="ss">$chr</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="fl">1..22</span><span class="op">)</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>  <span class="fu">CONDITIONAL</span><span class="op">(</span>chr_ch<span class="op">)</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">4</span></span>
<span></span>
<span><span class="fl">5</span></span>
<span></span>
<span><span class="fl">2</span></span>
<span></span>
<span><span class="fl">3</span></span>
<span></span>
<span><span class="fl">1</span></span></code></pre>
</div>
</section><section id="directives"><h2 class="section-heading">Directives<a class="anchor" aria-label="anchor" href="#directives"></a>
</h2>
<hr class="half-width">
<p>Directive declarations allow the definition of optional settings,
like the number of <code>cpus</code> and amount of <code>memory</code>,
that affect the execution of the current process without affecting the
task itself.</p>
<p>They must be entered at the top of the process body, before any other
declaration blocks (i.e. <code>input</code>, <code>output</code>,
etc).</p>
<p><strong>Note:</strong> You do not use <code>=</code> when assigning a
value to a directive.</p>
<p>Directives are commonly used to define the amount of computing
resources to be used or extra information for configuration or logging
purpose.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co">//process_directive.nf</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>process PRINTCHR <span class="op">{</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>  tag <span class="st">"tagging with chr</span><span class="ss">$chr</span><span class="st">"</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  cpus <span class="dv">1</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>  echo <span class="kw">true</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>  val chr</span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a><span class="st">  echo processing chromosome: </span><span class="ss">$chr</span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="st">  echo number of cpus </span><span class="ss">$task</span><span class="op">.</span><span class="ss">cpus</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a>chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="fl">1..22</span><span class="op">,</span> <span class="st">'X'</span><span class="op">,</span> <span class="st">'Y'</span><span class="op">)</span></span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a>  <span class="fu">PRINTCHR</span><span class="op">(</span>chr_ch<span class="op">)</span></span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>processing chromosome: 1
number of cpus 1

processing chromosome: 2
number of cpus 1

processing chromosome: 6
number of cpus 1
[..truncated..]</code></pre>
</div>
<p>The above process uses the three directives, <code>tag</code>,
<code>cpus</code> and <code>echo</code>.</p>
<p>The <code>tag</code> directive to allow you to give a custom tag to
each process execution. This tag makes it easier to identify a
particular task (executed instance of a process) in a log file or in the
execution report.</p>
<p>The second directive <code>cpus</code> allows you to define the
number of CPUs required for each task.</p>
<p>The third directive <code>echo true</code> prints the stdout to the
terminal.</p>
<p>We use the Nextflow <code>task.cpus</code> variable to capture the
number of cpus assigned to a task. This is frequently used to specify
the number of threads in a multi-threaded command in the script
block.</p>
<p>Another commonly used directive is memory specification:
<code>memory</code>.</p>
<p>A complete list of directives is available at this <a href="https://www.nextflow.io/docs/latest/process.html#directives" class="external-link">link</a>.</p>
<div id="adding-directives" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="adding-directives" class="callout-inner">
<h3 class="callout-title">Adding directives<a class="anchor" aria-label="anchor" href="#adding-directives"></a>
</h3>
<div class="callout-content">
<p>Many software tools allow users to configure the number of CPU
threads used, optimizing performance for faster and more efficient data
processing in high-throughput sequencing tasks.</p>
<p>In this exercise, we will use the bioinformatics tool <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/" class="external-link">FastQC</a>
to assess the quality of high-throughput sequencing read data. FastQC
generates an HTML report along with a directory containing detailed
analysis results. We can specify the number of CPU threads for FastQC to
use with the -t option, followed by the desired number of threads.</p>
<p>Modify the Nextflow script
<code>process_exercise_directives.nf</code></p>
<ol style="list-style-type: decimal">
<li>Add a <code>tag</code> directive logging the sample_id in the
execution output.</li>
<li>Add a <code>cpus</code> directive to specify the number of cpus as
2.</li>
<li>Change the fastqc <code>-t</code> option value to
<code>$task.cpus</code> in the script directive.</li>
</ol>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co">//process_exercise_directives.nf</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>process FASTQC <span class="op">{</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="co">//add tag directive</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="co">//add cpu directive</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a> </span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  </span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span><span class="st">"fastqc_out"</span><span class="op">)</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>  </span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a><span class="st">  mkdir fastqc_out</span></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a><span class="st">  fastqc </span><span class="ss">$reads</span><span class="st"> -o fastqc_out -t 1</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>read_pairs_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/ref*_{1,2}.fq.gz'</span><span class="op">)</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>  <span class="fu">FASTQC</span><span class="op">(</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>  FASTQC<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co">//process_directives_answer.nf</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>process FASTQC <span class="op">{</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>  tag <span class="st">"</span><span class="ss">$sample_id</span><span class="st">"</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>  cpus <span class="dv">2</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>  </span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>  </span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span><span class="st">"fastqc_out"</span><span class="op">)</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a> </span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a><span class="st">  mkdir fastqc_out</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a><span class="st">  fastqc </span><span class="ss">$reads</span><span class="st"> -o fastqc_out -t </span><span class="ss">$task</span><span class="op">.</span><span class="ss">cpus</span></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>read_pairs_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/ref*_{1,2}.fq.gz'</span><span class="op">)</span></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>  <span class="fu">FASTQC</span><span class="op">(</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a>  FASTQC<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `process_exercise_directives.nf` [sad_rosalind] - revision: 2ccbfa4937
executor &gt;  local (3)
[90/de1125] process &gt; FASTQC (ref1) [100%] 3 of 3 ✔
[ref2, work/ea/9e6a341b88caf8879e8d18b77049c8/fastqc_out]
[ref3, work/94/d059b816a9ec3d868f2924c26813e7/fastqc_out]
[ref1, work/90/de11251d362f494d6650789d9f8c1d/fastqc_out]</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="organising-outputs"><h2 class="section-heading">Organising outputs<a class="anchor" aria-label="anchor" href="#organising-outputs"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="publishdir-directive">PublishDir directive<a class="anchor" aria-label="anchor" href="#publishdir-directive"></a>
</h3>
<p>Nextflow manages intermediate results from the pipeline’s expected
outputs independently.</p>
<p>Files created by a <code>process</code> are stored in a task specific
working directory which is considered as temporary. Normally this is
under the <code>work</code> directory, which can be deleted upon
completion.</p>
<p>The files you want the workflow to return as results need to be
defined in the <code>process</code> <code>output</code> block and then
the output directory specified using the <code>directive</code>
<code>publishDir</code>. More information <a href="https://www.nextflow.io/docs/latest/process.html#publishdir" class="external-link">here</a>.</p>
<p><strong>Note:</strong> A common mistake is to specify an output
directory in the <code>publishDir</code> directive while forgetting to
specify the files you want to include in the <code>output</code>
block.</p>
<pre><code>publishDir &lt;directory&gt;, parameter: value, parameter2: value ...</code></pre>
<p>For example if we want to capture the results of the
<code>COMBINE_READS</code> process in a
<code>results/merged_reads</code> output directory we need to define the
files in the <code>output</code> and specify the location of the results
directory in the <code>publishDir</code> directive:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co">//process_publishDir.nf</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>process COMBINE_READS <span class="op">{</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>  publishDir <span class="st">"results/merged_reads"</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>  <span class="fu">path</span><span class="op">(</span><span class="st">"</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">.merged.fq.gz"</span><span class="op">)</span></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a><span class="st">  cat </span><span class="ss">${</span>reads<span class="ss">}</span><span class="st"> &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">.merged.fq.gz</span></span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a>reads_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/ref1_{1,2}.fq.gz'</span><span class="op">)</span></span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb29-23"><a href="#cb29-23" tabindex="-1"></a>  <span class="fu">COMBINE_READS</span><span class="op">(</span>reads_ch<span class="op">)</span></span>
<span id="cb29-24"><a href="#cb29-24" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_publishDir.nf</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `process_publishDir.nf` [friendly_pauling] - revision: 9b5c315893
executor &gt;  local (1)

[a1/5956bd] process &gt; COMBINE_READS (1) [100%] 1 of 1 ✔</code></pre>
</div>
<p>We can use the UNIX command <code>ls -l</code> to examine the
contents of the results directory.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> results/merged_reads/ref1.merged.fq.gz</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>results/merged_reads/ref1.merged.fq.gz -&gt; /Users/nf-user/nf-training/work/a1/5956bd9a92f13694b3ada1941f0d2d/ref1.merged.fq.gz</code></pre>
</div>
<p>In the above example, the
<code>publishDir "results/merged_reads"</code>, creates a symbolic link
<code>-&gt;</code> to the output files specified by the process
<code>merged_reads</code> to the directory path
<code>results/merged_reads</code>.</p>
<p>A symbolic link, often referred to as a symlink, is a type of file
that serves as a reference or pointer to another file or directory,
allowing multiple access paths to the same resource without duplicating
its actual data</p>
<div id="publishdir" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="publishdir" class="callout-inner">
<h3 class="callout-title">publishDir<a class="anchor" aria-label="anchor" href="#publishdir"></a>
</h3>
<div class="callout-content">
<p>The publishDir output is relative to the path the pipeline run has
been launched. Hence, it is a good practice to use <a href="https://www.nextflow.io/docs/latest/script.html?highlight=projectdir#script-implicit-variables" class="external-link">implicit
variables</a> like <code>projectDir</code> to specify publishDir
value.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="publishdir-parameters">publishDir parameters<a class="anchor" aria-label="anchor" href="#publishdir-parameters"></a>
</h3>
<p>The <code>publishDir</code> directive can take optional parameters,
for example the <code>mode</code> parameter can take the value
<code>"copy"</code> to specify that you wish to copy the file to output
directory rather than just a symbolic link to the files in the working
directory. Since the working directory is generally deleted on
completion of a pipeline, it is safest to use <code>mode: "copy"</code>
for results files. The default mode (symlink) is helpful for checking
intermediate files which are not needed in the long term.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>publishDir <span class="st">"results/merged_reads"</span><span class="op">,</span> mode<span class="op">:</span> <span class="st">"copy"</span></span></code></pre>
</div>
<p>Full list <a href="https://www.nextflow.io/docs/latest/process.html#publishdir" class="external-link">here</a>.</p>
</div>
<div class="section level3">
<h3 id="manage-semantic-sub-directories">Manage semantic sub-directories<a class="anchor" aria-label="anchor" href="#manage-semantic-sub-directories"></a>
</h3>
<p>You can use more than one <code>publishDir</code> to keep different
outputs in separate directories. To specify which files to put in which
output directory use the parameter <code>pattern</code> with the a glob
pattern that selects which files to publish from the overall set of
output files.</p>
<p>In the example below we will create an output folder structure in the
directory results, which contains a separate sub-directory for sequence
id file, <code>pattern:"*_ids.txt"</code> , and a sequence directory,
<code>results/sequence"</code> for the <code>sequence.txt</code> file.
Remember, we need to specify the files we want to copy as outputs.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co">//process_publishDir_semantic.nf</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>params<span class="op">.</span>transcriptome<span class="op">=</span><span class="st">"</span><span class="ss">${</span>projectDir<span class="ss">}</span><span class="st">/data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>process SPLIT_FASTA <span class="op">{</span></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>  publishDir <span class="st">"results/ids"</span><span class="op">,</span> pattern<span class="op">:</span> <span class="st">"*_ids.txt"</span><span class="op">,</span> mode<span class="op">:</span> <span class="st">"copy"</span></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>  publishDir <span class="st">"results/sequence"</span><span class="op">,</span> pattern<span class="op">:</span> <span class="st">"sequence.txt"</span><span class="op">,</span> mode<span class="op">:</span> <span class="st">"copy"</span></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>  path transcriptome</span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a>  path <span class="st">"*"</span></span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a><span class="st">  zgrep  '^&gt;' </span><span class="ss">$transcriptome</span><span class="st"> &gt; sequence_ids.txt</span></span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a><span class="st">  zgrep -v '^&gt;' </span><span class="ss">$transcriptome</span><span class="st"> &gt; sequence.txt</span></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a><span class="co">// Both 'Channel' and 'channel' keywords work to generate channels.</span></span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a><span class="co">// However, it is a good practice to be consistent through the whole pipeline development</span></span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a>transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span>params<span class="op">.</span>transcriptome<span class="op">)</span></span>
<span id="cb35-26"><a href="#cb35-26" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb35-28"><a href="#cb35-28" tabindex="-1"></a>  <span class="fu">SPLIT_FASTA</span><span class="op">(</span>transcriptome_ch<span class="op">)</span></span>
<span id="cb35-29"><a href="#cb35-29" tabindex="-1"></a>  <span class="co">// use the view operator to display contents of the channel</span></span>
<span id="cb35-30"><a href="#cb35-30" tabindex="-1"></a>  SPLIT_FASTA<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb35-31"><a href="#cb35-31" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_publishDir_semantic.nf</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `process_publishDir_semantic.nf` [golden_poisson] - revision: 421a604840

executor &gt;  local (1)
[be/950786] process &gt; SPLIT_FASTA (1) [100%] 1 of 1 ✔</code></pre>
</div>
<p>We can now use the <code>ls results/*</code> command to examine the
results directory.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="va">$ls</span> results/<span class="pp">*</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">results</span><span class="op">/</span><span class="va">ids</span><span class="op">:</span></span>
<span><span class="va">sequence_ids.txt</span></span>
<span></span>
<span><span class="va">results</span><span class="op">/</span><span class="va">sequence</span><span class="op">:</span></span>
<span><span class="va">sequence.txt</span></span></code></pre>
</div>
<div id="publishing-results" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="publishing-results" class="callout-inner">
<h3 class="callout-title">Publishing results<a class="anchor" aria-label="anchor" href="#publishing-results"></a>
</h3>
<div class="callout-content">
<p>Add a <code>publishDir</code> directive to the nextflow script
<code>process_exercise_publishDir.nf</code> that copies the merged reads
to the results folder merged_reps.</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co">//process_exercise_publishDir.nf</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>params<span class="op">.</span>reads<span class="op">=</span> <span class="st">"data/yeast/reads/ref{1,2,3}*{1,2}.fq.gz"</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>process MERGE_REPS <span class="op">{</span></span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a> </span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a> input<span class="op">:</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a> tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a> </span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a> output<span class="op">:</span></span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a> <span class="fu">path</span><span class="op">(</span><span class="st">"*fq.gz"</span><span class="op">)</span></span>
<span id="cb40-13"><a href="#cb40-13" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" tabindex="-1"></a> script<span class="op">:</span></span>
<span id="cb40-15"><a href="#cb40-15" tabindex="-1"></a> <span class="st">"""</span></span>
<span id="cb40-16"><a href="#cb40-16" tabindex="-1"></a><span class="st"> cat *1.fq.gz &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">.merged.R1.fq.gz</span></span>
<span id="cb40-17"><a href="#cb40-17" tabindex="-1"></a><span class="st"> cat *2.fq.gz &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">.merged.R2.fq.gz</span></span>
<span id="cb40-18"><a href="#cb40-18" tabindex="-1"></a><span class="st"> """</span></span>
<span id="cb40-19"><a href="#cb40-19" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb40-20"><a href="#cb40-20" tabindex="-1"></a>reads_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span>params<span class="op">.</span>reads<span class="op">,</span>checkIfExists<span class="op">:</span><span class="kw">true</span><span class="op">,</span>size<span class="op">:</span><span class="dv">6</span><span class="op">)</span></span>
<span id="cb40-21"><a href="#cb40-21" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb40-23"><a href="#cb40-23" tabindex="-1"></a> <span class="fu">MERGE_REPS</span><span class="op">(</span>reads_ch<span class="op">)</span></span>
<span id="cb40-24"><a href="#cb40-24" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="co">//process_exercise_publishDir_answer.nf</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>params<span class="op">.</span>reads<span class="op">=</span> <span class="st">"data/yeast/reads/ref{1,2,3}*{1,2}.fq.gz"</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>process MERGE_REPS <span class="op">{</span></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>  publishDir <span class="st">"results/merged_reps"</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a>  <span class="fu">path</span><span class="op">(</span><span class="st">"*fq.gz"</span><span class="op">)</span></span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb41-14"><a href="#cb41-14" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb41-15"><a href="#cb41-15" tabindex="-1"></a><span class="st">  cat *1.fq.gz &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">.merged.R1.fq.gz</span></span>
<span id="cb41-16"><a href="#cb41-16" tabindex="-1"></a><span class="st">  cat *2.fq.gz &gt; </span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">.merged.R2.fq.gz</span></span>
<span id="cb41-17"><a href="#cb41-17" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb41-18"><a href="#cb41-18" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb41-19"><a href="#cb41-19" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" tabindex="-1"></a>reads_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span>params<span class="op">.</span>reads<span class="op">,</span>checkIfExists<span class="op">:</span><span class="kw">true</span><span class="op">,</span>size<span class="op">:</span><span class="dv">6</span><span class="op">)</span></span>
<span id="cb41-21"><a href="#cb41-21" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb41-23"><a href="#cb41-23" tabindex="-1"></a>  <span class="fu">MERGE_REPS</span><span class="op">(</span>reads_ch<span class="op">)</span></span>
<span id="cb41-24"><a href="#cb41-24" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process_exercise_publishDir.nf</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `process_exercise_publishDir.nf` [infallible_becquerel] - revision: 4d865241a8

executor &gt;  local (1)
[22/88aa22] process &gt; MERGE_REPS (1) [100%] 1 of 1 ✔</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="nextflow-patterns" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="nextflow-patterns" class="callout-inner">
<h3 class="callout-title">Nextflow Patterns<a class="anchor" aria-label="anchor" href="#nextflow-patterns"></a>
</h3>
<div class="callout-content">
<p>If you want to find out common structures of Nextflow processes, the
<a href="https://nextflow-io.github.io/patterns/" class="external-link">Nextflow Patterns
page</a> collects some recurrent implementation patterns used in
Nextflow applications.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Outputs to a process are defined using the output blocks.</li>
<li>You can group input and output data from a process using the tuple
qualifier.</li>
<li>The execution of a process can be controlled using the
<code>when</code> declaration and conditional statements.</li>
<li>Files produced within a process and defined as <code>output</code>
can be saved to a directory using the <code>publishDir</code>
directive.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-06-workflow"><p>Content from <a href="06-workflow.html">Workflow</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/06-workflow.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I connect channels and processes to create a workflow?</li>
<li>How do I invoke a process inside a workflow?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create a Nextflow workflow joining multiple processes.</li>
<li>Understand how to to connect processes via their inputs and outputs
within a workflow.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="workflow"><h2 class="section-heading">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<hr class="half-width">
<p>Our previous episodes have shown us how to parameterise workflows
using <code>params</code>, move data around a workflow using
<code>channels</code> and define individual tasks using
<code>processes</code>. In this episode we will cover how connect
multiple processes to create a workflow.</p>
</section><section id="workflow-definition"><h2 class="section-heading">Workflow definition<a class="anchor" aria-label="anchor" href="#workflow-definition"></a>
</h2>
<hr class="half-width">
<p>We can connect processes to create our pipeline inside a
<code>workflow</code> scope. The workflow scope starts with the keyword
<code>workflow</code>, followed by an optional name and finally the
workflow body delimited by curly brackets <code>{}</code>.</p>
<div id="implicit-workflow" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="implicit-workflow" class="callout-inner">
<h3 class="callout-title">Implicit workflow<a class="anchor" aria-label="anchor" href="#implicit-workflow"></a>
</h3>
<div class="callout-content">
<p>In contrast to processes, the workflow definition in Nextflow does
not require a name. In Nextflow, if you don’t give a name to a workflow,
it’s considered the main/implicit starting point of your workflow
program.</p>
<p>A named workflow is a <code>subworkflow</code> that can be invoked
from other workflows, subworkflows are not covered in this lesson, more
information can be found in the official documentation <a href="https://www.nextflow.io/docs/latest/workflow.html" class="external-link">here</a>.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="invoking-processes-with-a-workflow">Invoking processes with a workflow<a class="anchor" aria-label="anchor" href="#invoking-processes-with-a-workflow"></a>
</h3>
<p>As seen previously, a <code>process</code> is invoked as a function
in the <code>workflow</code> scope, passing the expected input channels
as arguments as it if were.</p>
<pre><code> &lt;process_name&gt;(&lt;input_ch1&gt;,&lt;input_ch2&gt;,...)</code></pre>
<p>To combined multiple processes invoke them in the order they would
appear in a workflow. When invoking a process with multiple inputs,
provide them in the same order in which they are declared in the
<code>input</code> block of the process.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">//workflow_01.nf</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a> process FASTQC <span class="op">{</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>      <span class="fu">tuple</span><span class="op">(</span><span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">))</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>      path <span class="st">"fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs"</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>      <span class="st">"""</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="st">      mkdir fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="st">      fastqc -o fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs -f fastq -q </span><span class="ss">${</span>reads<span class="ss">}</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="st">      """</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>process MULTIQC <span class="op">{</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    publishDir <span class="st">"results/mqc"</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>      path transcriptome</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>      path <span class="st">"*"</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>      <span class="st">"""</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="st">      multiqc .</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="st">      """</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>    read_pairs_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/*_{1,2}.fq.gz'</span><span class="op">,</span>checkIfExists<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>    <span class="co">//index process takes 1 input channel as a argument</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>    <span class="co">//assign process output to Nextflow variable fastqc_obj</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>    fastqc_obj <span class="op">=</span> <span class="fu">FASTQC</span><span class="op">(</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>    <span class="co">//quant channel takes 1 input channel as an argument</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>    <span class="co">//We use the collect operator to gather multiple channel items into a single item</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a>    <span class="fu">MULTIQC</span><span class="op">(</span>fastqc_obj<span class="op">.</span><span class="fu">collect</span><span class="op">()).</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="process-outputs">Process outputs<a class="anchor" aria-label="anchor" href="#process-outputs"></a>
</h3>
<p>In the previous example we assigned the process output to a Nextflow
variable <code>fastqc_obj</code>.</p>
<p>A process output can also be accessed directly using the
<code>out</code> attribute for the respective
<code>process object</code>.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="op">[..</span>truncated<span class="op">..]</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  read_pairs_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/*_{1,2}.fq.gz'</span><span class="op">,</span>checkIfExists<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">FASTQC</span><span class="op">(</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="co">// process output  accessed using the `out` attribute of the process object</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">MULTIQC</span><span class="op">(</span>FASTQC<span class="op">.</span>out<span class="op">.</span><span class="fu">collect</span><span class="op">()).</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  MULTIQC<span class="op">.</span>out<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>When a process defines two or more output channels, each of them can
be accessed using the list element operator e.g. <code>out[0]</code>,
<code>out[1]</code>, or using named outputs.</p>
</div>
<div class="section level3">
<h3 id="process-named-output">Process named output<a class="anchor" aria-label="anchor" href="#process-named-output"></a>
</h3>
<p>It can be useful to name the output of a process, especially if there
are multiple outputs.</p>
<p>The process <code>output</code> definition allows the use of the
<code>emit:</code> option to define a named identifier that can be used
to reference the channel in the external scope.</p>
<p>For example in the script below we name the output from the
<code>FASTQC</code> process as <code>fastqc_results</code> using the
<code>emit:</code> option. We can then reference the output as
<code>FASTQC.out.fastqc_results</code> in the workflow scope.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co">//workflow_02.nf</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a> process FASTQC <span class="op">{</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>      tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>      path <span class="st">"fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs"</span><span class="op">,</span> emit<span class="op">:</span> fastqc_results</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>      <span class="st">"""</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="st">      mkdir fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="st">      fastqc -o fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs </span><span class="ss">${</span>reads<span class="ss">}</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="st">      """</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>process MULTIQC <span class="op">{</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    publishDir <span class="st">"results/mqc"</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>      path fastqc_results</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>      path <span class="st">"*"</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>      <span class="st">"""</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="st">      multiqc .</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="st">      """</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>    read_pairs_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span><span class="st">'data/yeast/reads/ref*_{1,2}.fq.gz'</span><span class="op">,</span>checkIfExists<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>    </span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>    <span class="co">//FASTQC process takes 1 input channel as a argument</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>    <span class="fu">FASTQC</span><span class="op">(</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>    <span class="co">//MULTIQC channel takes 1 input channels as arguments</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>    <span class="fu">MULTIQC</span><span class="op">(</span>FASTQC<span class="op">.</span>out<span class="op">.</span>fastqc_results<span class="op">.</span><span class="fu">collect</span><span class="op">()).</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="accessing-script-parameters">Accessing script parameters<a class="anchor" aria-label="anchor" href="#accessing-script-parameters"></a>
</h3>
<p>A workflow component can access any variable and parameter defined in
the outer scope:</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">//workflow_03.nf</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="op">[..</span>truncated<span class="op">..]</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>params<span class="op">.</span>reads <span class="op">=</span> <span class="st">'data/yeast/reads/*_{1,2}.fq.gz'</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  reads_ch_ <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span>params<span class="op">.</span>reads<span class="op">)</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="fu">FASTQC</span><span class="op">(</span>reads_ch_<span class="op">)</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="fu">MULTIQC</span><span class="op">(</span>FASTQC<span class="op">.</span>out<span class="op">.</span>fastqc_results<span class="op">.</span><span class="fu">collect</span><span class="op">()).</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>In this example <code>params.reads</code>, defined outside the
workflow scope, can be accessed inside the <code>workflow</code>
scope.</p>
<div id="workflow-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="workflow-1" class="callout-inner">
<h3 class="callout-title">Workflow<a class="anchor" aria-label="anchor" href="#workflow-1"></a>
</h3>
<div class="callout-content">
<p>Connect the output of the process <code>FASTQC</code> to
<code>PARSEZIP</code> in the Nextflow script
<code>workflow_exercise.nf</code>.</p>
<p><strong>Note:</strong> You will need to pass the
<code>read_pairs_ch</code> as an argument to FASTQC and you will need to
use the <code>collect</code> operator to gather the items in the FASTQC
channel output to a single List item.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">//workflow_exercise.nf</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>params<span class="op">.</span>reads <span class="op">=</span> <span class="st">'data/yeast/reads/*_{1,2}.fq.gz'</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>process FASTQC <span class="op">{</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a> input<span class="op">:</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a> tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a> output<span class="op">:</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a> path <span class="st">"fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs/*.zip"</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a> script<span class="op">:</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a> <span class="st">"""</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="st"> mkdir fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="st"> fastqc -o fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs  </span><span class="ss">${</span>reads<span class="ss">}</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="st"> """</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>process PARSEZIP <span class="op">{</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a> publishDir <span class="st">"results/fqpass"</span><span class="op">,</span> mode<span class="op">:</span><span class="st">"copy"</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a> input<span class="op">:</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a> path fastqc_logs</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a> output<span class="op">:</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a> path <span class="st">'pass_basic.txt'</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a> script<span class="op">:</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a> <span class="st">"""</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="st"> for zip in *.zip; do zipgrep 'Basic Statistics' </span><span class="er">\$</span><span class="st">zip|grep 'summary.txt'; done &gt; pass_basic.txt</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="st"> """</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>read_pairs_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span>params<span class="op">.</span>reads<span class="op">,</span>checkIfExists<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="co">//connect process FASTQC and PARSEZIP</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="co">// remember to use the collect operator on the FASTQC output</span></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">//workflow_exercise.nf</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>params<span class="op">.</span>reads <span class="op">=</span> <span class="st">'data/yeast/reads/*_{1,2}.fq.gz'</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>process FASTQC <span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  path <span class="st">"fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs/*.zip"</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="st">  mkdir fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="st">  fastqc -o fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs  </span><span class="ss">${</span>reads<span class="ss">}</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>process PARSEZIP <span class="op">{</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>  publishDir <span class="st">"results/fqpass"</span><span class="op">,</span> mode<span class="op">:</span><span class="st">"copy"</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>  path fastqc_logs</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>  path <span class="st">'pass_basic.txt'</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>  script<span class="op">:</span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>  <span class="st">"""</span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="st">  for zip in *.zip; do zipgrep 'Basic Statistics' </span><span class="er">\$</span><span class="st">zip|grep 'summary.txt'; done &gt; pass_basic.txt</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a><span class="st">  """</span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>read_pairs_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span>params<span class="op">.</span>reads<span class="op">,</span>checkIfExists<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a>  <span class="fu">PARSEZIP</span><span class="op">(</span><span class="fu">FASTQC</span><span class="op">(</span>read_pairs_ch<span class="op">).</span><span class="fu">collect</span><span class="op">())</span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> nextflow run workflow_exercise.nf</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> wc <span class="at">-l</span>  results/fqpass/pass_basic.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">18</span></span></code></pre>
</div>
<p>The file <code>results/fqpass/pass_basic.txt</code> should have 18
lines. If you only have two lines it might mean that you did not use
<code>collect()</code> operator on the FASTC output channel.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>A Nextflow workflow is defined by invoking <code>processes</code>
inside the <code>workflow</code> scope.</li>
<li>A process is invoked like a function inside the
<code>workflow</code> scope passing any required input parameters as
arguments. e.g. <code>FASTQC(reads_ch)</code>.</li>
<li>Process outputs can be accessed using the <code>out</code> attribute
for the respective <code>process</code> object or assigning the output
to a Nextflow variable.</li>
<li>Multiple outputs from a single process can be accessed using the
list syntax <code>[]</code> and it’s index or by referencing the a named
process output .</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-07-operators"><p>Content from <a href="07-operators.html">Operators</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/07-operators.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I perform operations, such as filtering, on channels?</li>
<li>What are the different kinds of operations I can perform on
channels?</li>
<li>How do I combine operations?</li>
<li>How can I use a CSV file to process data into a Channel?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand what Nextflow operators are.</li>
<li>Modify the contents/elements of a channel using operators.</li>
<li>Perform filtering and combining operations on a channel object.</li>
<li>Use the <code>splitCsv</code> operator to parse the contents of CSV
file into a channel .</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="operators"><h2 class="section-heading">Operators<a class="anchor" aria-label="anchor" href="#operators"></a>
</h2>
<hr class="half-width">
<p>In the Channels episode we learnt how to create Nextflow channels to
enable us to pass data and values around our workflow. If we want to
modify the contents or behaviour of a channel, Nextflow provides methods
called <code>operators</code>. We have previously used the
<code>view</code> operator to view the contents of a channel. There are
many more operator methods that can be applied to Nextflow channels that
can be usefully separated into several groups:</p>
<ul>
<li>
<strong>Filtering</strong> operators: reduce the number of elements
in a channel.</li>
<li>
<strong>Transforming</strong> operators: transform the value/data in
a channel.</li>
<li>
<strong>Splitting</strong> operators: split items in a channel into
smaller chunks.</li>
<li>
<strong>Combining</strong> operators: join channels together.</li>
<li>
<strong>Maths</strong> operators: apply simple math functions on
channels.</li>
<li>
<strong>Other</strong>: such as the view operator.</li>
</ul>
<p>In this episode you will see examples, and get to use different types
of operators.</p>
</section><section id="using-operators"><h2 class="section-heading">Using Operators<a class="anchor" aria-label="anchor" href="#using-operators"></a>
</h2>
<hr class="half-width">
<p>To use an operator, the syntax is the channel name, followed by a dot
<code>.</code> , followed by the operator name and brackets
<code>()</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>channel_obj<span class="op">.&lt;</span>operator<span class="op">&gt;()</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="view">view<a class="anchor" aria-label="anchor" href="#view"></a>
</h4>
<p>The <code>view</code> operator prints the items emitted by a channel
to the console appending a <em>new line</em> character to each item in
the channel.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'1'</span><span class="op">,</span> <span class="st">'2'</span><span class="op">,</span> <span class="st">'3'</span><span class="op">)</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>We can also chain together the channel factory method
<code>.of</code> and the operator <code>.view()</code> using the dot
notation.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'1'</span><span class="op">,</span> <span class="st">'2'</span><span class="op">,</span> <span class="st">'3'</span><span class="op">).</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>To make code more readable we can split the operators over several
lines. The blank space between the operators is ignored and is solely
for readability.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>ch <span class="op">=</span> channel</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>      <span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'1'</span><span class="op">,</span> <span class="st">'2'</span><span class="op">,</span> <span class="st">'3'</span><span class="op">)</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>      <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>prints:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="dv">3</span></span></code></pre>
</div>
<div class="section level5">
<h5 id="closures">Closures<a class="anchor" aria-label="anchor" href="#closures"></a>
</h5>
<p>An optional <em>closure</em> <code>{}</code> parameter can be
specified to customise how items are printed.</p>
<p>Briefly, a closure is a block of code that can be passed as an
argument to a function. In this way you can define a chunk of code and
then pass it around as if it were a string or an integer. By default the
parameters for a closure are specified with the groovy keyword
<code>$it</code> (‘it’ is for ‘item’).</p>
<p>For example here we use the the <code>view</code> operator and apply
a closure to it, to add a <code>chr</code> prefix to each element of the
channel using string interpolation.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>ch <span class="op">=</span> channel</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'1'</span><span class="op">,</span> <span class="st">'2'</span><span class="op">,</span> <span class="st">'3'</span><span class="op">)</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">({</span> <span class="st">"chr</span><span class="ss">$it</span><span class="st">"</span> <span class="op">})</span></span></code></pre>
</div>
<p>It prints:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">chr1</span></span>
<span><span class="va">chr2</span></span>
<span><span class="va">chr3</span></span></code></pre>
</div>
<p><strong>Note:</strong> the <code>view()</code> operator doesn’t
change the contents of the channel object.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>ch <span class="op">=</span> channel</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'1'</span><span class="op">,</span> <span class="st">'2'</span><span class="op">,</span> <span class="st">'3'</span><span class="op">)</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">({</span> <span class="st">"chr</span><span class="ss">$it</span><span class="st">"</span> <span class="op">})</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span>  </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">chr1</span></span>
<span><span class="va">chr2</span></span>
<span><span class="va">chr3</span></span>
<span><span class="fl">1</span></span>
<span><span class="fl">2</span></span>
<span><span class="fl">3</span></span></code></pre>
</div>
</div>
</div>
<div class="section level3">
<h3 id="filtering-operators">Filtering operators<a class="anchor" aria-label="anchor" href="#filtering-operators"></a>
</h3>
<p>We can reduce the number of items in a channel by using filtering
operators.</p>
<p>The <code>filter</code> operator allows you to get only the items
emitted by a channel that satisfy a condition and discard all the
others. The filtering condition can be specified by using either:</p>
<ul>
<li>a regular expression</li>
<li>a literal value</li>
<li>a data type qualifier, e.g. Number (any integer,float …), String,
Boolean</li>
<li>or any boolean statement.</li>
</ul>
<div class="section level5">
<h5 id="data-type-qualifier">Data type qualifier<a class="anchor" aria-label="anchor" href="#data-type-qualifier"></a>
</h5>
<p>Here we use the <code>filter</code> operator on the
<code>chr_ch</code> channel specifying the data type qualifier
<code>Number</code> so that only numeric items are returned. The Number
data type includes both integers and floating point numbers. We will
then use the <code>view</code> operator to print the contents.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>chr_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="fl">1..22</span><span class="op">,</span> <span class="st">'X'</span><span class="op">,</span> <span class="st">'Y'</span> <span class="op">)</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>autosomes_ch <span class="op">=</span>chr_ch<span class="op">.</span><span class="fu">filter</span><span class="op">(</span> <span class="bu">Number</span> <span class="op">)</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>autosomes_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>To simplify the code we can chain multiple operators together, such
as <code>filter</code> and <code>view</code> using a <code>.</code>
.</p>
<p>The previous example could be rewritten like: The blank space between
the operators is ignored and is used for readability.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>chr_ch <span class="op">=</span> channel</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="fl">1..22</span><span class="op">,</span> <span class="st">'X'</span><span class="op">,</span> <span class="st">'Y'</span> <span class="op">)</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span><span class="op">(</span> <span class="bu">Number</span> <span class="op">)</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1</span></span>
<span><span class="fl">2</span></span>
<span><span class="fl">3</span></span>
<span><span class="fl">4</span></span>
<span><span class="fl">5</span></span>
<span><span class="fl">6</span></span>
<span><span class="fl">7</span></span>
<span><span class="fl">8</span></span>
<span><span class="fl">9</span></span>
<span><span class="fl">10</span></span>
<span><span class="fl">11</span></span>
<span><span class="fl">12</span></span>
<span><span class="fl">13</span></span>
<span><span class="fl">14</span></span>
<span><span class="fl">15</span></span>
<span><span class="fl">16</span></span>
<span><span class="fl">17</span></span>
<span><span class="fl">18</span></span>
<span><span class="fl">19</span></span>
<span><span class="fl">20</span></span>
<span><span class="fl">21</span></span>
<span><span class="fl">22</span></span></code></pre>
</div>
</div>
<div class="section level5">
<h5 id="regular-expression">Regular expression<a class="anchor" aria-label="anchor" href="#regular-expression"></a>
</h5>
<p>To filter by a regular expression you have to do is to put
<code>~</code> right in front of the string literal regular expression
(e.g. <code>~"(^[Nn]extflow)"</code> or use slashy strings which replace
the quotes with <code>/</code>. <code>~/^[Nn]extflow/</code>).</p>
<p>The following example shows how to filter a channel by using a
regular expression <code>~/^1.*/</code> inside a slashy string, that
returns only strings that begin with 1:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>chr_ch <span class="op">=</span> channel</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="fl">1..22</span><span class="op">,</span> <span class="st">'X'</span><span class="op">,</span> <span class="st">'Y'</span> <span class="op">)</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span><span class="op">(~</span><span class="st">/^1.*/</span><span class="op">)</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1</span></span>
<span><span class="fl">10</span></span>
<span><span class="fl">11</span></span>
<span><span class="fl">12</span></span>
<span><span class="fl">13</span></span>
<span><span class="fl">14</span></span>
<span><span class="fl">15</span></span>
<span><span class="fl">16</span></span>
<span><span class="fl">17</span></span>
<span><span class="fl">18</span></span>
<span><span class="fl">19</span></span></code></pre>
</div>
</div>
<div class="section level5">
<h5 id="boolean-statement">Boolean statement<a class="anchor" aria-label="anchor" href="#boolean-statement"></a>
</h5>
<p>A filtering condition can be defined by using a Boolean expression
described by a closure <code>{}</code> and returning a boolean value.
For example the following fragment shows how to combine a filter for a
type qualifier <code>Number</code> with another filter operator using a
Boolean expression to emit numbers less than 5:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>channel</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="fl">1..22</span><span class="op">,</span> <span class="st">'X'</span><span class="op">,</span> <span class="st">'Y'</span> <span class="op">)</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span><span class="op">(</span><span class="bu">Number</span><span class="op">)</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span> <span class="op">{</span> it <span class="op">&lt;</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1</span></span>
<span><span class="fl">2</span></span>
<span><span class="fl">3</span></span>
<span><span class="fl">4</span></span></code></pre>
</div>
<div id="closures-1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="closures-1" class="callout-inner">
<h3 class="callout-title">Closures<a class="anchor" aria-label="anchor" href="#closures-1"></a>
</h3>
<div class="callout-content">
<p>In the above example we have removed the brackets around the filter
condition e.g. <code>filter{ it&lt;5}</code>, since it specifies a
closure as the operator’s argument. This is language short for
<code>filter({ it&lt;5})</code></p>
</div>
</div>
</div>
</div>
<div class="section level5">
<h5 id="literal-value">Literal value<a class="anchor" aria-label="anchor" href="#literal-value"></a>
</h5>
<p>Finally, if we only want to include elements of a specific value we
can specify a literal value. In the example below we use the literal
value <code>X</code> to filter the channel for only those elements
containing the value <code>X</code>.</p>
<pre><code>channel
  .of( 1..22, 'X', 'Y' )
  .filter('X')
  .view()</code></pre>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">X</span></span></code></pre>
</div>
<div id="filter-a-channel" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="filter-a-channel" class="callout-inner">
<h3 class="callout-title">Filter a channel<a class="anchor" aria-label="anchor" href="#filter-a-channel"></a>
</h3>
<div class="callout-content">
<p>Add two channel filters to the Nextflow script below to view only the
even numbered chromosomes.</p>
<p><strong>Note:</strong> The expression <code>it % 2</code> produces
the remainder of a division.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>chr_ch <span class="op">=</span> channel</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a> <span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="fl">1..22</span><span class="op">,</span> <span class="st">'X'</span><span class="op">,</span> <span class="st">'Y'</span> <span class="op">)</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a> <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>chr_ch <span class="op">=</span> channel</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="fl">1..22</span><span class="op">,</span> <span class="st">'X'</span><span class="op">,</span> <span class="st">'Y'</span> <span class="op">)</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span><span class="op">(</span> <span class="bu">Number</span> <span class="op">)</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span><span class="op">({</span> it <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">})</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">2</span></span>
<span><span class="fl">4</span></span>
<span><span class="fl">6</span></span>
<span><span class="fl">8</span></span>
<span><span class="fl">10</span></span>
<span><span class="fl">12</span></span>
<span><span class="fl">14</span></span>
<span><span class="fl">16</span></span>
<span><span class="fl">18</span></span>
<span><span class="fl">20</span></span>
<span><span class="fl">22</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="modifying-the-contents-of-a-channel">Modifying the contents of a channel<a class="anchor" aria-label="anchor" href="#modifying-the-contents-of-a-channel"></a>
</h3>
<p>If we want to modify the items in a channel, we can use transforming
operators.</p>
<div class="section level4">
<h4 id="map">map<a class="anchor" aria-label="anchor" href="#map"></a>
</h4>
</div>
<div class="section level4">
<h4 id="applying-a-function-to-items-in-a-channel">Applying a function to items in a channel<a class="anchor" aria-label="anchor" href="#applying-a-function-to-items-in-a-channel"></a>
</h4>
<p>The <code>map</code> operator applies a function of your choosing to
every item in a channel, and returns the items so obtained as a new
channel. The function applied is called the mapping function and is
expressed with a closure <code>{}</code> as shown in the example
below:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>chr <span class="op">=</span> channel</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="st">'chr1'</span><span class="op">,</span> <span class="st">'chr2'</span> <span class="op">)</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span> <span class="op">({</span> it<span class="op">.</span><span class="fu">replaceAll</span><span class="op">(</span><span class="st">"chr"</span><span class="op">,</span><span class="st">""</span><span class="op">)</span> <span class="op">})</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>chr<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>Here the map function uses the groovy string function
<code>replaceAll</code> to remove the chr prefix from each element.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1</span></span>
<span><span class="fl">2</span></span></code></pre>
</div>
<p>We can also use the <code>map</code> operator to transform each
element into a tuple.</p>
<p>In the example below we use the <code>map</code> operator to
transform a channel containing fastq files to a new channel containing a
tuple with the fastq file and the number of reads in the fastq file. We
use the built in <code>countFastq</code> file method to count the number
of records in a FASTQ formatted file.</p>
<p>We can change the default name of the closure parameter keyword from
<code>it</code> to a more meaningful name <code>file</code> using
<code>-&gt;</code>. When we have multiple parameters we can specify the
keywords at the start of the closure,
e.g. <code>file, numreads -&gt;</code>.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>fq_ch <span class="op">=</span> channel</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/yeast/reads/*.fq.gz'</span> <span class="op">)</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span> <span class="op">({</span> file <span class="op">-&gt;</span> <span class="op">[</span>file<span class="op">,</span> file<span class="op">.</span><span class="fu">countFastq</span><span class="op">()]</span> <span class="op">})</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">view</span> <span class="op">({</span> file<span class="op">,</span> numreads <span class="op">-&gt;</span> <span class="st">"file </span><span class="ss">$file</span><span class="st"> contains </span><span class="ss">$numreads</span><span class="st"> reads"</span> <span class="op">})</span></span></code></pre>
</div>
<p>This would produce.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>file data/yeast/reads/ref1_2.fq.gz contains 14677 reads
file data/yeast/reads/etoh60_3_2.fq.gz contains 26254 reads
file data/yeast/reads/temp33_1_2.fq.gz contains 20593 reads
file data/yeast/reads/temp33_2_1.fq.gz contains 15779 reads
file data/yeast/reads/ref2_1.fq.gz contains 20430 reads
[..truncated..]</code></pre>
</div>
<p>We can then add a <code>filter</code> operator to only retain those
fastq files with more than 25000 reads.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>channel</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/yeast/reads/*.fq.gz'</span> <span class="op">)</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span> <span class="op">({</span> file <span class="op">-&gt;</span> <span class="op">[</span>file<span class="op">,</span> file<span class="op">.</span><span class="fu">countFastq</span><span class="op">()]</span> <span class="op">})</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span><span class="op">({</span> file<span class="op">,</span> numreads <span class="op">-&gt;</span> numreads <span class="op">&gt;</span> <span class="dv">25000</span><span class="op">})</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>    <span class="op">.</span><span class="fu">view</span> <span class="op">({</span> file<span class="op">,</span> numreads <span class="op">-&gt;</span> <span class="st">"file </span><span class="ss">$file</span><span class="st"> contains </span><span class="ss">$numreads</span><span class="st"> reads"</span> <span class="op">})</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>file data/yeast/reads/etoh60_3_2.fq.gz contains 26254 reads
file data/yeast/reads/etoh60_3_1.fq.gz contains 26254 reads</code></pre>
</div>
<div id="map-operator" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="map-operator" class="callout-inner">
<h3 class="callout-title">map operator<a class="anchor" aria-label="anchor" href="#map-operator"></a>
</h3>
<div class="callout-content">
<p>Add a <code>map</code> operator to the Nextflow script below to
transform the contents into a tuple with the file and the file’s name,
using the <code>.getName</code> method. The <code>getName</code> method
gives the filename. Finally <code>view</code> the channel contents.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a> channel</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a> <span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/yeast/reads/*.fq.gz'</span> <span class="op">)</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a> <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>ch <span class="op">=</span> channel</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> <span class="st">'data/yeast/reads/*.fq.gz'</span> <span class="op">)</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span> <span class="op">({</span>file <span class="op">-&gt;</span> <span class="op">[</span> file<span class="op">,</span> file<span class="op">.</span><span class="fu">getName</span><span class="op">()</span> <span class="op">]})</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">({</span>file<span class="op">,</span> name <span class="op">-&gt;</span> <span class="st">"file's name: </span><span class="ss">$name</span><span class="st">"</span><span class="op">})</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="converting-a-list-into-multiple-items">Converting a list into multiple items<a class="anchor" aria-label="anchor" href="#converting-a-list-into-multiple-items"></a>
</h4>
<p>The <code>flatten</code> operator transforms a channel in such a way
that every item in a <code>list</code> or <code>tuple</code> is
flattened so that each single entry is emitted as a sole element by the
resulting channel.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>list1 <span class="op">=</span> <span class="op">[</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">]</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>ch <span class="op">=</span> channel</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">(</span>list1<span class="op">)</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1, 2, 3]</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>ch <span class="op">=</span>channel</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">of</span><span class="op">(</span>list1<span class="op">)</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flatten</span><span class="op">()</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>The above snippet prints:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1</span></span>
<span><span class="fl">2</span></span>
<span><span class="fl">3</span></span></code></pre>
</div>
<p>This is similar to the channel factory
<code>Channel.fromList</code>.</p>
</div>
<div class="section level4">
<h4 id="converting-the-contents-of-a-channel-to-a-single-list-item-">Converting the contents of a channel to a single list item.<a class="anchor" aria-label="anchor" href="#converting-the-contents-of-a-channel-to-a-single-list-item-"></a>
</h4>
<p>The reverse of the <code>flatten</code> operator is
<code>collect</code>. The <code>collect</code> operator collects all the
items emitted by a channel to a list and return the resulting object as
a sole emission. This can be extremely useful when combining the results
from the output of multiple processes, or a single process run multiple
times.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>ch <span class="op">=</span> channel</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span> <span class="op">)</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">collect</span><span class="op">()</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>It prints a single value:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1,2,3,4]</code></pre>
</div>
<p>The result of the collect operator is a <code>value</code> channel
and can be used multiple times.</p>
</div>
<div class="section level4">
<h4 id="grouping-contents-of-a-channel-by-a-key-">Grouping contents of a channel by a key.<a class="anchor" aria-label="anchor" href="#grouping-contents-of-a-channel-by-a-key-"></a>
</h4>
<p>The <code>groupTuple</code> operator collects <code>tuples</code> or
<code>lists</code> of values by grouping together the channel elements
that share the same key. Finally it emits a new tuple object for each
distinct key collected.</p>
<p>For example.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>ch <span class="op">=</span> channel</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>     <span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="op">[</span><span class="st">'wt'</span><span class="op">,</span><span class="st">'wt_1.fq'</span><span class="op">],</span> <span class="op">[</span><span class="st">'wt'</span><span class="op">,</span><span class="st">'wt_2.fq'</span><span class="op">],</span> <span class="op">[</span><span class="st">"mut"</span><span class="op">,</span><span class="st">'mut_1.fq'</span><span class="op">],</span> <span class="op">[</span><span class="st">'mut'</span><span class="op">,</span> <span class="st">'mut_2.fq'</span><span class="op">]</span> <span class="op">)</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>     <span class="op">.</span><span class="fu">groupTuple</span><span class="op">()</span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>     <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[wt, [wt_1.fq, wt_1.fq]]
[mut, [mut_1.fq, mut_2.fq]]</code></pre>
</div>
<p>If we know the number of items to be grouped we can use the
<code>groupTuple</code> <code>size</code> parameter. When the specified
size is reached, the tuple is emitted. By default incomplete tuples
(i.e. with less than size grouped items) are discarded (default).</p>
<p>For example.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>ch <span class="op">=</span> channel</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>     <span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="op">[</span><span class="st">'wt'</span><span class="op">,</span><span class="st">'wt_1.fq'</span><span class="op">],</span> <span class="op">[</span><span class="st">'wt'</span><span class="op">,</span><span class="st">'wt_1.fq'</span><span class="op">],</span> <span class="op">[</span><span class="st">"mut"</span><span class="op">,</span><span class="st">'mut_1.fq'</span><span class="op">])</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>     <span class="op">.</span><span class="fu">groupTuple</span><span class="op">(</span>size<span class="op">:</span><span class="dv">2</span><span class="op">)</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a>     <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>outputs,</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[wt, [wt_1.fq, wt_1.fq]]</code></pre>
</div>
<p>This operator is useful to process altogether all elements for which
there’s a common property or a grouping key.</p>
<div id="group-tuple" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="group-tuple" class="callout-inner">
<h3 class="callout-title">Group Tuple<a class="anchor" aria-label="anchor" href="#group-tuple"></a>
</h3>
<div class="callout-content">
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/reads/*.fq.gz'</span><span class="op">)</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>       <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>Modify the Nextflow script above to add the <code>map</code> operator
to create a tuple with the name prefix as the key and the file as the
value using the closure below.</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="op">{</span> file <span class="op">-&gt;</span> <span class="op">[</span> file<span class="op">.</span><span class="fu">getName</span><span class="op">().</span><span class="fu">split</span><span class="op">(</span><span class="st">'_'</span><span class="op">)[</span><span class="dv">0</span><span class="op">],</span> file <span class="op">]</span> <span class="op">}</span></span></code></pre>
</div>
<p>Finally group together all files having the same common prefix using
the <code>groupTuple</code> operator and <code>view</code> the contents
of the channel.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/reads/*.fq.gz'</span><span class="op">)</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span> <span class="op">{</span> file <span class="op">-&gt;</span> <span class="op">[</span> file<span class="op">.</span><span class="fu">getName</span><span class="op">().</span><span class="fu">split</span><span class="op">(</span><span class="st">'_'</span><span class="op">)[</span><span class="dv">0</span><span class="op">],</span> file <span class="op">]</span> <span class="op">}</span></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">groupTuple</span><span class="op">()</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="merging-channels">Merging Channels<a class="anchor" aria-label="anchor" href="#merging-channels"></a>
</h3>
<p>Combining operators allows you to merge channels together. This can
be useful when you want to combine the output channels from multiple
processes to perform another task such as joint QC.</p>
<div class="section level4">
<h4 id="mix">mix<a class="anchor" aria-label="anchor" href="#mix"></a>
</h4>
<p>The <code>mix</code> operator combines the items emitted by two (or
more) channels into a single channel.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>ch1 <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span> <span class="op">)</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>ch2 <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="st">'X'</span><span class="op">,</span><span class="st">'Y'</span> <span class="op">)</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>ch3 <span class="op">=</span> channel<span class="op">.</span><span class="fu">of</span><span class="op">(</span> <span class="st">'mt'</span> <span class="op">)</span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>ch4 <span class="op">=</span> ch1<span class="op">.</span><span class="fu">mix</span><span class="op">(</span>ch2<span class="op">,</span>ch3<span class="op">).</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1</span></span>
<span><span class="fl">2</span></span>
<span><span class="fl">3</span></span>
<span><span class="va">X</span></span>
<span><span class="va">Y</span></span>
<span><span class="va">mt</span></span></code></pre>
</div>
<p>The items emitted by the resulting mixed channel may appear in any
order, regardless of which source channel they came from. Thus, the
following example it could be a possible result of the above example as
well.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1</span></span>
<span><span class="fl">2</span></span>
<span><span class="va">X</span></span>
<span><span class="fl">3</span></span>
<span><span class="va">mt</span></span>
<span><span class="va">Y</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="join">join<a class="anchor" aria-label="anchor" href="#join"></a>
</h4>
<p>The <code>join</code> operator creates a channel that joins together
the items emitted by two channels for which exists a matching key. The
key is defined, by default, as the first element in each item
emitted.</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>reads1_ch <span class="op">=</span> channel</span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">([</span><span class="st">'wt'</span><span class="op">,</span> <span class="st">'wt_1.fq'</span><span class="op">],</span> <span class="op">[</span><span class="st">'mut'</span><span class="op">,</span><span class="st">'mut_1.fq'</span><span class="op">])</span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>reads2_ch<span class="op">=</span> channel</span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>  <span class="op">.</span><span class="fu">of</span><span class="op">([</span><span class="st">'wt'</span><span class="op">,</span> <span class="st">'wt_2.fq'</span><span class="op">],</span> <span class="op">[</span><span class="st">'mut'</span><span class="op">,</span><span class="st">'mut_2.fq'</span><span class="op">])</span></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a>reads_ch <span class="op">=</span> reads1_ch</span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>  <span class="op">.</span><span class="fu">join</span><span class="op">(</span>reads2_ch<span class="op">)</span></span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>The resulting channel emits:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[wt, wt_1.fq, wt_2.fq]
[mut, mut_1.fq, mut_2.fq]</code></pre>
</div>
</div>
</div>
<div class="section level3">
<h3 id="maths-operators">Maths operators<a class="anchor" aria-label="anchor" href="#maths-operators"></a>
</h3>
<p>The maths operators allows you to apply simple math function on
channels.</p>
<p>The maths operators are:</p>
<ul>
<li>count</li>
<li>min</li>
<li>max</li>
<li>sum</li>
<li>toInteger</li>
</ul>
<div class="section level4">
<h4 id="counting-items-in-a-channel">Counting items in a channel<a class="anchor" aria-label="anchor" href="#counting-items-in-a-channel"></a>
</h4>
<p>The <code>count</code> operator creates a channel that emits a single
item: a number that represents the total number of items emitted by the
source channel. For example:</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>ch <span class="op">=</span> channel</span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="fl">1..22</span><span class="op">,</span><span class="st">'X'</span><span class="op">,</span><span class="st">'Y'</span><span class="op">)</span></span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">count</span><span class="op">()</span></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">24</span></span></code></pre>
</div>
</div>
</div>
<div class="section level3">
<h3 id="splitting-items-in-a-channel">Splitting items in a channel<a class="anchor" aria-label="anchor" href="#splitting-items-in-a-channel"></a>
</h3>
<p>Sometimes you want to split the content of a individual item in a
channel, like a file or string, into smaller chunks that can be
processed by downstream operators or processes e.g. items stored in a
CSV file.</p>
<p>Nextflow has a number of splitting operators that can achieve
this:</p>
<ul>
<li>
<a href="https://www.nextflow.io/docs/latest/operator.html#splitcsv" class="external-link">splitCsv</a>:
The splitCsv operator allows you to parse text items emitted by a
channel, that are formatted using the CSV format, and split them into
records or group them into list of records with a specified length.</li>
<li>
<a href="https://www.nextflow.io/docs/latest/operator.html#splitfasta" class="external-link">splitFasta</a>:
The splitFasta operator allows you to split the entries emitted by a
channel, that are formatted using the FASTA format. It returns a channel
which emits a text item for each sequence in the received FASTA
content.</li>
<li>
<a href="https://www.nextflow.io/docs/latest/operator.html#splitfastq" class="external-link">splitFastq</a>:
The splitFastq operator allows you to split the entries emitted by a
channel, that are formatted using the FASTQ format. It returns a channel
which emits a text chunk for each sequence in the received item.</li>
<li>
<a href="https://www.nextflow.io/docs/latest/operator.html#splittext" class="external-link">splitText</a>:
The splitText operator allows you to split multi-line strings or text
file items, emitted by a source channel into chunks containing n lines,
which will be emitted by the resulting channel.</li>
</ul>
<div class="section level4">
<h4 id="splitcsv">splitCsv<a class="anchor" aria-label="anchor" href="#splitcsv"></a>
</h4>
<p>The <code>splitCsv</code> operator allows you to parse text items
emitted by a channel, that are formatted using the CSV format, and split
them into records or group them into list of records with a specified
length. This is useful when you want to use a sample sheet.</p>
<p>In the simplest case just apply the <code>splitCsv</code> operator to
a channel emitting a CSV formatted text files or text entries. For
example:</p>
<p>For the CSV file <code>samples.csv</code>.</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="fu">cat</span> data/yeast/samples.csv</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>sample_id,fastq_1,fastq_2
ref1,data/yeast/reads/ref1_1.fq.gz,data/yeast/reads/ref1_2.fq.gz
ref2,data/yeast/reads/ref2_1.fq.gz,data/yeast/reads/ref2_2.fq.gz</code></pre>
</div>
<p>We can use the <code>splitCsv()</code> operator to split the channel
contaning a CSV file into three elements.</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>csv_ch<span class="op">=</span>channel</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/samples.csv'</span><span class="op">)</span></span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">splitCsv</span><span class="op">()</span></span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>csv_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[sample_id, fastq_1, fastq_2]
[ref1, data/yeast/reads/ref1_1.fq.gz, data/yeast/reads/ref1_2.fq.gz]
[ref2, data/yeast/reads/ref2_1.fq.gz, data/yeast/reads/ref2_2.fq.gz]</code></pre>
</div>
<p>The above example shows hows the CSV file <code>samples.csv</code> is
parsed and is split into three elements.</p>
<div class="section level5">
<h5 id="accessing-values">Accessing values<a class="anchor" aria-label="anchor" href="#accessing-values"></a>
</h5>
<p>Values can be accessed by their positional indexes using the square
brackets syntax<code>[index]</code>. So to access the first column you
would use <code>[0]</code> as shown in the following example:</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a>csv_ch<span class="op">=</span>channel</span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/samples.csv'</span><span class="op">)</span></span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">splitCsv</span><span class="op">()</span></span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a>csv_ch</span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">({</span>it<span class="op">[</span><span class="dv">0</span><span class="op">]})</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">sample_id</span></span>
<span><span class="va">ref1</span></span>
<span><span class="va">ref2</span></span></code></pre>
</div>
</div>
<div class="section level5">
<h5 id="column-headers">Column headers<a class="anchor" aria-label="anchor" href="#column-headers"></a>
</h5>
<p>When the CSV begins with a header line defining the column names, you
can specify the parameter <code>header: true</code> which allows you to
reference each value by its name, as shown in the following example:</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a>csv_ch<span class="op">=</span>channel</span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/samples.csv'</span><span class="op">)</span></span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">splitCsv</span><span class="op">(</span>header<span class="op">:</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a>csv_ch<span class="op">.</span><span class="fu">view</span><span class="op">({</span>it<span class="op">.</span>fastq_1<span class="op">})</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">data</span><span class="op">/</span><span class="va">yeast</span><span class="op">/</span><span class="va">reads</span><span class="op">/</span><span class="va">ref1_1.fq.gz</span></span>
<span><span class="va">data</span><span class="op">/</span><span class="va">yeast</span><span class="op">/</span><span class="va">reads</span><span class="op">/</span><span class="va">ref2_1.fq.gz</span></span></code></pre>
</div>
<div id="parse-a-csv-file" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="parse-a-csv-file" class="callout-inner">
<h3 class="callout-title">Parse a CSV file<a class="anchor" aria-label="anchor" href="#parse-a-csv-file"></a>
</h3>
<div class="callout-content">
<p>Modify the Nextflow script to print the first column
<code>sample_id</code>.</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>csv_ch<span class="op">=</span>channel</span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/samples.csv'</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a> csv_ch<span class="op">=</span>channel</span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>        <span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span><span class="st">'data/yeast/samples.csv'</span><span class="op">)</span></span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>        <span class="op">.</span><span class="fu">splitCsv</span><span class="op">(</span>header<span class="op">:</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" tabindex="-1"></a>csv_ch<span class="op">.</span><span class="fu">view</span><span class="op">({</span>it<span class="op">.</span>sample_id<span class="op">})</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="tab-delimited-files">Tab delimited files<a class="anchor" aria-label="anchor" href="#tab-delimited-files"></a>
</h4>
<p>If you want to split a <code>tab</code> delimited file or file
separated by another character use the <code>sep</code> parameter of the
split <code>splitCsv</code> operator.</p>
<p>For examples,</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">"val1</span><span class="sc">\t</span><span class="st">val2</span><span class="sc">\t</span><span class="st">val3</span><span class="sc">\n</span><span class="st">val4</span><span class="sc">\t</span><span class="st">val5</span><span class="sc">\t</span><span class="st">val6</span><span class="sc">\n</span><span class="st">"</span><span class="op">)</span></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>  <span class="op">.</span><span class="fu">splitCsv</span><span class="op">(</span>sep<span class="op">:</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span><span class="op">)</span></span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[val1, val2, val3]
[val4, val5, val6]</code></pre>
</div>
</div>
</div>
<div class="section level3">
<h3 id="more-resources">More resources<a class="anchor" aria-label="anchor" href="#more-resources"></a>
</h3>
<p>See the operators <a href="https://www.nextflow.io/docs/latest/operator.html" class="external-link">documentation</a>
on the Nextflow web site.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Nextflow <em>operators</em> are methods that allow you to modify,
set or view channels.</li>
<li>Operators can be separated in to several groups; filtering ,
transforming , splitting , combining , forking and Maths operators</li>
<li>To use an operator use the dot notation after the Channel object
e.g. <code>my_ch.view()</code>.</li>
<li>You can parse text items emitted by a channel, that are formatted
using the CSV format, using the <code>splitCsv</code> operator.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-08-reporting"><p>Content from <a href="08-reporting.html">Reporting</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/08-reporting.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I get information about my pipeline run?</li>
<li>How can I see what commands I ran?</li>
<li>How can I create a report from my run?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>View Nextflow pipeline run logs.</li>
<li>Use <code>nextflow log</code> to view more information about a
specific run.</li>
<li>Create an HTML report from a pipeline run.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="nextflow-log"><h2 class="section-heading">Nextflow log<a class="anchor" aria-label="anchor" href="#nextflow-log"></a>
</h2>
<hr class="half-width">
<p>Once a script has run, Nextflow stores a log of all the workflows
executed in the current folder. Similar to an electronic lab book, this
means you have a record of all processing steps and commands run.</p>
<p>You can print Nextflow’s execution history and log information using
the <code>nextflow log</code> command.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> nextflow log</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>TIMESTAMP          	DURATION	RUN NAME               	STATUS	REVISION ID	SESSION ID                          	COMMAND</code></pre>
</div>
<p>This will print a summary of the executions log and runtime
information for all pipelines run. By default, included in the summary,
are the date and time it ran, how long it ran for, the run name, run
status, a revision ID, the session id and the command run on the command
line.</p>
<div id="show-execution-log" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="show-execution-log" class="callout-inner">
<h3 class="callout-title">Show Execution Log<a class="anchor" aria-label="anchor" href="#show-execution-log"></a>
</h3>
<div class="callout-content">
<p>Listing the execution logs of previous invocations of all pipelines
in a directory.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> nextflow log</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The output will look similar to this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>TIMESTAMP          	DURATION	RUN NAME       	STATUS	REVISION ID	SESSION ID                          	COMMAND
2021-03-19 13:45:53	6.5s    	fervent_babbage	OK    	c54a707593 	15487395-443a-4835-9198-229f6ad7a7fd	nextflow run wc.nf
2021-03-19 13:46:53	6.6s    	soggy_miescher 	OK    	c54a707593 	58da0ccf-63f9-42e4-ba4b-1c349348ece5	nextflow run wc.nf --samples 'data/yeast/reads/*.fq.gz'</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="pipeline-execution-report"><h2 class="section-heading">Pipeline execution report<a class="anchor" aria-label="anchor" href="#pipeline-execution-report"></a>
</h2>
<hr class="half-width">
<p>If we want to get more information about an individual run we can add
the run name or session ID to the <code>log</code> command.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> nextflow log tiny_fermat</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">/data/.../work/7b/3753ff13b1fa5348d2d9b6f512153a</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="ex">/data/.../work/c1/56a36d8f498c99ac6cba31e85b3e0c</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="ex">/data/.../work/f7/659c65ef60582d9713252bcfbcc310</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="ex">/data/.../work/82/ba67e3175bd9e6479d4310e5a92f99</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="ex">/data/.../work/e5/2816b9d4e7b402bfdd6597c2c2403d</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="ex">/data/.../work/3b/3485d00b0115f89e4c202eacf82eba</span></span></code></pre>
</div>
<p>This will list the work directory for each process.</p>
<div id="task-id" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="task-id" class="callout-inner">
<h3 class="callout-title">Task ID<a class="anchor" aria-label="anchor" href="#task-id"></a>
</h3>
<div class="callout-content">
<p>The task ID is a a 32 hexadecimal
digit,e.g. <code>3b3485d00b0115f89e4c202eacf82eba</code>. A task’s
unique ID is generated as a 128-bit hash number obtained from a
composition of the task’s:</p>
<ul>
<li>Inputs values</li>
<li>Input files</li>
<li>Command line string</li>
<li>Container ID</li>
<li>Conda environment</li>
<li>Environment modules</li>
<li>Any executed scripts in the bin directory</li>
</ul>
</div>
</div>
</div>
</section><section id="fields"><h2 class="section-heading">Fields<a class="anchor" aria-label="anchor" href="#fields"></a>
</h2>
<hr class="half-width">
<p>If we want to print more metadata we can use the <code>log</code>
command and the option <code>-f</code> (fields) followed by a comma
delimited list of fields. This can be composed to track the provenance
of a workflow result.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> nextflow log tiny_fermat <span class="at">-f</span> <span class="st">'process,exit,hash,duration'</span></span></code></pre>
</div>
<p>Will output the process name, exit status, hash and duration of the
process for the <code>tiny_fermat</code> run to the terminal.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>index	0	7b/3753ff	2s
fastqc	0	c1/56a36d	9.3s
fastqc	0	f7/659c65	9.1s
quant	0	82/ba67e3	2.7s
quant	0	e5/2816b9	3.2s
multiqc	0	3b/3485d0	6.3s</code></pre>
</div>
<p>The complete list of available fields can be retrieved with the
command:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> nextflow log <span class="at">-l</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">attempt</span></span>
<span><span class="va">complete</span></span>
<span><span class="va">container</span></span>
<span><span class="va">cpus</span></span>
<span><span class="va">disk</span></span>
<span><span class="va">duration</span></span>
<span><span class="va">env</span></span>
<span><span class="va">error_action</span></span>
<span><span class="va">exit</span></span>
<span><span class="va">hash</span></span>
<span><span class="va">inv_ctxt</span></span>
<span><span class="va">log</span></span>
<span><span class="va">memory</span></span>
<span><span class="va">module</span></span>
<span><span class="va">name</span></span>
<span><span class="va">native_id</span></span>
<span><span class="va">pcpu</span></span>
<span><span class="va">peak_rss</span></span>
<span><span class="va">peak_vmem</span></span>
<span><span class="va">pmem</span></span>
<span><span class="va">process</span></span>
<span><span class="va">queue</span></span>
<span><span class="va">rchar</span></span>
<span><span class="va">read_bytes</span></span>
<span><span class="va">realtime</span></span>
<span><span class="va">rss</span></span>
<span><span class="va">scratch</span></span>
<span><span class="va">script</span></span>
<span><span class="va">start</span></span>
<span><span class="va">status</span></span>
<span><span class="va">stderr</span></span>
<span><span class="va">stdout</span></span>
<span><span class="va">submit</span></span>
<span><span class="va">syscr</span></span>
<span><span class="va">syscw</span></span>
<span><span class="va">tag</span></span>
<span><span class="va">task_id</span></span>
<span><span class="va">time</span></span>
<span><span class="va">vmem</span></span>
<span><span class="va">vol_ctxt</span></span>
<span><span class="va">wchar</span></span>
<span><span class="va">workdir</span></span>
<span><span class="va">write_bytes</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="script">Script<a class="anchor" aria-label="anchor" href="#script"></a>
</h3>
<p>If we want a log of all the commands executed in the pipeline we can
use the <code>script</code> field. It is important to note that the
resultant output can not be used to run the pipeline steps.</p>
</div>
<div class="section level3">
<h3 id="filtering">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h3>
<p>The output from the <code>log</code> command can be very long. We can
subset the output using the option <code>-F</code> (filter) specifying
the filtering criteria. This will print only those tasks matching a
pattern using the syntax <code>=~/&lt;pattern&gt;/</code>.</p>
<p>For example to filter for process with the name <code>fastqc</code>
we would run:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> nextflow log tiny_fermat <span class="at">-F</span> <span class="st">'process =~ /fastqc/'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/data/.../work/c1/56a36d8f498c99ac6cba31e85b3e0c
/data/.../work/f7/659c65ef60582d9713252bcfbcc310</code></pre>
</div>
<p>This can be useful to locate specific tasks work directories.</p>
<div id="view-run-log" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="view-run-log" class="callout-inner">
<h3 class="callout-title">View run log<a class="anchor" aria-label="anchor" href="#view-run-log"></a>
</h3>
<div class="callout-content">
<p>Use the Nextflow <code>log</code> command specifying a
<code>run name</code> and the fields. name, hash, process and status</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Example solution using run name <code>elegant_descartes</code>.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> nextflow log elegant_descartes <span class="at">-f</span> name,hash,process,status</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="filter-pipeline-run-log" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="filter-pipeline-run-log" class="callout-inner">
<h3 class="callout-title">Filter pipeline run log<a class="anchor" aria-label="anchor" href="#filter-pipeline-run-log"></a>
</h3>
<div class="callout-content">
<p>Use the <code>-F</code> option and a regular expression to filter the
for a specific process e.g. multiqc.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> nextflow log elegant_descartes <span class="at">-f</span> name,hash,process,status <span class="at">-F</span> <span class="st">'process =~ /multiqc/'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="templates"><h2 class="section-heading">Templates<a class="anchor" aria-label="anchor" href="#templates"></a>
</h2>
<hr class="half-width">
<p>The <code>-t</code> option allows a template (string or file) to be
specified. This makes it possible to create a custom report in any text
based format.</p>
<p>For example you could save this markdown snippet to a file
e.g. <code>my-template.md</code>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">MARKDOWN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode markdown" tabindex="0"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">## $name</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>script:</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="in">    $script</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>exist status: $exit</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>task status: $status</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>task folder: $workdir</span></code></pre>
</div>
<p>Then, the following <code>log</code> command will output a markdown
file containing the <code>script</code>, <code>exit status</code> and
<code>folder</code> of all executed tasks:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">$</span> nextflow log elegant_descartes <span class="at">-t</span> my-template.md <span class="op">&gt;</span> execution-report.md</span></code></pre>
</div>
<p>Or, the template file can also be written in HTML.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">HTML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode html" tabindex="0"><code class="sourceCode html"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">h2</span><span class="dt">&gt;</span>${name}<span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>Script:</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">pre</span><span class="dt">&gt;</span>${script}<span class="dt">&lt;/</span><span class="kw">pre</span><span class="dt">&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Exit: ${exit}<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Status: ${status}<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Work dir: ${workdir}<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;</span>Container: ${container}<span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre>
</div>
<p>By saving the above snippet in a file named
<code>template.html</code>, you can run the following command:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">$</span> nextflow log elegant_descartes <span class="at">-t</span> template.html <span class="op">&gt;</span> provenance.html</span></code></pre>
</div>
<p>To view the report open it in a browser.</p>
<div id="generate-an-html-run-report" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="generate-an-html-run-report" class="callout-inner">
<h3 class="callout-title">Generate an HTML run report<a class="anchor" aria-label="anchor" href="#generate-an-html-run-report"></a>
</h3>
<div class="callout-content">
<p>Generate an HTML report for a run using the <code>-t</code> option
and the template.html file.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">$</span> nextflow log elegant_descartes <span class="at">-t</span> template.html <span class="op">&gt;</span> provenance.html</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Nextflow can produce a custom execution report with run information
using the <code>log</code> command.</li>
<li>You can generate a report using the <code>-t</code> option
specifying a template file.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-09-configuration"><p>Content from <a href="09-configuration.html">Nextflow configuration</a></p>
<hr>
<p>Last updated on 2024-05-31 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/09-configuration.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is the difference between the workflow implementation and the
workflow configuration?</li>
<li>How do I configure a Nextflow workflow?</li>
<li>How do I assign different resources to different processes?</li>
<li>How do I separate and provide configuration for different
computational systems?</li>
<li>How do I change configuration settings from the default settings
provided by the workflow?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the difference between workflow implementation and
configuration.</li>
<li>Understand the difference between configuring Nextflow and a
Nextflow script.</li>
<li>Create a Nextflow configuration file.</li>
<li>Understand what a configuration scope is.</li>
<li>Be able to assign resources to a process.</li>
<li>Be able to refine configuration settings using process
selectors.</li>
<li>Be able to group configurations into profiles for use with different
computer infrastructures.</li>
<li>Be able to override existing settings.</li>
<li>Be able to inspect configuration settings before running a
workflow.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="nextflow-configuration"><h2 class="section-heading">Nextflow configuration<a class="anchor" aria-label="anchor" href="#nextflow-configuration"></a>
</h2>
<hr class="half-width">
<p>A key Nextflow feature is the ability to decouple the workflow
implementation, which describes the flow of data and operations to
perform on that data, from the configuration settings required by the
underlying execution platform. This enables the workflow to be portable,
allowing it to run on different computational platforms such as an
institutional HPC or cloud infrastructure, without needing to modify the
workflow implementation.</p>
<p>We have seen earlier that it is possible to provide a
<code>process</code> with directives. These directives are process
specific configuration settings. Similarly, we have also provided
parameters to our workflow which are parameter configuration settings.
These configuration settings can be separated from the workflow
implementation, into a configuration file.</p>
</section><section id="configuration-files"><h2 class="section-heading">Configuration files<a class="anchor" aria-label="anchor" href="#configuration-files"></a>
</h2>
<hr class="half-width">
<p>Settings in a configuration file are sets of name-value pairs
(<code>name = value</code>). The <code>name</code> is a specific
property to set, while the <code>value</code> can be anything you can
assign to a variable (see <a href="02-nextflow_scripting.html">nextflow
scripting</a>), for example, strings, booleans, or other variables. It
is also possible to access any variable defined in the host environment
such as <code>$PATH</code>, <code>$HOME</code>, <code>$PWD</code>,
etc.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">// nextflow.config</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>my_home_dir <span class="op">=</span> <span class="st">"</span><span class="ss">$HOME</span><span class="st">"</span></span></code></pre>
</div>
<div id="accessing-variables-in-your-configuration-file" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="accessing-variables-in-your-configuration-file" class="callout-inner">
<h3 class="callout-title">Accessing variables in your configuration
file<a class="anchor" aria-label="anchor" href="#accessing-variables-in-your-configuration-file"></a>
</h3>
<div class="callout-content">
<p>Generally, variables and functions defined in a configuration file
are not accessible from the workflow script. Only variables defined
using the <code>params</code> scope and the <code>env</code> scope
(without <code>env</code> prefix) can be accessed from the workflow
script.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="fu">MY_PROCESS</span><span class="op">(</span> params<span class="op">.</span>input <span class="op">)</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>Settings are also partitioned into scopes, which govern the behaviour
of different elements of the workflow. For example, workflow parameters
are governed from the <code>params</code> scope, while process
directives are governed from the <code>process</code> scope. A full list
of the available scopes can be found in the <a href="https://www.nextflow.io/docs/latest/config.html#config-scopes" class="external-link">documentation</a>.
It is also possible to define your own scope.</p>
<p>Configuration settings for a workflow are often stored in the file
<code>nextflow.config</code> which is in the same directory as the
workflow script. Configuration can be written in either of two ways. The
first is using dot notation, and the second is using brace notation.
Both forms of notation can be used in the same configuration file.</p>
<p>An example of dot notation:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>params<span class="op">.</span>input <span class="op">=</span> <span class="st">''</span>             <span class="co">// The workflow parameter "input" is assigned an empty string to use as a default value</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>params<span class="op">.</span>outdir <span class="op">=</span> <span class="st">'./results'</span>   <span class="co">// The workflow parameter "outdir" is assigned the value './results' to use by default.</span></span></code></pre>
</div>
<p>An example of brace notation:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>params <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    input  <span class="op">=</span> <span class="st">''</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    outdir <span class="op">=</span> <span class="st">'./results'</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>Configuration files can also be separated into multiple files and
included into another using the <code>includeConfig</code>
statement.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">// nextflow.config</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>params <span class="op">{</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    input  <span class="op">=</span> <span class="st">''</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    outdir <span class="op">=</span> <span class="st">'./results'</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>includeConfig <span class="st">'system_resources.config'</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">// system_resources.config</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>process <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    cpus <span class="op">=</span> <span class="dv">1</span>    <span class="co">// default cpu usage</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    time <span class="op">=</span> <span class="st">'1h'</span> <span class="co">// default time limit</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</section><section id="how-configuration-files-are-combined"><h2 class="section-heading">How configuration files are combined<a class="anchor" aria-label="anchor" href="#how-configuration-files-are-combined"></a>
</h2>
<hr class="half-width">
<p>Configuration settings can be spread across several files. This also
allows settings to be overridden by other configuration files. The
priority of a setting is determined by the following order, ranked from
highest to lowest.</p>
<ol style="list-style-type: decimal">
<li>Parameters specified on the command line
(<code>--param_name value</code>).</li>
<li>Parameters provided using the <code>-params-file</code> option.</li>
<li>Config file specified using the <code>-c</code> my_config
option.</li>
<li>The config file named <code>nextflow.config</code> in the current
directory.</li>
<li>The config file named <code>nextflow.config</code> in the workflow
project directory (<code>$projectDir</code>: the directory where the
script to be run is located).</li>
<li>The config file <code>$HOME/.nextflow/config</code>.</li>
<li>Values defined within the workflow script itself (e.g.,
<code>main.nf</code>).</li>
</ol>
<p>If configuration is provided by more than one of these methods,
configuration is merged giving higher priority to configuration provided
higher in the list.</p>
<p>Existing configuration can be completely ignored by using
<code>-C &lt;custom.config&gt;</code> to use only configuration provided
in the <code>custom.config</code> file.</p>
<div id="configuring-nextflow-vs-configuring-a-nextflow-workflow" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="configuring-nextflow-vs-configuring-a-nextflow-workflow" class="callout-inner">
<h3 class="callout-title">Configuring Nextflow vs Configuring a Nextflow
workflow<a class="anchor" aria-label="anchor" href="#configuring-nextflow-vs-configuring-a-nextflow-workflow"></a>
</h3>
<div class="callout-content">
<p>Parameters starting with a single dash <code>-</code> (e.g.,
<code>-c my_config.config</code>) are configuration options for
<code>nextflow</code>, while parameters starting with a double dash
<code>--</code> (e.g., <code>--outdir</code>) are workflow parameters
defined in the <code>params</code> scope.</p>
<p>The majority of Nextflow configuration settings must be provided on
the command-line, however a handful of settings can also be provided
within a configuration file, such as
<code>workdir = '/path/to/work/dir'</code>
(<code>-w /path/to/work/dir</code>) or <code>resume = true</code>
(<code>-resume</code>), and do not belong to a configuration scope.</p>
</div>
</div>
</div>
<div id="determine-script-output" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="determine-script-output" class="callout-inner">
<h3 class="callout-title">Determine script output<a class="anchor" aria-label="anchor" href="#determine-script-output"></a>
</h3>
<div class="callout-content">
<p>Determine the outcome of the following script executions. Given the
script <code>print_message.nf</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>params<span class="op">.</span>message <span class="op">=</span> <span class="st">'hello'</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="fu">PRINT_MESSAGE</span><span class="op">(</span>params<span class="op">.</span>message<span class="op">)</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>process PRINT_MESSAGE <span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    echo <span class="kw">true</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    val my_message</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="st">    echo </span><span class="ss">$my_message</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>and configuration (<code>print_message.config</code>):</p>
<pre><code><span><span class="va">params.message</span> <span class="op">=</span> <span class="st">'Are you tired?'</span></span></code></pre>
<p>What is the outcome of the following commands?</p>
<ol style="list-style-type: decimal">
<li><code>nextflow run print_message.nf</code></li>
<li><code>nextflow run print_message.nf --message '¿Que tal?'</code></li>
<li><code>nextflow run print_message.nf -c print_message.config</code></li>
<li><code>nextflow run print_message.nf -c print_message.config --message '¿Que tal?'</code></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>‘hello’ - Workflow script uses the value in
<code>print_message.nf</code>
</li>
<li>‘¿Que tal?’ - The command-line parameter overrides the script
setting.</li>
<li>‘Are you tired?’ - The configuration overrides the script
setting</li>
<li>‘¿Que tal?’ - The command-line parameter overrides both the script
and configuration settings.</li>
</ol>
</div>
</div>
</div>
</div>
</section><section id="configuring-process-behaviour"><h2 class="section-heading">Configuring process behaviour<a class="anchor" aria-label="anchor" href="#configuring-process-behaviour"></a>
</h2>
<hr class="half-width">
<p>Earlier we saw that <code>process</code> directives allow the
specification of settings for the task execution such as
<code>cpus</code>, <code>memory</code>, <code>conda</code> and other
resources in the pipeline script. This is useful when prototyping a
small workflow script, however this ties the configuration to the
workflow, making it less portable. A good practice is to separate the
process configuration settings into another file.</p>
<p>The <code>process</code> configuration scope allows the setting of
any process directives in the Nextflow configuration file.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">// nextflow.config</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>process <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    cpus <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    memory <span class="op">=</span> <span class="fl">8.</span>GB</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    time <span class="op">=</span> <span class="st">'1 hour'</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    publishDir <span class="op">=</span> <span class="op">[</span> path<span class="op">:</span> params<span class="op">.</span>outdir<span class="op">,</span> mode<span class="op">:</span> <span class="st">'copy'</span> <span class="op">]</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div id="unit-values" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="unit-values" class="callout-inner">
<h3 class="callout-title">Unit values<a class="anchor" aria-label="anchor" href="#unit-values"></a>
</h3>
<div class="callout-content">
<p>Memory and time duration units can be specified either using a string
based notation in which the digit(s) and the unit can be separated by a
space character, or by using the numeric notation in which the digit(s)
and the unit are separated by a dot character and not enclosed by quote
characters.</p>
<table class="table">
<thead><tr class="header">
<th>String syntax</th>
<th>Numeric syntax</th>
<th>Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>‘10 KB’</td>
<td>10.KB</td>
<td>10240 bytes</td>
</tr>
<tr class="even">
<td>‘500 MB’</td>
<td>500.MB</td>
<td>524288000 bytes</td>
</tr>
<tr class="odd">
<td>‘1 min’</td>
<td>1.min</td>
<td>60 seconds</td>
</tr>
<tr class="even">
<td>‘1 hour 25 sec’</td>
<td>-</td>
<td>1 hour and 25 seconds</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>These settings are applied to all processes in the workflow. A
process selector can be used to apply the configuration to a specific
process or group of processes.</p>
<div class="section level3">
<h3 id="process-selectors">Process selectors<a class="anchor" aria-label="anchor" href="#process-selectors"></a>
</h3>
<p>The resources for a specific process can be defined using
<code>withName:</code> followed by the process name e.g.,
<code>'FASTQC'</code>, and the directives within curly braces. For
example, we can specify different <code>cpus</code> and
<code>memory</code> resources for the processes <code>INDEX</code> and
<code>FASTQC</code> as follows:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co">// process_resources.config</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>process <span class="op">{</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    withName<span class="op">:</span> INDEX <span class="op">{</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>        cpus <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>        memory <span class="op">=</span> <span class="fl">8.</span>GB</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    withName<span class="op">:</span> FASTQC <span class="op">{</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>        cpus <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>        memory <span class="op">=</span> <span class="fl">4.</span>GB</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>When a workflow has many processes, it is inconvenient to specify
directives for all processes individually, especially if directives are
repeated for groups of processes. A helpful strategy is to annotate the
processes using the <code>label</code> directive (processes can have
multiple labels). The <code>withLabel</code> selector then allows the
configuration of all processes annotated with a specific label, as shown
below:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co">// configuration_process_labels.nf</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>process P1 <span class="op">{</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    label <span class="st">"big_mem"</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="st">    echo P1: Using </span><span class="ss">$task</span><span class="op">.</span><span class="ss">cpus</span><span class="st"> cpus and </span><span class="ss">$task</span><span class="op">.</span><span class="ss">memory</span><span class="st"> memory.</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>process P2 <span class="op">{</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    label <span class="st">"big_mem"</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="st">    echo P2: Using </span><span class="ss">$task</span><span class="op">.</span><span class="ss">cpus</span><span class="st"> cpus and </span><span class="ss">$task</span><span class="op">.</span><span class="ss">memory</span><span class="st"> memory.</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>    <span class="fu">P1</span><span class="op">()</span></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>    <span class="fu">P2</span><span class="op">()</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co">// configuration_process-labels.config</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>process <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    withLabel<span class="op">:</span> big_mem <span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>        cpus <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>        memory <span class="op">=</span> <span class="fl">64.</span>GB</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>Another strategy is to use process selector expressions. Both
<code>withName:</code> and <code>withLabel:</code> allow the use of
regular expressions to apply the same configuration to all processes
matching a pattern. Regular expressions must be quoted, unlike simple
process names or labels.</p>
<ul>
<li>The <code>|</code> matches either-or, e.g.,
<code>withName: 'INDEX|FASTQC'</code> applies the configuration to any
process matching the name <code>INDEX</code> or
<code>FASTQC</code>.</li>
<li>The <code>!</code> inverts a selector, e.g.,
<code>withLabel: '!small_mem'</code> applies the configuration to any
process without the <code>small_mem</code> label.</li>
<li>The <code>.*</code> matches any number of characters, e.g.,
<code>withName: 'NFCORE_RNASEQ:RNA_SEQ:BAM_SORT:.*'</code> matches all
processes of the workflow
<code>NFCORE_RNASEQ:RNA_SEQ:BAM_SORT</code>.</li>
</ul>
<p>A regular expression cheat-sheet can be found <a href="https://www.jrebel.com/system/files/regular-expressions-cheat-sheet.pdf" class="external-link">here</a>
if you would like to write more expressive expressions.</p>
<div class="section level4">
<h4 id="selector-priority">Selector priority<a class="anchor" aria-label="anchor" href="#selector-priority"></a>
</h4>
<p>When mixing generic process configuration and selectors, the
following priority rules are applied (from highest to lowest):</p>
<ol style="list-style-type: decimal">
<li>
<code>withName</code> selector definition.</li>
<li>
<code>withLabel</code> selector definition.</li>
<li>Process specific directive defined in the workflow script.</li>
<li>Process generic <code>process</code> configuration.</li>
</ol>
<div id="process-selectors-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="process-selectors-1" class="callout-inner">
<h3 class="callout-title">Process selectors<a class="anchor" aria-label="anchor" href="#process-selectors-1"></a>
</h3>
<div class="callout-content">
<p>Create a Nextflow config, <code>process-selector.config</code>,
specifying different <code>cpus</code> and <code>memory</code> resources
for the two processes <code>P1</code> (cpus 1 and memory 2.GB) and
<code>P2</code> (cpus 2 and memory 1.GB), where <code>P1</code> and
<code>P2</code> are defined as follows:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co">// process-selector.nf</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>process P1 <span class="op">{</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    echo <span class="kw">true</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="st">    echo P1: Using </span><span class="ss">$task</span><span class="op">.</span><span class="ss">cpus</span><span class="st"> cpus and </span><span class="ss">$task</span><span class="op">.</span><span class="ss">memory</span><span class="st"> memory.</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>process P2 <span class="op">{</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    echo <span class="kw">true</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="st">    echo P2: Using </span><span class="ss">$task</span><span class="op">.</span><span class="ss">cpus</span><span class="st"> cpus and </span><span class="ss">$task</span><span class="op">.</span><span class="ss">memory</span><span class="st"> memory.</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>   <span class="fu">P1</span><span class="op">()</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>   <span class="fu">P2</span><span class="op">()</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">// process-selector.config</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>process <span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    withName<span class="op">:</span> P1 <span class="op">{</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>        cpus <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>        memory <span class="op">=</span> <span class="fl">2.</span>GB</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>    withName<span class="op">:</span> P2 <span class="op">{</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>        cpus <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>        memory <span class="op">=</span> <span class="fl">1.</span>GB</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> nextflow run process-selector.nf <span class="at">-c</span> process-selector.config <span class="at">-process.debug</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0

Launching `process-selector.nf` [clever_borg] -
revision: e765b9e62d
executor &gt;  local (2)
[de/86cef0] process &gt; P1 [100%] 1 of 1 ✔
[bf/8b332e] process &gt; P2 [100%] 1 of 1 ✔
P2: Using 2 cpus and 1 GB memory.

P1: Using 1 cpus and 2 GB memory.</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="dynamic-expressions">Dynamic expressions<a class="anchor" aria-label="anchor" href="#dynamic-expressions"></a>
</h4>
<p>A common scenario is that configuration settings may depend on the
data being processed. Such settings can be dynamically expressed using a
closure. For example, we can specify the <code>memory</code> required as
a multiple of the number of <code>cpus</code>. Similarly, we can publish
results to a subfolder based on the sample name.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>process FASTQC <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>sample<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="st">    fastqc -t </span><span class="ss">$task</span><span class="op">.</span><span class="ss">cpus</span><span class="st"> </span><span class="ss">$reads</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co">// nextflow.config</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>process <span class="op">{</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    withName<span class="op">:</span> FASTQC <span class="op">{</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>        cpus <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>        memory <span class="op">=</span> <span class="op">{</span> <span class="fl">2.</span>GB <span class="op">*</span> task<span class="op">.</span>cpus <span class="op">}</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>        publishDir <span class="op">=</span> <span class="op">{</span> <span class="st">"fastqc/</span><span class="ss">$sample</span><span class="st">"</span> <span class="op">}</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</section><section id="configuring-execution-platforms"><h2 class="section-heading">Configuring execution platforms<a class="anchor" aria-label="anchor" href="#configuring-execution-platforms"></a>
</h2>
<hr class="half-width">
<p>Nextflow supports a wide range of execution platforms, from running
locally, to running on HPC clusters or cloud infrastructures. See <a href="https://www.nextflow.io/docs/latest/executor.html" class="external-link">https://www.nextflow.io/docs/latest/executor.html</a>
for the full list of supported executors.</p>
<figure><img src="fig/nf-executors.png" title="digram of different nextflow-executors" alt="A diagram illustrating the different executors available in Nextflow. The diagram shows a configuration file feeding into Nextflow, which has both local and grid executors. The local executor connects to the Local OS and a standalone computer, while the grid executor connects to a batch scheduler and NFS, which further connects to various computing resources such as UNIVA, SLURM, Platform Computing, PBS Works, Kubernetes, and Amazon Web Services." class="figure mx-auto d-block"><div class="figcaption">A diagram illustrating the different executors
available in Nextflow. The diagram shows a configuration file feeding
into Nextflow, which has both local and grid executors. The local
executor connects to the Local OS and a standalone computer, while the
grid executor connects to a batch scheduler and NFS, which further
connects to various computing resources such as UNIVA, SLURM, Platform
Computing, PBS Works, Kubernetes, and Amazon Web Services.</div>
</figure><p>The default executor configuration is defined within the
<code>executor</code> scope (<a href="https://www.nextflow.io/docs/latest/config.html#scope-executor" class="external-link">https://www.nextflow.io/docs/latest/config.html#scope-executor</a>).
For example, in the config below we specify the executor as Sun Grid
Engine, <code>sge</code> and the number of tasks the executor will
handle in a parallel manner (<code>queueSize</code>) to 10.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co">// nextflow.config</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>executor <span class="op">{</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    name <span class="op">=</span> <span class="st">'sge'</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    queueSize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>The <code>process.executor</code> directive allows you to override
the executor to be used by a specific process. This can be useful, for
example, when there are short running tasks that can be run locally, and
are unsuitable for submission to HPC executors (check for guidelines on
best practice use of your execution system). Other process directives
such as <code>process.clusterOptions</code>, <code>process.queue</code>,
and <code>process.machineType</code> can be also be used to further
configure processes depending on the executor used.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co">//nextflow.config</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>executor <span class="op">{</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    name <span class="op">=</span> <span class="st">'sge'</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    queueSize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>process <span class="op">{</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>    withLabel<span class="op">:</span> <span class="st">'short'</span> <span class="op">{</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>        executor <span class="op">=</span> <span class="st">'local'</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</section><section id="configuring-software-requirements"><h2 class="section-heading">Configuring software requirements<a class="anchor" aria-label="anchor" href="#configuring-software-requirements"></a>
</h2>
<hr class="half-width">
<p>An important feature of Nextflow is the ability to manage software
using different technologies. It supports the Conda package management
system, and container engines such as Docker, Singularity, Podman,
Charliecloud, and Shifter. These technologies allow one to package tools
and their dependencies into a software environment such that the tools
will always work as long as the environment can be loaded. This
facilitates portable and reproducible workflows. Software environment
specification is managed from the <code>process</code> scope, allowing
the use of process selectors to manage which processes load which
software environment. Each technology also has its own scope to provide
further technology specific configuration settings.</p>
<div class="section level3">
<h3 id="software-configuration-using-conda">Software configuration using Conda<a class="anchor" aria-label="anchor" href="#software-configuration-using-conda"></a>
</h3>
<p>Conda is a software package and environment management system that
runs on Linux, Windows, and Mac OS. Software packages are bundled into
Conda environments along with their dependencies for a particular
operating system (Not all software is supported on all operating
systems). Software packages are tied to conda channels, for example,
bioinformatic software packages are found and installed from the
BioConda channel.</p>
<p>A Conda environment can be configured in several ways:</p>
<ul>
<li>Provide a path to an existing Conda environment.</li>
<li>Provide a path to a Conda environment specification file (written in
YAML).</li>
<li>Specify the software package(s) using the
<code>&lt;channel&gt;::&lt;package_name&gt;=&lt;version&gt;</code>
syntax (separated by spaces), which then builds the Conda environment
when the process is run.</li>
</ul>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>process <span class="op">{</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>    conda <span class="op">=</span> <span class="st">"/home/user/miniconda3/envs/my_conda_env"</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>    withName<span class="op">:</span> FASTQC <span class="op">{</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>        conda <span class="op">=</span> <span class="st">"environment.yml"</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>    withName<span class="op">:</span> SALMON <span class="op">{</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>        conda <span class="op">=</span> <span class="st">"bioconda::salmon=1.5.2"</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>There is an optional <code>conda</code> scope which allows you to
control the creation of a Conda environment by the Conda package
manager. For example, <code>conda.cacheDir</code> specifies the path
where the Conda environments are stored. By default this is in
<code>conda</code> folder of the <code>work</code> directory.</p>

<div id="define-a-software-requirement-in-the-configuration-file-using-conda" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="define-a-software-requirement-in-the-configuration-file-using-conda" class="callout-inner">
<h3 class="callout-title">Define a software requirement in the
configuration file using conda<a class="anchor" aria-label="anchor" href="#define-a-software-requirement-in-the-configuration-file-using-conda"></a>
</h3>
<div class="callout-content">
<p>We are going to define a software requirement using the “conda”
directive.</p>
<p>The software we are going to uses is <code>fastp</code>, a tool used
for fast processing of next-generation sequencing data (like RNA or DNA
sequences).</p>
<p>Each time the <code>process</code> is called we are going to run
<code>fastp -A -i ${read} -o out.fq 2&gt;&amp;1</code></p>
<ul>
<li>
<code>fastp</code> is the main command that invokes the fastp
program.</li>
<li>-A: option tells fastp to automatically detect and trim adapters.
Adapters are short, artificially added sequences used in sequencing that
are not part of the target DNA or RNA. -i ${read}:</li>
<li>The <code>-i</code> flag specifies the input file.
<code>${read}</code> represents a nextflow variable that contains the
path to the sequencing reads.</li>
<li>
<code>-o</code>: The <code>-o</code> flag specifies the output file.
In this case, the processed sequencing data will be written to a file
named <code>out.fq</code>.</li>
<li>
<code>2&gt;&amp;1</code>: This is a shell redirection command, it
means that both the regular output and error messages will be sent to
the console.</li>
</ul>
<ol style="list-style-type: decimal">
<li><p>Create a config file for the Nextflow script
<code>configuration_fastp.nf</code>.</p></li>
<li><p>Add a conda directive for the process name <code>FASTP</code>
that includes the bioconda package <code>fastp</code>, version
0.12.4-0.</p></li>
</ol>
<p><strong>Hint</strong> You can specify the conda packages using the
syntax
<code>&lt;channel&gt;::&lt;package_name&gt;=&lt;version&gt;</code>
e.g. <code>bioconda::salmon=1.5.2</code></p>
<ol start="3" style="list-style-type: decimal">
<li>Run the Nextflow script <code>configure_fastp.nf</code> with the
configuration file using the <code>-c</code> option.</li>
</ol>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co">// configuration_fastp.nf</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>params<span class="op">.</span>input <span class="op">=</span> <span class="st">"data/yeast/reads/ref1_1.fq.gz"</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>    <span class="fu">FASTP</span><span class="op">(</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>input <span class="op">)</span> <span class="op">).</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>process FASTP <span class="op">{</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>   input<span class="op">:</span></span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>   path read</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>   output<span class="op">:</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>   stdout</span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a>   script<span class="op">:</span></span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a>   <span class="st">"""</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a><span class="st">   fastp -A -i </span><span class="ss">${</span>read<span class="ss">}</span><span class="st"> -o out.fq 2&gt;&amp;1</span></span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a><span class="st">   """</span></span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co">// fastp.config</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>process <span class="op">{</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>    withName<span class="op">:</span> <span class="st">'FASTP'</span> <span class="op">{</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>        conda <span class="op">=</span> <span class="st">"bioconda::fastp=0.12.4-0"</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">nextflow</span> run configure_fastp.nf <span class="at">-c</span> fastp.config</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `configuration_fastp.nf` [berserk_jepsen] - revision: 28fadd2486
executor &gt;  local (1)
[c1/c207d5] process &gt; FASTP (1) [100%] 1 of 1 ✔
Creating Conda env: bioconda::fastp=0.12.4-0 [cache /home/training/work/conda/env-a7a3a0d820eb46bc41ebf4f72d955e5f]
ref1_1.fq.gz 58708
Read1 before filtering:
total reads: 14677
total bases: 1482377

Q20 bases: 1466210(98.9094%)
Q30 bases: 1415997(95.5221%)

Read1 after filtering:
total reads: 14671
total bases: 1481771
Q20 bases: 1465900(98.9289%)
Q30 bases: 1415769(95.5457%)

Filtering result:
reads passed filter: 14671
reads failed due to low quality: 6
reads failed due to too many N: 0
reads failed due to too short: 0

JSON report: fastp.json
HTML report: fastp.html</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="software-configuration-using-docker">Software configuration using Docker<a class="anchor" aria-label="anchor" href="#software-configuration-using-docker"></a>
</h3>
<p>Docker is a container technology. Container images are lightweight,
standalone, executable package of software that includes everything
needed to run an application: code, runtime, system tools, system
libraries and settings. Containerized software is intended to run the
same regardless of the underlying infrastructure, unlike other package
management technologies which are operating system dependant (See the <a href="https://doi.org/10.1038/nbt.3820" class="external-link">published article on
Nextflow</a>). For each container image used, Nextflow uses Docker to
spawn an independent and isolated container instance for each process
task.</p>
<p>To use Docker, we must provide a container image path using the
<code>process.container</code> directive, and also enable docker in the
docker scope, <code>docker.enabled = true</code>. A container image path
takes the form
<code>(protocol://)registry/repository/image:version--build</code>. By
default, Docker containers run software using a privileged user. This
can cause issues, and so it is also a good idea to supply your user and
group via the <code>docker.runOptions</code>.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>process<span class="op">.</span>container <span class="op">=</span> <span class="st">'quay.io/biocontainers/salmon:1.5.2--h84f40af_0'</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>docker<span class="op">.</span>enabled <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>docker<span class="op">.</span>runOptions <span class="op">=</span> <span class="st">'-u $(id -u):$(id -g)'</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="software-configuration-using-singularity">Software configuration using Singularity<a class="anchor" aria-label="anchor" href="#software-configuration-using-singularity"></a>
</h3>
<p>Singularity is another container technology, commonly used on HPC
clusters. It is different to Docker in several ways. The primary
differences are that processes are run as the user, and certain
directories are automatically “mounted” (made available) in the
container instance. Singularity also supports building Singularity
images from Docker images, allowing Docker image paths to be used as
values for <code>process.container</code>.</p>
<p>Singularity is enabled in a similar manner to Docker. A container
image path must be provided using <code>process.container</code> and
singularity enabled using <code>singularity.enabled = true</code>.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>process<span class="op">.</span>container <span class="op">=</span> <span class="st">'https://depot.galaxyproject.org/singularity/salmon:1.5.2--h84f40af_0'</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>singularity<span class="op">.</span>enabled <span class="op">=</span> <span class="kw">true</span></span></code></pre>
</div>
<div id="container-protocols" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="container-protocols" class="callout-inner">
<h3 class="callout-title">Container protocols<a class="anchor" aria-label="anchor" href="#container-protocols"></a>
</h3>
<div class="callout-content">
<p>The following protocols are supported:</p>
<ul>
<li>
<code>docker://</code>: download the container image from the Docker
Hub and convert it to the Singularity format (default).</li>
<li>
<code>library://</code>: download the container image from the
Singularity Library service.</li>
<li>
<code>shub://</code>: download the container image from the
Singularity Hub.</li>
<li>
<code>docker-daemon://</code>: pull the container image from a local
Docker installation and convert it to a Singularity image file.</li>
<li>
<code>https://</code>: download the singularity image from the given
URL.</li>
<li>
<code>file://</code>: use a singularity image on local computer
storage.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section id="configuration-profiles"><h2 class="section-heading">Configuration profiles<a class="anchor" aria-label="anchor" href="#configuration-profiles"></a>
</h2>
<hr class="half-width">
<p>One of the most powerful features of Nextflow configuration is to
predefine multiple configurations or <code>profiles</code> for different
execution platforms. This allows a group of predefined settings to be
called with a short invocation,
<code>-profile &lt;profile name&gt;</code>.</p>
<p>Configuration profiles are defined in the <code>profiles</code>
scope, which group the attributes that belong to the same profile using
a common prefix.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co">//configuration_profiles.config</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>profiles <span class="op">{</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>    standard <span class="op">{</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>        params<span class="op">.</span>genome <span class="op">=</span> <span class="st">'/local/path/ref.fasta'</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>        process<span class="op">.</span>executor <span class="op">=</span> <span class="st">'local'</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>    cluster <span class="op">{</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>        params<span class="op">.</span>genome <span class="op">=</span> <span class="st">'/data/stared/ref.fasta'</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>        process<span class="op">.</span>executor <span class="op">=</span> <span class="st">'sge'</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>        process<span class="op">.</span>queue <span class="op">=</span> <span class="st">'long'</span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>        process<span class="op">.</span>memory <span class="op">=</span> <span class="st">'10GB'</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>        process<span class="op">.</span>conda <span class="op">=</span> <span class="st">'/some/path/env.yml'</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>    cloud <span class="op">{</span></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>        params<span class="op">.</span>genome <span class="op">=</span> <span class="st">'/data/stared/ref.fasta'</span></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>        process<span class="op">.</span>executor <span class="op">=</span> <span class="st">'awsbatch'</span></span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>        process<span class="op">.</span>container <span class="op">=</span> <span class="st">'cbcrg/imagex'</span></span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>        docker<span class="op">.</span>enabled <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>This configuration defines three different profiles:
<code>standard</code>, <code>cluster</code> and <code>cloud</code> that
set different process configuration strategies depending on the target
execution platform. By convention the standard profile is implicitly
used when no other profile is specified by the user. To enable a
specific profile use <code>-profile</code> option followed by the
profile name:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">nextflow</span> run <span class="op">&lt;</span>your script<span class="op">&gt;</span> -profile cluster</span></code></pre>
</div>
<div id="configuration-order" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="configuration-order" class="callout-inner">
<h3 class="callout-title">Configuration order<a class="anchor" aria-label="anchor" href="#configuration-order"></a>
</h3>
<div class="callout-content">
<p>Settings from profiles will override general settings in the
configuration file. However, it is also important to remember that
configuration is evaluated in the order it is read in. For example, in
the following example, the <code>publishDir</code> directive will always
take the value ‘results’ even when the profile <code>hpc</code> is used.
This is because the setting is evaluated before Nextflow knows about the
<code>hpc</code> profile. If the <code>publishDir</code> directive is
moved to after the <code>profiles</code> scope, then
<code>publishDir</code> will use the correct value of
<code>params.results</code>.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>params<span class="op">.</span>results <span class="op">=</span> <span class="st">'results'</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>process<span class="op">.</span>publishDir <span class="op">=</span> params<span class="op">.</span>results</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>profiles <span class="op">{</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>    hpc <span class="op">{</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>        params<span class="op">.</span>results <span class="op">=</span> <span class="st">'/long/term/storage/results'</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Nextflow configuration can be managed using a Nextflow configuration
file.</li>
<li>Nextflow configuration files are plain text files containing a set
of properties.</li>
<li>You can define process specific settings, such as cpus and memory,
within the <code>process</code> scope.</li>
<li>You can assign different resources to different processes using the
process selectors <code>withName</code> or <code>withLabel</code>.</li>
<li>You can define a profile for different configurations using the
<code>profiles</code> scope. These profiles can be selected when
launching a pipeline execution by using the <code>-profile</code>
command-line option</li>
<li>Nextflow configuration settings are evaluated in the order they are
read-in.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-10-workflow_checkpoint_caching"><p>Content from <a href="10-workflow_checkpoint_caching.html">Workflow caching and checkpointing</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/10-workflow_checkpoint_caching.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I restart a Nextflow workflow after an error?</li>
<li>How can I add new data to a workflow without starting from the
beginning?</li>
<li>Where can I find intermediate data and results?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Resume a Nextflow workflow using the <code>-resume</code>
option.</li>
<li>Restart a Nextflow workflow using new data.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>A key feature of workflow management systems, like Nextflow, is
re-entrancy, which is the ability to restart a pipeline after an error
from the last successfully executed process. Re-entrancy enables time
consuming successfully completed steps, such as index creation, to be
skipped when adding more data to a pipeline. This in turn leads to
faster prototyping and development of workflows, and faster analyses of
additional data. Nextflow achieves re-entrancy by automatically keeping
track of all the processes executed in your pipeline via caching and
checkpointing.</p>
<section id="resume"><h2 class="section-heading">Resume<a class="anchor" aria-label="anchor" href="#resume"></a>
</h2>
<hr class="half-width">
<p>To restart from the last successfully executed process we add the
command line option <code>-resume</code> to the Nextflow command.</p>
<p>For example, the command below would resume the
<code>word_count.nf</code> script from the last successful process.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> nextflow run word_count.nf <span class="at">--input</span> <span class="st">'data/yeast/reads/ref1*.fq.gz'</span> <span class="at">-resume</span></span></code></pre>
</div>
<p>We can see in the output that the results from the process
<code>NUM_LINES</code> has been retrieved from the cache.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Launching `word_count.nf` [condescending_dalembert] - revision: fede04a544
[c9/2597d5] process &gt; NUM_LINES (1) [100%] 2 of 2, cached: 2 ✔
ref1_1.fq.gz 58708

ref1_2.fq.gz 58708</code></pre>
</div>
<div id="resume-a-pipeline" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="resume-a-pipeline" class="callout-inner">
<h3 class="callout-title">Resume a pipeline<a class="anchor" aria-label="anchor" href="#resume-a-pipeline"></a>
</h3>
<div class="callout-content">
<p>Resume the Nextflow script <code>word_count.nf</code> by re-running
the command and adding the parameter <code>-resume</code> and the
parameter <code>--input 'data/yeast/reads/temp33*'</code>:</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> nextflow run word_count.nf <span class="at">--input</span> <span class="st">'data/yeast/reads/temp33*'</span> <span class="at">-resume</span></span></code></pre>
</div>
<p>If your previous run was successful the output will look similar to
this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 20.10.0
Launching `word_count.nf` [nauseous_leavitt] - revision: fede04a544
[21/6116de] process &gt; NUM_LINES (4) [100%] 6 of 6, cached: 6 ✔
temp33_3_2.fq.gz 88956

temp33_3_1.fq.gz 88956

temp33_1_1.fq.gz 82372

temp33_2_2.fq.gz 63116

temp33_1_2.fq.gz 82372

temp33_2_1.fq.gz 63116</code></pre>
</div>
<p>You will see that the execution of the process <code>NUMLINES</code>
is actually skipped (cached text appears), and the results are retrieved
from the cache.</p>
</div>
</div>
</div>
</div>
</section><section id="how-does-resume-work"><h2 class="section-heading">How does resume work?<a class="anchor" aria-label="anchor" href="#how-does-resume-work"></a>
</h2>
<hr class="half-width">
<p>The mechanism works by assigning a unique ID to each task. This
unique ID is used to create a separate execution directory, within the
<code>work</code> directory, where the tasks are executed and the
results stored. A task’s unique ID is generated as a 128-bit hash number
obtained from a composition of the task’s:</p>
<ul>
<li>Inputs values</li>
<li>Input files</li>
<li>Command line string</li>
<li>Container ID</li>
<li>Conda environment</li>
<li>Environment modules</li>
<li>Any executed scripts in the bin directory</li>
</ul>
<p>When we resume a workflow Nextflow uses this unique ID to check
if:</p>
<ol style="list-style-type: decimal">
<li>The working directory exists</li>
<li>It contains a valid command exit status</li>
<li>It contains the expected output files.</li>
</ol>
<p>If these conditions are satisfied, the task execution is skipped and
the previously computed outputs are applied. When a task requires
recomputation, ie. the conditions above are not fulfilled, the
downstream tasks are automatically invalidated.</p>
<p>Therefore, if you modify some parts of your script, or alter the
input data using <code>-resume</code>, will only execute the processes
that are actually changed.</p>
<p>The execution of the processes that are not changed will be skipped
and the cached result used instead.</p>
<p>This helps a lot when testing or modifying part of your pipeline
without having to re-execute it from scratch.</p>
<div id="modify-nextflow-script-and-re-run." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="modify-nextflow-script-and-re-run." class="callout-inner">
<h3 class="callout-title">Modify Nextflow script and re-run.<a class="anchor" aria-label="anchor" href="#modify-nextflow-script-and-re-run."></a>
</h3>
<div class="callout-content">
<p>Alter the timestamp on the file temp33_3_2.fq.gz using the UNIX
<code>touch</code> command.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> touch data/yeast/reads/temp33_3_2.fq.gz</span></code></pre>
</div>
<p>Run command below.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> nextflow run word_count.nf <span class="at">--input</span> <span class="st">'data/yeast/reads/temp33*'</span> <span class="at">-resume</span></span></code></pre>
</div>
<p>How many processes will be cached and how many will run ?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>The output will look similar to this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 20.10.0
Launching `word_count.nf` [gigantic_minsky] - revision: fede04a544
executor &gt;  local (1)
[20/cda0d5] process &gt; NUM_LINES (5) [100%] 6 of 6, cached: 5 ✔
temp33_1_2.fq.gz 82372

temp33_3_1.fq.gz 88956

temp33_2_1.fq.gz 63116

temp33_1_1.fq.gz 82372

temp33_2_2.fq.gz 63116

temp33_3_2.fq.gz 88956</code></pre>
</div>
<p>As you changed the timestamp on one file it will only re-run that
process. The results for the other 5 processes are retrieved from the
cache.</p>
</div>
</div>
</div>
</div>
</section><section id="the-work-directory"><h2 class="section-heading">The Work directory<a class="anchor" aria-label="anchor" href="#the-work-directory"></a>
</h2>
<hr class="half-width">
<p>By default the pipeline results are cached in the directory
<code>work</code> where the pipeline is launched.</p>
<p>We can use the Bash <code>tree</code> command to list the contents of
the work directory. <strong>Note:</strong> By default tree does not
print hidden files (those beginning with a dot <code>.</code>). Use the
<code>-a</code> to view all files.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> tree <span class="at">-a</span> work</span></code></pre>
</div>
<p>Example output</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>work/
├── 12
│   └── 5489f3c7dbd521c0e43f43b4c1f352
│       ├── .command.begin
│       ├── .command.err
│       ├── .command.log
│       ├── .command.out
│       ├── .command.run
│       ├── .command.sh
│       ├── .exitcode
│       └── temp33_1_2.fq.gz -&gt; /home/training/data/yeast/reads/temp33_1_2.fq.gz
├── 3b
│   └── a3fb24ad3242e4cc8e5aa0c24d174b
│       ├── .command.begin
│       ├── .command.err
│       ├── .command.log
│       ├── .command.out
│       ├── .command.run
│       ├── .command.sh
│       ├── .exitcode
│       └── temp33_2_1.fq.gz -&gt; /home/training/data/yeast/reads/temp33_2_1.fq.gz
├── 4c
│   └── 125b5e5a5ee144fa25dd9bccd467e9
│       ├── .command.begin
│       ├── .command.err
│       ├── .command.log
│       ├── .command.out
│       ├── .command.run
│       ├── .command.sh
│       ├── .exitcode
│       └── temp33_3_1.fq.gz -&gt; /home/training/data/yeast/reads/temp33_3_1.fq.gz
├── 54
│   └── eb9d72e9ac24af8183de569ab0b977
│       ├── .command.begin
│       ├── .command.err
│       ├── .command.log
│       ├── .command.out
│       ├── .command.run
│       ├── .command.sh
│       ├── .exitcode
│       └── temp33_2_2.fq.gz -&gt; /home/training/data/yeast/reads/temp33_2_2.fq.gz
├── e9
│   └── 31f28c291481342cc45d4e176a200a
│       ├── .command.begin
│       ├── .command.err
│       ├── .command.log
│       ├── .command.out
│       ├── .command.run
│       ├── .command.sh
│       ├── .exitcode
│       └── temp33_1_1.fq.gz -&gt; /home/training/data/yeast/reads/temp33_1_1.fq.gz
└── fa
    └── cd3e49b63eadd6248aa357083763c1
        ├── .command.begin
        ├── .command.err
        ├── .command.log
        ├── .command.out
        ├── .command.run
        ├── .command.sh
        ├── .exitcode
        └── temp33_3_2.fq.gz -&gt; /home/training/data/yeast/reads/temp33_3_2.fq.gz</code></pre>
</div>
<div class="section level3">
<h3 id="task-execution-directory">Task execution directory<a class="anchor" aria-label="anchor" href="#task-execution-directory"></a>
</h3>
<p>Within the <code>work</code> directory there are multiple task
execution directories. There is one directory for each time a process is
executed. These task directories are identified by the process execution
hash. For example the task directory
<code>fa/cd3e49b63eadd6248aa357083763c1</code> would be location for the
process identified by the hash <code>fa/cd3e49</code> .</p>
<p>The task execution directory contains:</p>
<ul>
<li><p><code>.command.sh</code>: The command script.</p></li>
<li><p><code>.command.run</code>: The command wrapped used to run the
job.</p></li>
<li><p><code>.command.out</code>: The complete job standard
output.</p></li>
<li><p><code>.command.err</code>: The complete job standard
error.</p></li>
<li><p><code>.command.log</code>: The wrapper execution output.</p></li>
<li><p><code>.command.begin</code>: A file created as soon as the job is
launched.</p></li>
<li><p><code>.exitcode</code>: A file containing the task exit
code.</p></li>
<li><p>Any task input files (symlinks)</p></li>
<li><p>Any task output files</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="specifying-another-work-directory">Specifying another work directory<a class="anchor" aria-label="anchor" href="#specifying-another-work-directory"></a>
</h3>
<p>Depending on your script, this work folder can take a lot of disk
space. You can specify another work directory using the command line
option <code>-w</code>. <strong>Note</strong> Using a different work
directory will mean that any jobs will need to re-run from the
beginning.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> nextflow run word_count.nf <span class="at">--input</span> <span class="st">'data/yeast/reads/temp33*'</span> <span class="at">-w</span> second_work_dir <span class="at">-resume</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `word_count.nf` [deadly_easley] - revision: fede04a544
executor &gt;  local (6)
[9d/0f5e89] process &gt; NUM_LINES (5) [100%] 6 of 6 ✔
temp33_3_2.fq.gz 88956

temp33_1_1.fq.gz 82372

temp33_3_1.fq.gz 88956

temp33_1_2.fq.gz 82372

temp33_2_2.fq.gz 63116

temp33_2_1.fq.gz 63116</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="clean-the-work-directory">Clean the work directory<a class="anchor" aria-label="anchor" href="#clean-the-work-directory"></a>
</h3>
<p>If you are sure you won’t resume your pipeline execution, clean this
folder periodically using the command <code>nextflow clean</code>.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> nextflow clean [run_name<span class="kw">|</span><span class="ex">session_id]</span> <span class="pp">[</span><span class="ss">options</span><span class="pp">]</span></span></code></pre>
</div>
<p>Supply the option <code>-n</code> to print names of files to be
removed without deleting them, or <code>-f</code> to force the removal
of the files. If you only want to remove files from a run but retain
execution log entries and metadata, add the option <code>-k</code>.
Multiple runs can be cleaned with the options, <code>-before</code>,
<code>-after</code> or <code>-but</code> before the run name. For
example, the command below would remove all the temporary files and log
entries for runs before the run <code>gigantic_minsky</code>.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> nextflow clean <span class="at">-f</span> <span class="at">-before</span> gigantic_minsky</span></code></pre>
</div>
<div id="remove-a-nextflow-run." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="remove-a-nextflow-run." class="callout-inner">
<h3 class="callout-title">Remove a Nextflow run.<a class="anchor" aria-label="anchor" href="#remove-a-nextflow-run."></a>
</h3>
<div class="callout-content">
<p>Remove the last Nextflow run using the command
<code>nextflow clean</code>. First use the option <code>-dry-run</code>
to see which files would be deleted and then re-run removing the run and
associated files.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>An example nextflow clean command with <code>dry-run</code> .</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> nextflow clean nauseous_leavitt <span class="at">-dry-run</span></span></code></pre>
</div>
<p>An example nextflow clean command removing the files.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> nextflow clean nauseous_leavitt <span class="at">-f</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Nextflow automatically keeps track of all the processes executed in
your pipeline via checkpointing.</li>
<li>Nextflow caches intermediate data in task directories within the
work directory.</li>
<li>Nextflow caching and checkpointing allows re-entrancy into a
workflow after a pipeline error or using new data, skipping steps that
have been successfully executed.</li>
<li>Re-entrancy is enabled using the <code>-resume</code> option.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-11-Simple_Rna-Seq_pipeline"><p>Content from <a href="11-Simple_Rna-Seq_pipeline.html">Simple RNA-Seq pipeline</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/11-Simple_Rna-Seq_pipeline.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create a Nextflow pipeline from a series of unix commands
and input data?</li>
<li>How do I log my pipelines parameters?</li>
<li>How can I manage my pipeline software requirements?</li>
<li>How do I know when my pipeline has finished?</li>
<li>How do I see how much resources my pipeline has used?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create a simple RNA-Seq pipeline.</li>
<li>Use the <code>log.info</code> function to print all the pipeline
parameters.</li>
<li>Print a confirmation message when the pipeline completes.</li>
<li>Use a conda <code>environment.yml</code> file to install the
pipeline’s software requirement.</li>
<li>Produce an execution report and generate run metrics from a pipeline
run.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>We’re now set to develop a multi-step pipeline using Nextflow, for
analyzing and performing quality control on our yeast RNA-Seq
experiment.</p>
<p>In this RNA-Seq pipeline, we’ll undertake the following steps to
thoroughly analyze gene expression data:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Quality Control with FastQC</strong>: <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/" class="external-link">FastQC</a>
assesses the quality of the data by generating reports that highlight
any potential issues, such as low-quality sequences or contamination.
FastQC’s output includes an HTML report and a directory containing
detailed analyses, which are essential for evaluating the integrity of
the sequencing data.</li>
</ol>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> mkdir fastqc_<span class="op">&lt;</span>sample_id<span class="op">&gt;</span>_logs</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">$</span> fastqc <span class="at">-o</span> fastqc_<span class="op">&lt;</span>sample_id<span class="op">&gt;</span>_logs <span class="at">-f</span> fastq <span class="at">-q</span> <span class="op">&lt;</span>reads<span class="op">&gt;</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>
<strong>Transcriptome Indexing with Salmon</strong>: <a href="https://salmon.readthedocs.io/en/latest/" class="external-link">Salmon</a> is a tool to
quantify transcript expression in RNA-seq data. The first step in the
process is for Salmon to create an index of the transcriptome. This step
involves processing a reference transcriptome, which allows for
efficient and accurate mapping and quantification of RNA-Seq reads.</li>
</ol>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> salmon index <span class="at">--threads</span> <span class="op">&lt;</span>cpus<span class="op">&gt;</span> -t <span class="op">&lt;</span>transcriptome file<span class="op">&gt;</span> -i index</span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>
<strong>Quantification with Salmon</strong>: After indexing, Salmon
is used for the quantification step. In this step, Salmon maps the reads
to the transcriptome index and quantifies the transcript abundances.
This process is crucial for determining the expression levels of genes
in the sample.</li>
</ol>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> salmon quant <span class="at">--threads</span> <span class="op">&lt;</span>cpus<span class="op">&gt;</span> --libType=U <span class="at">-i</span> <span class="op">&lt;</span>index<span class="op">&gt;</span> -1 <span class="op">&lt;</span>read1<span class="op">&gt;</span> -2 <span class="op">&lt;</span>read2<span class="op">&gt;</span> -o <span class="op">&lt;</span>pair_id<span class="op">&gt;</span></span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>
<strong>Aggregating Reports with MultiQC</strong>: Finally, the
pipeline employs <a href="https://multiqc.info/" class="external-link">MultiQC</a> to
aggregate logs and outputs from the FastQC and Salmon. MultiQC scans the
outputs and compiles a summary report, which provides an overview of the
results and highlights any areas that may need further
investigation.</li>
</ol>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> multiqc .</span></code></pre>
</div>
<p>This pipeline provides an overview of RNA-Seq data, from quality
control to expression quantification, culminating in an aggregated
report for easy interpretation of the results.</p>
<p>To start move the episode’s nextflow scripts in the
<code>scripts/rnaseq_pipeline</code> folder to your home directory.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> cp scripts/rnaseq_pipeline/<span class="pp">*</span> .</span></code></pre>
</div>
<p>This folder contains files we will be modifying in this episode.</p>
<section id="define-the-pipeline-parameters"><h2 class="section-heading">Define the pipeline parameters<a class="anchor" aria-label="anchor" href="#define-the-pipeline-parameters"></a>
</h2>
<hr class="half-width">
<p>The first thing we want to do when writing a pipeline is define the
pipeline parameters. The script <code>script1.nf</code> defines the
pipeline input parameters.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">//script1.nf</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>params<span class="op">.</span>reads <span class="op">=</span> <span class="st">"data/yeast/reads/*_{1,2}.fq.gz"</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>params<span class="op">.</span>transcriptome <span class="op">=</span> <span class="st">"data/yeast/transcriptome/*.fa.gz"</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>println <span class="st">"reads: </span><span class="ss">$params</span><span class="op">.</span><span class="ss">reads</span><span class="st">"</span></span></code></pre>
</div>
<p>Run it by using the following command:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script1.nf</span></code></pre>
</div>
<p>We can specify a different input parameter using the
<code>--&lt;params&gt;</code> option, for example :</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>$ nextflow run script1<span class="op">.</span>nf <span class="op">--</span>reads <span class="st">"data/yeast/reads/ref1*_{1,2}.fq.gz"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>reads: data/yeast/reads/ref1*_{1,2}.fq.gz</code></pre>
</div>
<div id="add-a-parameter" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="add-a-parameter" class="callout-inner">
<h3 class="callout-title">Add a parameter<a class="anchor" aria-label="anchor" href="#add-a-parameter"></a>
</h3>
<div class="callout-content">
<p>Modify the <code>script1.nf</code> adding a third parameter named
<code>outdir</code> and set it to <code>results</code>. This parameter
will be used as the pipeline output directory.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>params<span class="op">.</span>outdir <span class="op">=</span> <span class="st">"results"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>It can be useful to print the pipeline parameters to the screen. This
can be done using the the <code>log.info</code> command and a multiline
string statement. The string method <code>.stripIndent()</code> command
is used to remove the indentation on multi-line strings.
<code>log.info</code> also saves the output to the log execution file
<code>.nextflow.log</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>log<span class="op">.</span><span class="fu">info</span> <span class="st">"""</span><span class="op">\</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="st">         transcriptome: </span><span class="ss">${</span>params<span class="op">.</span>transcriptome<span class="ss">}</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="st">         """</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>         <span class="op">.</span><span class="fu">stripIndent</span><span class="op">()</span></span></code></pre>
</div>
<div id="log.info" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="log.info" class="callout-inner">
<h3 class="callout-title">log.info<a class="anchor" aria-label="anchor" href="#log.info"></a>
</h3>
<div class="callout-content">
<p>Modify the <code>script1.nf</code> to print all the pipeline
parameters by using a single <code>log.info</code> command and a
multiline string statement. See an example <a href="https://github.com/nextflow-io/rnaseq-nf/blob/3b5b49f/main.nf#L41-L48" class="external-link">here</a>.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script1.nf</span></code></pre>
</div>
<p>Look at the output log <code>.nextflow.log</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Below is an example log.info command printing all the pipeline
parameters.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>log<span class="op">.</span><span class="fu">info</span> <span class="st">"""</span><span class="op">\</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="st">        R N A S E Q - N F   P I P E L I N E    </span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="st">        ===================================</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="st">        transcriptome: </span><span class="ss">${</span>params<span class="op">.</span>transcriptome<span class="ss">}</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="st">        reads        : </span><span class="ss">${</span>params<span class="op">.</span>reads<span class="ss">}</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="st">        outdir       : </span><span class="ss">${</span>params<span class="op">.</span>outdir<span class="ss">}</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>        <span class="op">.</span><span class="fu">stripIndent</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> less .nextflow.log</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="recap">Recap<a class="anchor" aria-label="anchor" href="#recap"></a>
</h3>
<p>In this step you have learned:</p>
<ul>
<li><p>How to define parameters in your pipeline script.</p></li>
<li><p>How to pass parameters by using the command line.</p></li>
<li><p>The use of <code>$var</code> and <code>${var}</code> variable
placeholders.</p></li>
<li><p>How to use multiline strings.</p></li>
<li><p>How to use <code>log.info</code> to print information and save it
in the log execution file.</p></li>
</ul>
</div>
</section><section id="create-a-transcriptome-index-file"><h2 class="section-heading">Create a transcriptome index file<a class="anchor" aria-label="anchor" href="#create-a-transcriptome-index-file"></a>
</h2>
<hr class="half-width">
<p>Nextflow allows the execution of any command or user script by using
a <code>process</code> definition.</p>
<p>For example,</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> salmon index <span class="at">--threads</span> <span class="va">$task</span>.cpus <span class="at">-t</span> <span class="va">$transcriptome</span> <span class="at">-i</span> index</span></code></pre>
</div>
<p>A process is defined by providing three main declarations:</p>
<ol style="list-style-type: decimal">
<li>The process <a href="https://www.nextflow.io/docs/latest/process.html#inputs" class="external-link">inputs</a>,</li>
<li>The process <a href="https://www.nextflow.io/docs/latest/process.html#outputs" class="external-link">outputs</a>
</li>
<li>Finally the command <a href="https://www.nextflow.io/docs/latest/process.html#script" class="external-link">script</a>.</li>
</ol>
<p>The second example, <code>script2.nf</code> adds,</p>
<ol style="list-style-type: decimal">
<li>The process <code>INDEX</code> which generate a directory with the
index of the transcriptome. This process takes one input, a
transcriptome file, and emits one output a salmon index directory.</li>
<li>A queue Channel <code>transcriptome_ch</code> taking the
transcriptome file defined in params variable
<code>params.transcriptome</code>.</li>
<li>Finally the script adds a <code>workflow</code> definition block
which calls the <code>INDEX</code> process.</li>
</ol>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co">//script2.nf</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl<span class="op">=</span><span class="dv">2</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co"> * pipeline input parameters</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>params<span class="op">.</span>reads <span class="op">=</span> <span class="st">"data/yeast/reads/*_{1,2}.fq.gz"</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>params<span class="op">.</span>transcriptome <span class="op">=</span> <span class="st">"data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>params<span class="op">.</span>outdir <span class="op">=</span> <span class="st">"results"</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>println <span class="st">"""</span><span class="op">\</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="st">         R N A S E Q - N F   P I P E L I N E</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="st">         ===================================</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="st">         transcriptome: </span><span class="ss">${</span>params<span class="op">.</span>transcriptome<span class="ss">}</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="st">         reads        : </span><span class="ss">${</span>params<span class="op">.</span>reads<span class="ss">}</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="st">         outdir       : </span><span class="ss">${</span>params<span class="op">.</span>outdir<span class="ss">}</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="st">         """</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>         <span class="op">.</span><span class="fu">stripIndent</span><span class="op">()</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="st">/*</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="st"> * define the `INDEX` process that create a binary index</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="st"> * given the transcriptome file</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="st"> */</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a>process INDEX <span class="op">{</span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a>    path transcriptome</span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a>    path <span class="st">'index'</span></span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a><span class="st">    salmon index --threads </span><span class="ss">$task</span><span class="op">.</span><span class="ss">cpus</span><span class="st"> -t </span><span class="ss">$transcriptome</span><span class="st"> -i index</span></span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-38"><a href="#cb16-38" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" tabindex="-1"></a>transcriptome_ch <span class="op">=</span> channel<span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span>params<span class="op">.</span>transcriptome<span class="op">)</span></span>
<span id="cb16-40"><a href="#cb16-40" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb16-42"><a href="#cb16-42" tabindex="-1"></a>   <span class="fu">INDEX</span><span class="op">()</span></span>
<span id="cb16-43"><a href="#cb16-43" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>Try to run it by using the command:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script2.nf</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 22.04.0
Launching `script2.nf` [happy_brown] DSL2 - revision: 90e932bb8d
R N A S E Q - N F   P I P E L I N E
===================================
transcriptome: data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz
reads        : data/yeast/reads/*_{1,2}.fq.gz
outdir       : results

Process `INDEX` declares 1 input channel but 0 were specified

 -- Check script 'script2.nf' at line: 41 or see '.nextflow.log' file for more details</code></pre>
</div>
<p>The execution will fail because the program the process,
<code>INDEX</code> , has not been passed any input channel.</p>
<p>Add the <code>transcriptome_ch</code> channel to the
<code>INDEX</code> process call.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="op">[</span>truncated<span class="op">]</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>   <span class="fu">INDEX</span><span class="op">(</span>transcriptome_ch<span class="op">)</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>Now try to run it again by using the command:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script2.nf</span></code></pre>
</div>
<p>Now the workflow will run successfully.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 22.04.0
Launching `script2.nf` [mad_aryabhata] DSL2 - revision: 811396b67b
R N A S E Q - N F   P I P E L I N E
===================================
transcriptome:data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz
reads        : data/yeast/reads/*_{1,2}.fq.gz
outdir       : results

executor &gt;  local (1)
[c0/418d78] process &gt; INDEX (1) [100%] 1 of 1 ✔
</code></pre>
</div>
<p>The <code>INDEX</code> process also defines one <code>output</code>
channel. This channel will be populated with <code>index</code>
directory created during process. To view the contents of the channel we
can use the <code>view</code> operator.</p>
<div id="view-the-contents-of-the-index_ch" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="view-the-contents-of-the-index_ch" class="callout-inner">
<h3 class="callout-title">View the contents of the index_ch<a class="anchor" aria-label="anchor" href="#view-the-contents-of-the-index_ch"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Assign the output of the <code>INDEX</code> process to the variable
<code>index_ch</code>.</li>
<li>View the contents of the <code>index_ch</code> channel by using the
<code>view</code> operator.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="op">[..</span>truncated<span class="op">..]</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  index_ch<span class="op">=</span><span class="fu">INDEX</span><span class="op">(</span>transcriptome_ch<span class="op">)</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>  index_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="recap-1">Recap<a class="anchor" aria-label="anchor" href="#recap-1"></a>
</h3>
<p>In this step you have learned:</p>
<ul>
<li><p>How to define a process executing a custom command</p></li>
<li><p>How process inputs are declared</p></li>
<li><p>How to assign a channel as input to a process call</p></li>
<li><p>How process outputs are declared</p></li>
<li><p>How to print the content of a channel
<code>view()</code></p></li>
</ul>
</div>
</section><section id="collect-read-files-by-pairs"><h2 class="section-heading">Collect read files by pairs<a class="anchor" aria-label="anchor" href="#collect-read-files-by-pairs"></a>
</h2>
<hr class="half-width">
<p>This step shows how to match <strong>read</strong> files into pairs,
so they can be mapped by salmon.</p>
<p>The script <code>script3.nf</code> adds a line to create a channel,
<code>read_pairs_ch</code>, containing fastq read pair files using the
<code>fromFilePairs</code> channel factory.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co">//script3.nf</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>nextflow<span class="op">.</span>enable<span class="op">.</span>dsl <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co"> * pipeline input parameters</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>params<span class="op">.</span>reads <span class="op">=</span> <span class="st">"data/yeast/reads/ref1_{1,2}.fq.gz"</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>params<span class="op">.</span>transcriptome <span class="op">=</span> <span class="st">"data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz"</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>params<span class="op">.</span>outdir <span class="op">=</span> <span class="st">"results"</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>log<span class="op">.</span><span class="fu">info</span> <span class="st">"""</span><span class="op">\</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="st">         R N A S E Q - N F   P I P E L I N E</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="st">         ===================================</span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a><span class="st">         transcriptome: </span><span class="ss">${</span>params<span class="op">.</span>transcriptome<span class="ss">}</span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="st">         reads        : </span><span class="ss">${</span>params<span class="op">.</span>reads<span class="ss">}</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a><span class="st">         outdir       : </span><span class="ss">${</span>params<span class="op">.</span>outdir<span class="ss">}</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a><span class="st">         """</span></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a>         <span class="op">.</span><span class="fu">stripIndent</span><span class="op">()</span></span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a>read_pairs_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span> params<span class="op">.</span>reads <span class="op">)</span></span></code></pre>
</div>
<p>We can view the contents of the <code>read_pairs_ch</code> by adding
the following statement as the last line:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>read_pairs_ch<span class="op">.</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<p>Now if we execute it with the following command:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script3.nf</span></code></pre>
</div>
<p>It will print an output similar to the one shown below that shows how
the <code>read_pairs_ch</code> channel emits a tuple. The tuple is
composed of two elements, where the first is the pattern matched by the
glob pattern <code>data/yeast/reads/ref1_{1,2}.fq.g</code>, defined by
the variable <code>params.reads</code> , and the second is a list
representing the actual files.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[..truncated..]
[ref1, [data/yeast/reads/ref1_1.fq.gz,data/yeast/reads/ref1_2.fq.gz]]</code></pre>
</div>
<p>To read in other read pairs we can specify a different glob pattern
in the <code>params.reads</code> variable by using <code>--reads</code>
options on the command line. For example, the following command would
read in add the ref samples:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script3.nf <span class="at">--reads</span> <span class="st">'data/yeast/reads/ref*_{1,2}.fq.gz'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[..truncated..]
[ref2, [data/yeast/reads/ref2_1.fq.gz, data/yeast/reads/ref2_2.fq.gz]]
[ref3, [data/yeast/reads/ref3_1.fq.gz, data/yeast/reads/ref3_2.fq.gz]]
[ref1, [data/yeast/reads/ref1_1.fq.gz, data/yeast/reads/ref1_2.fq.gz]]</code></pre>
</div>
<p><strong>Note</strong> File paths including one or more wildcards ie.
<code>*</code>, <code>?</code>, etc. MUST be wrapped in single-quoted
characters to avoid Bash expanding the glob pattern on the command
line.</p>
<p>We can also add a argument, <code>checkIfExists: true</code> , to the
<code>fromFilePairs</code> channel factory to return an message if the
file doesn’t exist.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co">//script3.nf</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="op">[..</span>truncated<span class="op">..]</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>read_pairs_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span> params<span class="op">.</span>reads<span class="op">,</span> checkIfExists<span class="op">:</span> <span class="kw">true</span> <span class="op">)</span></span></code></pre>
</div>
<p>If we now run the script with the <code>--reads</code> parameter
<code>data/yeast/reads/*_1,2}.fq.gz</code></p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script3.nf <span class="at">--reads</span> <span class="st">'data/yeast/reads/*_1,2}.fq.gz'</span></span></code></pre>
</div>
<p>it will return the message .</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[..truncated..]
No such file: data/yeast/reads/*_1,2}.fq.gz</code></pre>
</div>
<div id="read-in-all-read-pairs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="read-in-all-read-pairs" class="callout-inner">
<h3 class="callout-title">Read in all read pairs<a class="anchor" aria-label="anchor" href="#read-in-all-read-pairs"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Add the <code>checkIfExists: true</code> argument to the
<code>fromFilePairs</code> channel factory in
<code>script3.nf</code>.</li>
<li>Using the command line parameter <code>--reads</code>, add a glob
pattern to read in all the read pairs files from the
<code>data/yeast/reads</code> directory.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>read_pairs_ch <span class="op">=</span><span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span>params<span class="op">.</span>reads<span class="op">,</span> checkIfExists<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">nextflow</span> run script3.nf <span class="at">--reads</span> <span class="st">'data/yeast/reads/*_{1,2}.fq.gz'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[..truncated..]
[temp33_1, [data/yeast/reads/temp33_1_1.fq.gz, data/yeast/reads/temp33_1_2.fq.gz]]
[ref2, [data/yeast/reads/ref2_1.fq.gz, data/yeast/reads/ref2_2.fq.gz]]
[temp33_3, [data/yeast/reads/temp33_3_1.fq.gz, data/yeast/reads/temp33_3_2.fq.gz]]
[ref3, [data/yeast/reads/ref3_1.fq.gz, data/yeast/reads/ref3_2.fq.gz]]
[temp33_2, [data/yeast/reads/temp33_2_1.fq.gz,data/yeast/reads/temp33_2_2.fq.gz]]
[etoh60_2, [data/yeast/reads/etoh60_2_1.fq.gz,data/yeast/reads/etoh60_2_2.fq.gz]]
[ref1, [data/yeast/reads/ref1_1.fq.gz, data/yeast/reads/ref1_2.fq.gz]]
[etoh60_3, [data/yeast/reads/etoh60_3_1.fq.gz, data/yeast/reads/etoh60_3_2.fq.gz]]
[etoh60_1, [data/yeast/reads/etoh60_1_1.fq.gz, data/yeast/reads/etoh60_1_2.fq.gz]]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="recap-2">Recap<a class="anchor" aria-label="anchor" href="#recap-2"></a>
</h3>
<p>In this step you have learned:</p>
<ul>
<li><p>How to use <code>fromFilePairs</code> to handle read pair
files</p></li>
<li><p>How to use the <code>checkIfExists</code> option to check input
file existence</p></li>
</ul>
</div>
</section><section id="perform-expression-quantification"><h2 class="section-heading">Perform expression quantification<a class="anchor" aria-label="anchor" href="#perform-expression-quantification"></a>
</h2>
<hr class="half-width">
<p>The script <code>script4.nf</code>;</p>
<ol style="list-style-type: decimal">
<li>Adds the quantification process, <code>QUANT</code>.</li>
<li>Calls the <code>QUANT</code> process in the workflow block.</li>
</ol>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co">//script4.nf</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="op">..</span>truncated<span class="op">..</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="st">/*</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="st"> * Run Salmon to perform the quantification of expression using</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="st"> * the index and the matched read files</span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a><span class="st"> */</span></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>process QUANT <span class="op">{</span></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>    path index</span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>pair_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>    <span class="fu">path</span><span class="op">(</span>pair_id<span class="op">)</span></span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a><span class="st">    salmon quant --threads </span><span class="ss">$task</span><span class="op">.</span><span class="ss">cpus</span><span class="st"> --libType=U -i </span><span class="ss">$index</span><span class="st"> -1 </span><span class="ss">${</span>reads<span class="op">[</span><span class="dv">0</span><span class="op">]</span><span class="ss">}</span><span class="st"> -2 </span><span class="ss">${</span>reads<span class="op">[</span><span class="dv">1</span><span class="op">]</span><span class="ss">}</span><span class="st"> -o </span><span class="ss">$pair_id</span></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a><span class="op">..</span>truncated<span class="op">..</span></span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a><span class="fu">workflow</span> <span class="op">{</span></span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a>  read_pairs_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span> params<span class="op">.</span>reads<span class="op">,</span> checkIfExists<span class="op">:</span><span class="kw">true</span> <span class="op">)</span></span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a>  transcriptome_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>transcriptome<span class="op">,</span> checkIfExists<span class="op">:</span><span class="kw">true</span> <span class="op">)</span></span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" tabindex="-1"></a>  index_ch<span class="op">=</span><span class="fu">INDEX</span><span class="op">(</span>transcriptome_ch<span class="op">)</span></span>
<span id="cb35-27"><a href="#cb35-27" tabindex="-1"></a>  quant_ch<span class="op">=</span><span class="fu">QUANT</span><span class="op">(</span>index_ch<span class="op">,</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb35-28"><a href="#cb35-28" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>The <code>index_ch</code> channel, declared as output in the
<code>INDEX</code> process, is used as the first input argument to the
<code>QUANT</code> process.</p>
<p>The second input argument of the <code>QUANT</code> process, the
<code>read_pairs_ch</code> channel, is a tuple composed of two elements:
the <code>pair_id</code> and the <code>reads</code>.</p>
<p>Execute it by using the following command:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script4.nf</span></code></pre>
</div>
<p>You will see the execution of the index and quantification
process.</p>
<p>Re run the command using the <code>-resume</code> option</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script4.nf <span class="at">-resume</span></span></code></pre>
</div>
<p>The <code>-resume</code> option cause the execution of any step that
has been already processed to be skipped.</p>
<p>Try to execute it with more read files as shown below:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script4.nf <span class="at">-resume</span> <span class="at">--reads</span> <span class="st">'data/yeast/reads/ref*_{1,2}.fq.gz'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `script4.nf` [shrivelled_brenner] - revision: c21df6839e
R N A S E Q - N F   P I P E L I N E
===================================
transcriptome: data/yeast/transcriptome/Saccharomyces_c
erevisiae.R64-1-1.cdna.all.fa.gz

reads        : data/yeast/reads/ref*_{1,2}.fq.gz
outdir       : results

executor &gt;  local (8)
[02/3742cf] process &gt; INDEX     [100%] 1 of 1, cached: 1 ✔
[9a/be3483] process &gt; QUANT (9) [100%] 3 of 3, cached: 1 ✔</code></pre>
</div>
<p>You will notice that the <code>INDEX</code> step and one of the
<code>QUANT</code> steps has been cached, and the quantification process
is executed more than one time.</p>
<p>When your input channel contains multiple data items Nextflow, where
possible, parallelises the execution of your pipeline.</p>
<p>In these situations it is useful to add a <code>tag</code> directive
to add some descriptive text to instance of the process being run.</p>
<div id="add-a-tag-directive" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="add-a-tag-directive" class="callout-inner">
<h3 class="callout-title">Add a tag directive<a class="anchor" aria-label="anchor" href="#add-a-tag-directive"></a>
</h3>
<div class="callout-content">
<p>Add a <code>tag</code> directive to the <code>QUANT</code> process of
<code>script4.nf</code> to provide a more readable execution log.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>tag <span class="st">"quantification on </span><span class="ss">$pair_id</span><span class="st">"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Data produced by the workflow during a process will be saved in the
working directory, by default a directory named <code>work</code>. The
working directory should be considered a temporary storage space and any
data you wish to save at the end of the workflow should be specified in
the process output with the final storage location defined in the
<code>publishDir</code> directive.</p>
<p><strong>Note:</strong> by default the <code>publishDir</code>
directive creates a symbolic link to the files in the working this
behaviour can be changed using the <code>mode</code> parameter.</p>
</section><section id="add-a-publishdir-directive"><h2 class="section-heading">Add a publishDir directive<a class="anchor" aria-label="anchor" href="#add-a-publishdir-directive"></a>
</h2>
<hr class="half-width">
<p>Add a <code>publishDir</code> directive to the quantification process
of <code>script4.nf</code> to store the process results into folder
specified by the <code>params.outdir</code> Nextflow variable. Include
the <code>publishDir</code> <code>mode</code> option to copy the
output.</p>
<div id="challenge6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge6"></a>
</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">Show me the solution</h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>publishDir <span class="st">"</span><span class="ss">${</span>params<span class="op">.</span>outdir<span class="ss">}</span><span class="st">/quant"</span><span class="op">,</span> mode<span class="op">:</span><span class="st">'copy'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="recap-3">Recap<a class="anchor" aria-label="anchor" href="#recap-3"></a>
</h3>
<p>In this step you have learned:</p>
<ul>
<li><p>How to connect two processes by using the channel
declarations.</p></li>
<li><p>How to resume the script execution skipping already already
computed steps.</p></li>
<li><p>How to use the <code>tag</code> directive to provide a more
readable execution output.</p></li>
<li><p>How to use the <code>publishDir</code> to store a process results
in a path of your choice.</p></li>
</ul>
</div>
</section><section id="quality-control"><h2 class="section-heading">Quality control<a class="anchor" aria-label="anchor" href="#quality-control"></a>
</h2>
<hr class="half-width">
<p>This step implements a quality control step for your input reads. The
input to the <code>FASTQC</code> process is the same
<code>read_pairs_ch</code> that is provided as input to the
quantification process <code>QUANT</code> .</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="co">//script5.nf</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a><span class="op">[..</span>truncated<span class="op">..]</span></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a><span class="st">/*</span></span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a><span class="st"> * Run fastQC to check quality of reads files</span></span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a><span class="st"> */</span></span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a>process FASTQC <span class="op">{</span></span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a>    tag <span class="st">"FASTQC on </span><span class="ss">$sample_id</span><span class="st">"</span></span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a>    cpus <span class="dv">1</span></span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>sample_id<span class="op">),</span> <span class="fu">path</span><span class="op">(</span>reads<span class="op">)</span></span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a>    <span class="fu">path</span><span class="op">(</span><span class="st">"fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs"</span><span class="op">)</span></span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb42-18"><a href="#cb42-18" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb42-19"><a href="#cb42-19" tabindex="-1"></a><span class="st">    mkdir fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs</span></span>
<span id="cb42-20"><a href="#cb42-20" tabindex="-1"></a><span class="st">    fastqc -o fastqc_</span><span class="ss">${</span>sample_id<span class="ss">}</span><span class="st">_logs -f fastq -q </span><span class="ss">${</span>reads<span class="ss">}</span><span class="st"> -t </span><span class="ss">${</span>task<span class="op">.</span>cpus<span class="ss">}</span></span>
<span id="cb42-21"><a href="#cb42-21" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb42-22"><a href="#cb42-22" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb42-23"><a href="#cb42-23" tabindex="-1"></a></span>
<span id="cb42-24"><a href="#cb42-24" tabindex="-1"></a><span class="op">[..</span>truncated<span class="op">..]</span></span>
<span id="cb42-25"><a href="#cb42-25" tabindex="-1"></a></span>
<span id="cb42-26"><a href="#cb42-26" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb42-27"><a href="#cb42-27" tabindex="-1"></a>  read_pairs_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span> params<span class="op">.</span>reads<span class="op">,</span> checkIfExists<span class="op">:</span><span class="kw">true</span> <span class="op">)</span></span>
<span id="cb42-28"><a href="#cb42-28" tabindex="-1"></a>  transcriptome_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>transcriptome<span class="op">,</span> checkIfExists<span class="op">:</span><span class="kw">true</span> <span class="op">)</span></span>
<span id="cb42-29"><a href="#cb42-29" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" tabindex="-1"></a>  index_ch<span class="op">=</span><span class="fu">INDEX</span><span class="op">(</span>transcriptome_ch<span class="op">)</span></span>
<span id="cb42-31"><a href="#cb42-31" tabindex="-1"></a>  quant_ch<span class="op">=</span><span class="fu">QUANT</span><span class="op">(</span>index_ch<span class="op">,</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb42-32"><a href="#cb42-32" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>Run the script <code>script5.nf</code> by using the following
command:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script5.nf <span class="at">-resume</span></span></code></pre>
</div>
<p>The <code>FASTQC</code> process will not run as the process has not
been declared in the workflow scope.</p>
<div id="add-fastqc-process" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="add-fastqc-process" class="callout-inner">
<h3 class="callout-title">Add FASTQC process<a class="anchor" aria-label="anchor" href="#add-fastqc-process"></a>
</h3>
<div class="callout-content">
<p>Add the <code>FASTQC</code> process to the
<code>workflow scope</code> of <code>script5.nf</code> adding the
<code>read_pairs_ch</code> channel as an input. Run the nextflow script
using the <code>-resume</code> option.</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script5.nf <span class="at">-resume</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">Show me the solution</h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>read_pairs_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span> params<span class="op">.</span>reads<span class="op">,</span> checkIfExists<span class="op">:</span><span class="kw">true</span> <span class="op">)</span></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>transcriptome_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>transcriptome<span class="op">,</span> checkIfExists<span class="op">:</span><span class="kw">true</span> <span class="op">)</span></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>index_ch <span class="op">=</span> <span class="fu">INDEX</span><span class="op">(</span> transcriptome_ch <span class="op">)</span></span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>quant_ch<span class="op">=</span><span class="fu">QUANT</span><span class="op">(</span>index_ch<span class="op">,</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>fastqc_ch<span class="op">=</span><span class="fu">FASTQC</span><span class="op">(</span>read_pairs_ch<span class="op">)</span></span></code></pre>
</div>
<p>}</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="recap-4">Recap<a class="anchor" aria-label="anchor" href="#recap-4"></a>
</h3>
<p>In this step you have learned:</p>
<ul>
<li>How to use the add a <code>process</code> to the
<code>workflow</code> scope.</li>
<li>Add a channel as input to a <code>process</code>.</li>
</ul>
</div>
</section><section id="multiqc-report"><h2 class="section-heading">MultiQC report<a class="anchor" aria-label="anchor" href="#multiqc-report"></a>
</h2>
<hr class="half-width">
<p>This step collect the outputs from the quantification and fastqc
steps to create a final report by using the <a href="https://multiqc.info/" class="external-link">MultiQC</a> tool.</p>
<p>The input for the <code>MULTIQC</code> process requires all data in a
single channel element. Therefore, we will need to combine the
<code>FASTQC</code> and <code>QUANT</code> outputs using:</p>
<ul>
<li>The combining operator <code>mix</code> : combines the items in the
two channels into a single channel</li>
</ul>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="co">//example of the mix operator</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>ch1 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">)</span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>ch2 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="st">'a'</span><span class="op">)</span></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>ch1<span class="op">.</span><span class="fu">mix</span><span class="op">(</span>ch2<span class="op">).</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1</span></span>
<span><span class="fl">2</span></span>
<span><span class="va">a</span></span></code></pre>
</div>
<ul>
<li>The transformation operator <code>collect</code> collects all the
items in the new combined channel into a single item.</li>
</ul>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="co">//example of the collect operator</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>ch1 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">of</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a>ch1<span class="op">.</span><span class="fu">collect</span><span class="op">().</span><span class="fu">view</span><span class="op">()</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1, 2, 3]</code></pre>
</div>
<div id="combing-operators" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="combing-operators" class="callout-inner">
<h3 class="callout-title">Combing operators<a class="anchor" aria-label="anchor" href="#combing-operators"></a>
</h3>
<div class="callout-content">
<p>Which is the correct way to combined <code>mix</code> and
<code>collect</code> operators so that you have a single channel with
one List item?</p>
<ol style="list-style-type: decimal">
<li><code>quant_ch.mix(fastqc_ch).collect()</code></li>
<li><code>quant_ch.collect(fastqc_ch).mix()</code></li>
<li><code>fastqc_ch.mix(quant_ch).collect()</code></li>
<li><code>fastqc_ch.collect(quant_ch).mix()</code></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">Show me the solution</h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" data-bs-parent="#accordionSolution8" aria-labelledby="headingSolution8">
<div class="accordion-body">
<p>You need to use the <code>mix</code> operator first to combine the
channels followed by the <code>collect</code> operator to collect all
the items in a single item.</p>
</div>
</div>
</div>
</div>
<p>In <code>script6.nf</code> we use the statement
<code>quant_ch.mix(fastqc_ch).collect()</code> to combine and collect
the outputs of the <code>QUANT</code> and <code>FASTQC</code> process to
create the required input for the <code>MULTIQC</code> process.</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="op">[..</span>truncated<span class="op">..]</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a><span class="co">//script6.nf</span></span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a><span class="co"> * Create a report using multiQC for the quantification</span></span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a><span class="co"> * and fastqc processes</span></span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a>process MULTIQC <span class="op">{</span></span>
<span id="cb50-8"><a href="#cb50-8" tabindex="-1"></a>    publishDir <span class="st">"</span><span class="ss">${</span>params<span class="op">.</span>outdir<span class="ss">}</span><span class="st">/multiqc"</span><span class="op">,</span> mode<span class="op">:</span><span class="st">'copy'</span></span>
<span id="cb50-9"><a href="#cb50-9" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" tabindex="-1"></a>    input<span class="op">:</span></span>
<span id="cb50-11"><a href="#cb50-11" tabindex="-1"></a>    <span class="fu">path</span><span class="op">(</span><span class="st">'*'</span><span class="op">)</span></span>
<span id="cb50-12"><a href="#cb50-12" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" tabindex="-1"></a>    output<span class="op">:</span></span>
<span id="cb50-14"><a href="#cb50-14" tabindex="-1"></a>    <span class="fu">path</span><span class="op">(</span><span class="st">'multiqc_report.html'</span><span class="op">)</span></span>
<span id="cb50-15"><a href="#cb50-15" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" tabindex="-1"></a>    script<span class="op">:</span></span>
<span id="cb50-17"><a href="#cb50-17" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb50-18"><a href="#cb50-18" tabindex="-1"></a><span class="st">    multiqc .</span></span>
<span id="cb50-19"><a href="#cb50-19" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb50-20"><a href="#cb50-20" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-21"><a href="#cb50-21" tabindex="-1"></a></span>
<span id="cb50-22"><a href="#cb50-22" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb50-24"><a href="#cb50-24" tabindex="-1"></a>  read_pairs_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromFilePairs</span><span class="op">(</span> params<span class="op">.</span>reads<span class="op">,</span> checkIfExists<span class="op">:</span><span class="kw">true</span> <span class="op">)</span></span>
<span id="cb50-25"><a href="#cb50-25" tabindex="-1"></a>  transcriptome_ch <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromPath</span><span class="op">(</span> params<span class="op">.</span>transcriptome<span class="op">,</span> checkIfExists<span class="op">:</span><span class="kw">true</span> <span class="op">)</span></span>
<span id="cb50-26"><a href="#cb50-26" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" tabindex="-1"></a>  index_ch<span class="op">=</span><span class="fu">INDEX</span><span class="op">(</span>transcriptome_ch<span class="op">)</span></span>
<span id="cb50-28"><a href="#cb50-28" tabindex="-1"></a>  quant_ch<span class="op">=</span><span class="fu">QUANT</span><span class="op">(</span>index_ch<span class="op">,</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb50-29"><a href="#cb50-29" tabindex="-1"></a>  fastqc_ch<span class="op">=</span><span class="fu">FASTQC</span><span class="op">(</span>read_pairs_ch<span class="op">)</span></span>
<span id="cb50-30"><a href="#cb50-30" tabindex="-1"></a>  <span class="fu">MULTIQC</span><span class="op">(</span>quant_ch<span class="op">.</span><span class="fu">mix</span><span class="op">(</span>fastqc_ch<span class="op">).</span><span class="fu">collect</span><span class="op">())</span></span>
<span id="cb50-31"><a href="#cb50-31" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>Execute the script with the following command:</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script6.nf <span class="at">--reads</span> <span class="st">'data/yeast/reads/*_{1,2}.fq.gz'</span> <span class="at">-resume</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 21.04.0
Launching `script6.nf` [small_franklin] - revision: 9062818659
R N A S E Q - N F   P I P E L I N E
===================================
transcriptome: data/yeast/transcriptome/Saccharomyces_cerevisiae.R64-1-1.cdna.all.fa.gz
reads        : data/yeast/reads/*_{1,2}.fq.gz
outdir       : results

executor &gt;  local (9)
[02/3742cf] process &gt; INDEX                              [100%] 1 of 1, cached: 1 ✔
[9a/be3483] process &gt; QUANT (quantification on etoh60_1) [100%] 9 of 9, cached: 9 ✔
[1f/b7b30a] process &gt; FASTQC (FASTQC on etoh60_1)        [100%] 9 of 9, cached: 1 ✔
[2c/206fef] process &gt; MULTIQC                            [100%] 1 of 1 ✔</code></pre>
</div>
<p>It creates the final report in the results folder in the
<code>${params.outdir}/multiqc</code> directory.</p>
<div class="section level3">
<h3 id="recap-5">Recap<a class="anchor" aria-label="anchor" href="#recap-5"></a>
</h3>
<p>In this step you have learned:</p>
<ul>
<li><p>How to collect many outputs to a single input with the
<code>collect</code> operator</p></li>
<li><p>How to mix two channels in a single channel using the
<code>mix</code> operator.</p></li>
<li><p>How to chain two or more operators togethers using the
<code>.</code> operator.</p></li>
</ul>
</div>
</section><section id="handle-completion-event"><h2 class="section-heading">Handle completion event<a class="anchor" aria-label="anchor" href="#handle-completion-event"></a>
</h2>
<hr class="half-width">
<p>This step shows how to execute an action when the pipeline completes
the execution.</p>
<p><strong>Note:</strong> that Nextflow processes define the execution
of asynchronous tasks i.e. they are not executed one after another as
they are written in the pipeline script as it would happen in a common
imperative programming language.</p>
<p>The script <code>script7..nf</code> uses the
<code>workflow.onComplete</code> event handler to print a confirmation
message when the script completes.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">GROOVY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode groovy" tabindex="0"><code class="sourceCode groovy"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>workflow<span class="op">.</span><span class="fu">onComplete</span> <span class="op">{</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>	log<span class="op">.</span><span class="fu">info</span> <span class="op">(</span> workflow<span class="op">.</span>success <span class="op">?</span> <span class="st">"</span><span class="sc">\n</span><span class="st">Done! Open the following report in your browser --&gt; </span><span class="ss">$params</span><span class="op">.</span><span class="ss">outdir</span><span class="st">/multiqc/multiqc_report.html</span><span class="sc">\n</span><span class="st">"</span> <span class="op">:</span> <span class="st">"Oops .. something went wrong"</span> <span class="op">)</span></span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
<p>This code uses the ternary operator that is a shortcut expression
that is equivalent to an if/else branch assigning some value to a
variable.</p>
<pre class="source"><code>If expression is true? "set value to a" : "else set value to b"</code></pre>
<p>Try to run it by using the following command:</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script7.nf <span class="at">-resume</span> <span class="at">--reads</span> <span class="st">'data/yeast/reads/*_{1,2}.fq.gz'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[..truncated..]
Done! Open the following report in your browser --&gt; results/multiqc/multiqc_report.html</code></pre>
</div>
</section><section id="metrics-and-reports"><h2 class="section-heading">Metrics and reports<a class="anchor" aria-label="anchor" href="#metrics-and-reports"></a>
</h2>
<hr class="half-width">
<p>Nextflow is able to produce multiple reports and charts providing
several runtime metrics and execution information.</p>
<ul>
<li><p>The <code>-with-report</code> option enables the creation of the
workflow execution report.</p></li>
<li><p>The <code>-with-trace</code> option enables the create of a tab
separated file containing runtime information for each executed task,
including: submission time, start time, completion time, cpu and memory
used..</p></li>
<li><p>The <code>-with-timeline</code> option enables the creation of
the workflow timeline report showing how processes where executed along
time. This may be useful to identify most time consuming tasks and
bottlenecks. See an example at this <a href="https://www.nextflow.io/docs/latest/tracing.html#timeline-report" class="external-link">link</a>.</p></li>
<li><p>The <code>-with-dag</code> option enables to rendering of the
workflow execution direct acyclic graph representation.
<strong>Note:</strong> this feature requires the installation of <a href="https://graphviz.org/" class="external-link">Graphviz</a>, an open source graph
visualization software, in your system.</p></li>
</ul>
<p>More information can be found <a href="https://www.nextflow.io/docs/latest/tracing.html" class="external-link">here</a>.</p>
<div id="metrics-and-reports-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="metrics-and-reports-1" class="callout-inner">
<h3 class="callout-title">Metrics and reports<a class="anchor" aria-label="anchor" href="#metrics-and-reports-1"></a>
</h3>
<div class="callout-content">
<p>Run the script7.nf with the reporting options as shown below:</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="ex">$</span> nextflow run script7.nf <span class="at">-resume</span> <span class="at">-with-report</span> <span class="at">-with-trace</span> <span class="at">-with-timeline</span> <span class="at">-with-dag</span> dag.png</span></code></pre>
</div>
<ol style="list-style-type: decimal">
<li>Open the file <code>report.html</code> with a browser to see the
report created with the above command.</li>
<li>Check the content of the file <code>trace.txt</code> or view
<code>timeline.html</code> to find the longest running process.</li>
<li>View the dag.png</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9">Show me the solution</h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" data-bs-parent="#accordionSolution9" aria-labelledby="headingSolution9">
<div class="accordion-body">
<p>The <code>INDEX</code> process should be the longest running process.
dag.png <img src="fig/dag.png" alt="dag" class="figure"> The vertices in the graph
represent the pipeline’s processes and operators, while the edges
represent the data connections (i.e. channels) between them.</p>
</div>
</div>
</div>
</div>
<div id="short-running-tasks" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="short-running-tasks" class="callout-inner">
<h3 class="callout-title">short running tasks<a class="anchor" aria-label="anchor" href="#short-running-tasks"></a>
</h3>
<div class="callout-content">
<p>Note: runtime metrics may be incomplete for run short running
tasks..</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Nextflow can combined tasks (processes) and manage data flows using
channels into a single pipeline/workflow.</li>
<li>A Workflow can be parameterise using <code>params</code> . These
value of the parameters can be captured in a log file using
<code>log.info</code>
</li>
<li>Nextflow can handle a workflow’s software requirements using several
technologies including the <code>conda</code> package and enviroment
manager.</li>
<li>Workflow steps are connected via their <code>inputs</code> and
<code>outputs</code> using <code>Channels</code>.</li>
<li>Intermediate pipeline results can be transformed using Channel
<code>operators</code> such as <code>combine</code>.</li>
<li>Nextflow can execute an action when the pipeline completes the
execution using the <code>workflow.onComplete</code> event handler to
print a confirmation message.</li>
<li>Nextflow is able to produce multiple reports and charts providing
several runtime metrics and execution information using the command line
options <code>-with-report</code>, <code>-with-trace</code>,
<code>-with-timeline</code> and produce a graph using
<code>-with-dag</code>.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-12-nfcore"><p>Content from <a href="12-nfcore.html">Deploying nf-core pipelines</a></p>
<hr>
<p>Last updated on 2024-05-31 |
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/episodes/12-nfcore.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Where can I find best-practice Nextflow bioinformatic
pipelines?</li>
<li>How do I run nf-core pipelines?</li>
<li>How do I configure nf-core pipelines to use my data?</li>
<li>How do I reference nf-core pipelines?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand what nf-core is and how it relates to Nextflow.</li>
<li>Use the nf-core helper tool to find nf-core pipelines.</li>
<li>Understand how to configuration nf-core pipelines.</li>
<li>Run a small nf-core pipeline using a test dataset.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="what-is-nf-core">What is nf-core?<a class="anchor" aria-label="anchor" href="#what-is-nf-core"></a>
</h3>
<p>nf-core is a community-led project to develop a set of best-practice
pipelines built using Nextflow workflow management system. Pipelines are
governed by a set of guidelines, enforced by community code reviews and
automatic code testing.</p>
<figure><img src="fig/nf-core.png" title="nf-core" alt="A diagram showcasing the key aspects of nf-core, a community effort to provide best-practice analysis pipelines. The diagram is divided into three sections: Deploy, Participate, and Develop. The Deploy section includes features like Stable pipelines, Centralized configs, List and update pipelines, and Download for offline use. The Participate section highlights Documentation, Slack workspace, Twitter updates, and Hackathons. The Develop section emphasizes the Starter template, Code guidelines, CI code linting and tests, and Helper tools." class="figure mx-auto d-block"><div class="figcaption">A diagram showcasing the key aspects of nf-core,
a community effort to provide best-practice analysis pipelines. The
diagram is divided into three sections: Deploy, Participate, and
Develop. The Deploy section includes features like Stable pipelines,
Centralized configs, List and update pipelines, and Download for offline
use. The Participate section highlights Documentation, Slack workspace,
Twitter updates, and Hackathons. The Develop section emphasizes the
Starter template, Code guidelines, CI code linting and tests, and Helper
tools.</div>
</figure><p>In this episode we will covering finding, deploying and configuring
nf-core pipelines.</p>
</div>
<div class="section level3">
<h3 id="what-are-nf-core-pipelines">What are nf-core pipelines?<a class="anchor" aria-label="anchor" href="#what-are-nf-core-pipelines"></a>
</h3>
<p>nf-core pipelines are an organised collection of Nextflow scripts,
other non-nextflow scripts (written in any language), configuration
files, software specifications, and documentation hosted on <a href="https://github.com/nf-core" class="external-link">GitHub</a>. There is generally a
single pipeline for a given data and analysis type e.g. There is a
single pipeline for bulk RNA-Seq. All nf-core pipelines are distributed
under the, permissive free software, <a href="https://en.wikipedia.org/wiki/MIT_License" class="external-link">MIT licences</a>.</p>
</div>
<div class="section level3">
<h3 id="what-is-nf-core-tools">What is nf-core tools?<a class="anchor" aria-label="anchor" href="#what-is-nf-core-tools"></a>
</h3>
<p>nf-core provides a suite of helper tools aim to help people run and
develop pipelines. The <a href="https://nf-co.re/tools" class="external-link">nf-core
tools</a> package is written in Python and can run from the command line
or imported and used within other packages.</p>
<div id="automatic-version-check" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="automatic-version-check" class="callout-inner">
<h3 class="callout-title">Automatic version check<a class="anchor" aria-label="anchor" href="#automatic-version-check"></a>
</h3>
<div class="callout-content">
<p>nf-core/tools automatically checks the web to see if there is a new
version of nf-core/tools available. If you would prefer to skip this
check, set the environment variable NFCORE_NO_VERSION_CHECK. For
example:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">export</span> <span class="va">NFCORE_NO_VERSION_CHECK</span><span class="op">=</span>1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="nf-core-tools-sub-commands">nf-core tools sub-commands<a class="anchor" aria-label="anchor" href="#nf-core-tools-sub-commands"></a>
</h4>
<p>You can use the <code>--help</code> option to see the range of
nf-core tools sub-commands. In this episode we will be covering the
<code>list</code>, <code>launch</code> and <code>download</code>
sub-commands which aid in the finding and deployment of the nf-core
pipelines.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> nf-core <span class="at">--help</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                                          ,--./,-.
          ___     __   __   __   ___     /,-._.--~\
    |\ | |__  __ /  ` /  \ |__) |__         }  {
    | \| |       \__, \__/ |  \ |___     \`-._,-`-,
                                          `._,._,'

    nf-core/tools version 2.1



Usage: nf-core [OPTIONS] COMMAND [ARGS]...

Options:
  --version                  Show the version and exit.
  -v, --verbose              Print verbose output to the console.
  -l, --log-file &lt;filename&gt;  Save a verbose log to a file.
  --help                     Show this message and exit.

Commands:
  list          List available nf-core pipelines with local info.
  launch        Launch a pipeline using a web GUI or command line prompts.
  download      Download a pipeline, nf-core/configs and pipeline...
  licences      List software licences for a given workflow.
  create        Create a new pipeline using the nf-core template.
  lint          Check pipeline code against nf-core guidelines.
  modules       Tools to manage Nextflow DSL2 modules as hosted on...
  schema        Suite of tools for developers to manage pipeline schema.
  bump-version  Update nf-core pipeline version number.
  sync          Sync a pipeline TEMPLATE branch with the nf-core template.</code></pre>
</div>
</div>
</div>
<div class="section level3">
<h3 id="listing-available-nf-core-pipelines">Listing available nf-core pipelines<a class="anchor" aria-label="anchor" href="#listing-available-nf-core-pipelines"></a>
</h3>
<p>The simplest sub-command is <code>nf-core list</code>, which lists
all available nf-core pipelines in the nf-core Github repository.</p>
<p>The output shows the latest version number and when that was
released. If the pipeline has been pulled locally using Nextflow, it
tells you when that was and whether you have the latest version.</p>
<p>Run the command below.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> nf-core list</span></code></pre>
</div>
<p>An example of the output from the command is as follows:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>

                                          ,--./,-.
          ___     __   __   __   ___     /,-._.--~\
    |\ | |__  __ /  ` /  \ |__) |__         }  {
    | \| |       \__, \__/ |  \ |___     \`-._,-`-,
                                          `._,._,'

    nf-core/tools version 2.1



    ┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓
    ┃ Pipeline Name     ┃ Stars ┃ Latest Release ┃      Released ┃ Last Pulled ┃ Have latest release? ┃
    ┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩
    │ mhcquant          │    14 │          2.0.0 │    4 days ago │           - │ -                    │
    │ bacass            │    28 │          2.0.0 │   2 weeks ago │           - │ -                    │
    │ viralrecon        │    48 │            2.2 │  1 months ago │           - │ -                    │
    │ rnaseq            │   364 │            3.3 │  1 months ago │           - │ -                    │
    │ mag               │    63 │          2.1.0 │  1 months ago │           - │ -                    │
    │ fetchngs          │    25 │            1.2 │  1 months ago │           - │ -                    │
    │ bcellmagic        │    14 │          2.0.0 │  2 months ago │           - │ -                    │
    │ ampliseq          │    67 │          2.0.0 │  2 months ago │           - │ -                    │
[..truncated..]</code></pre>
</div>
<div class="section level4">
<h4 id="filtering-available-nf-core-pipelines">Filtering available nf-core pipelines<a class="anchor" aria-label="anchor" href="#filtering-available-nf-core-pipelines"></a>
</h4>
<p>If you supply additional keywords after the <code>list</code>
sub-command, the listed pipeline will be filtered.
<strong>Note:</strong> that this searches more than just the displayed
output, including keywords and description text.</p>
<p>Here we filter on the keywords <strong>rna</strong> and
<strong>rna-seq</strong> .</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> nf-core list rna rna-seq</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
                                          ,--./,-.
          ___     __   __   __   ___     /,-._.--~\
    |\ | |__  __ /  ` /  \ |__) |__         }  {
    | \| |       \__, \__/ |  \ |___     \`-._,-`-,
                                          `._,._,'

    nf-core/tools version 2.1



┏━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓
┃ Pipeline Name ┃ Stars ┃ Latest Release ┃     Released ┃ Last Pulled ┃ Have latest release? ┃
┡━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩
│ rnaseq        │   364 │            3.3 │ 1 months ago │           - │ -                    │
│ smrnaseq      │    26 │          1.1.0 │ 3 months ago │           - │ -                    │
│ dualrnaseq    │     4 │          1.0.0 │ 7 months ago │           - │ -                    │
│ rnafusion     │    60 │          1.2.0 │  1 years ago │           - │ -                    │
│ circrna       │     8 │            dev │            - │           - │ -                    │
│ lncpipe       │    22 │            dev │            - │           - │ -                    │
│ scflow        │     6 │            dev │            - │           - │ -                    │
└───────────────┴───────┴────────────────┴──────────────┴─────────────┴──────────────────────┘</code></pre>
</div>
</div>
<div class="section level4">
<h4 id="sorting-available-nf-core-pipelines">Sorting available nf-core pipelines<a class="anchor" aria-label="anchor" href="#sorting-available-nf-core-pipelines"></a>
</h4>
<p>You can sort the results by adding the option <code>--sort</code>
followed by a keyword. For example, latest release
(<code>--sort release</code>), when you last pulled a local copy
(<code>--sort pulled</code>), alphabetically (<code>--sort name</code>),
or number of GitHub stars (<code>--sort stars</code>).</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">nf-core</span> list rna rna-seq <span class="at">--sort</span> stars</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                                      ,--./,-.
      ___     __   __   __   ___     /,-._.--~\
|\ | |__  __ /  ` /  \ |__) |__         }  {
| \| |       \__, \__/ |  \ |___     \`-._,-`-,
                                      `._,._,'

nf-core/tools version 2.1



┏━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓
┃ Pipeline Name ┃ Stars ┃ Latest Release ┃     Released ┃ Last Pulled ┃ Have latest release? ┃
┡━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩
│ rnaseq        │   364 │            3.3 │ 1 months ago │           - │ -                    │
│ rnafusion     │    60 │          1.2.0 │  1 years ago │           - │ -                    │
│ smrnaseq      │    26 │          1.1.0 │ 3 months ago │           - │ -                    │
│ lncpipe       │    22 │            dev │            - │           - │ -                    │
│ circrna       │     8 │            dev │            - │           - │ -                    │
│ scflow        │     6 │            dev │            - │           - │ -                    │
│ dualrnaseq    │     4 │          1.0.0 │ 7 months ago │           - │ -                    │
└───────────────┴───────┴────────────────┴──────────────┴─────────────┴──────────────────────┘</code></pre>
</div>
<div id="archived-pipelines" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="archived-pipelines" class="callout-inner">
<h3 class="callout-title">Archived pipelines<a class="anchor" aria-label="anchor" href="#archived-pipelines"></a>
</h3>
<div class="callout-content">
<p>Archived pipelines are not returned by default. To include them, use
the <code>--show_archived</code> flag.</p>
</div>
</div>
</div>
<div id="exercise-listing-nf-core-pipelines" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-listing-nf-core-pipelines" class="callout-inner">
<h3 class="callout-title">Exercise: listing nf-core pipelines<a class="anchor" aria-label="anchor" href="#exercise-listing-nf-core-pipelines"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Use the <code>--help</code> flag to print the list command
usage.</li>
<li>Sort all pipelines by popularity (stars) and find out which is the
most popular?.</li>
<li>Filter pipelines for those that work with RNA and find out how many
there are?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Use the <code>--help</code> flag to print the list command usage.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> nf-core list <span class="at">--help</span></span></code></pre>
</div>
<p>Sort all pipelines by popularity (stars).</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> nf-core list <span class="at">--sort</span> stars</span></code></pre>
</div>
<p>Filter pipelines for those that work with RNA.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> nf-core list rna</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="running-nf-core-pipelines">Running nf-core pipelines<a class="anchor" aria-label="anchor" href="#running-nf-core-pipelines"></a>
</h3>
<div class="section level4">
<h4 id="software-requirements-for-nf-core-pipelines">Software requirements for nf-core pipelines<a class="anchor" aria-label="anchor" href="#software-requirements-for-nf-core-pipelines"></a>
</h4>
<p>nf-core pipeline software dependencies are specified using either
Docker, Singularity or Conda. It is Nextflow that handles the
downloading of containers and creation of conda environments. In theory
it is possible to run the pipelines with software installed by other
methods (e.g. environment modules, or manual installation), but this is
not recommended.</p>
</div>
<div class="section level4">
<h4 id="fetching-pipeline-code">Fetching pipeline code<a class="anchor" aria-label="anchor" href="#fetching-pipeline-code"></a>
</h4>
<p>Unless you are actively developing pipeline code, you should use
Nextflow’s <a href="https://www.nextflow.io/docs/latest/sharing.html" class="external-link">built-in
functionality</a> to fetch nf-core pipelines. You can use the following
command to pull the latest version of a remote workflow from the nf-core
github site.;</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> nextflow pull nf-core/<span class="op">&lt;</span>PIPELINE<span class="op">&gt;</span></span></code></pre>
</div>
<p>Nextflow will also automatically fetch the pipeline code when you
run</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> nextflow run nf-core/<span class="op">&lt;</span>pipeline<span class="op">&gt;</span><span class="kw">`</span><span class="bu">.</span></span></code></pre>
</div>
<p>For the best reproducibility, it is good to explicitly reference the
pipeline version number that you wish to use with the
<code>-revision</code>/<code>-r</code> flag.</p>
<p>In the example below we are pulling the rnaseq pipeline version
3.0</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> nextflow pull nf-core/rnaseq <span class="at">-revision</span> 3.0</span></code></pre>
</div>
<p>We can check the pipeline has been pulled using the
<code>nf-core list</code> command.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">nf-core</span> list rnaseq <span class="at">-s</span> pulled</span></code></pre>
</div>
<p>We can see from the output we have the latest release.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                                      ,--./,-.
      ___     __   __   __   ___     /,-._.--~\
|\ | |__  __ /  ` /  \ |__) |__         }  {
| \| |       \__, \__/ |  \ |___     \`-._,-`-,
                                      `._,._,'

nf-core/tools version 2.1



┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓
┃ Pipeline Name     ┃ Stars ┃ Latest Release ┃      Released ┃    Last Pulled ┃ Have latest release? ┃
┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩
│ rnaseq            │   394 │            3.4 │  4 weeks ago  │ 1 minutes ago  │ Yes (v3.4)           │
[..truncated..]</code></pre>
</div>
<div id="development-releases" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="development-releases" class="callout-inner">
<h3 class="callout-title">Development Releases<a class="anchor" aria-label="anchor" href="#development-releases"></a>
</h3>
<div class="callout-content">
<p>If not specified, Nextflow will fetch the default git branch. For
pipelines with a stable release this the default branch is
<code>master</code> - this branch contains code from the latest release.
For pipelines in early development that don’t have any releases, the
default branch is <code>dev</code>.</p>
</div>
</div>
</div>
<div id="exercise-fetch-the-latest-rna-seq-pipeline" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-fetch-the-latest-rna-seq-pipeline" class="callout-inner">
<h3 class="callout-title">Exercise: Fetch the latest RNA-Seq
pipeline<a class="anchor" aria-label="anchor" href="#exercise-fetch-the-latest-rna-seq-pipeline"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>Use the <code>nextflow pull</code> command to download the latest
<code>nf-core/rnaseq</code> pipeline</p></li>
<li><p>Use the <code>nf-core list</code> command to see if you have the
latest version of the pipeline</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Use the <code>nextflow pull</code> command to download the latest
<code>nf-core/rnaseq</code> pipeline</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">$</span> nextflow pull nf-core/rnaseq</span></code></pre>
</div>
<p>Use the <code>nf-core list</code> command to see if you have the
latest version of the pipeline</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">$</span> nf-core list rnaseq <span class="at">--sort</span> pulled</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="usage-instructions-and-documentation"><h2 class="section-heading">Usage instructions and documentation<a class="anchor" aria-label="anchor" href="#usage-instructions-and-documentation"></a>
</h2>
<hr class="half-width">
<p>You can find general documentation and instructions for Nextflow and
nf-core on the <a href="https://nf-co.re/" class="external-link">nf-core website</a> .
Pipeline-specific documentation is bundled with each pipeline in the
/docs folder. This can be read either locally, on GitHub, or on the
nf-core website.</p>
<p>Each pipeline has its own webpage at <a href="https://nf-co.re/" class="external-link">https://nf-co.re/</a>&lt;pipeline_name&gt;
e.g. <a href="https://nf-co.re/rnaseq/usage" class="external-link">nf-co.re/rnaseq</a></p>
<p>In addition to this documentation, each pipeline comes with basic
command line reference. This can be seen by running the pipeline with
the parameter <code>--help</code> , for example:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> nextflow run <span class="at">-r</span> 3.4 nf-core/rnaseq <span class="at">--help</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>N E X T F L O W  ~  version 20.10.0
Launching `nf-core/rnaseq` [silly_miescher] - revision: 964425e3fd [3.4]
------------------------------------------------------
                                        ,--./,-.
        ___     __   __   __   ___     /,-._.--~'
  |\ | |__  __ /  ` /  \ |__) |__         }  {
  | \| |       \__, \__/ |  \ |___     \`-._,-`-,
                                        `._,._,'
  nf-core/rnaseq v3.0
------------------------------------------------------

Typical pipeline command:

    nextflow run nf-core/rnaseq --input samplesheet.csv --genome GRCh37 -profile docker

Input/output options
    --input                             [string]  Path to comma-separated file containing information about the samples in the experiment.
    --outdir                            [string]  Path to the output directory where the results will be saved.
    --public_data_ids                   [string]  File containing SRA/ENA/GEO identifiers one per line in order to download their associated FastQ files.
    --email                             [string]  Email address for completion summary.
    --multiqc_title                     [string]  MultiQC report title. Printed as page header, used for filename if not otherwise specified.
    --skip_sra_fastq_download           [boolean] Only download metadata for public data database ids and don't download the FastQ files.
    --save_merged_fastq                 [boolean] Save FastQ files after merging re-sequenced libraries in the results directory.
..truncated..</code></pre>
</div>
<div class="section level3">
<h3 id="the-nf-core-launch-command">The nf-core launch command<a class="anchor" aria-label="anchor" href="#the-nf-core-launch-command"></a>
</h3>
<p>As can be seen from the output of the help option nf-core pipelines
have a number of flags that need to be passed on the command line: some
mandatory, some optional.</p>
<p>To make it easier to launch pipelines, these parameters are described
in a JSON file, <code>nextflow_schema.json</code> bundled with the
pipeline.</p>
<p>The <code>nf-core launch</code> command uses this to build an
interactive command-line wizard which walks through the different
options with descriptions of each, showing the default value and
prompting for values.</p>
<p>Once all prompts have been answered, non-default values are saved to
a <code>params.json</code> file which can be supplied to Nextflow using
the <code>-params-file</code> option. Optionally, the Nextflow command
can be launched there and then.</p>
<p>To use the launch feature, just specify the pipeline name:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">$</span> nf-core launch <span class="at">-r</span> 3.0 rnaseq</span></code></pre>
</div>
<div id="exercise-create-nf-core-params-file" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-create-nf-core-params-file" class="callout-inner">
<h3 class="callout-title">Exercise : Create nf-core params file<a class="anchor" aria-label="anchor" href="#exercise-create-nf-core-params-file"></a>
</h3>
<div class="callout-content">
<p>Use the <code>nf-core launch</code> command to create a params file
named <code>nf-params.json</code>.</p>
<ol style="list-style-type: decimal">
<li>Use the <code>nf-core launch</code> command to launch the
interactive command-line wizard.</li>
<li>Add an input file name <code>samples.csv</code>
</li>
<li>Add a genome <code>GRCh38</code> ** Note ** : Do not run the command
now.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">$</span> nf-core launch rnaseq</span></code></pre>
</div>
<p>The contents of the <code>nf-params.json</code> file should be</p>
<pre><code>{
  "input": "samples.csv",
  "genome": "GRCh38"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="config-files">Config files<a class="anchor" aria-label="anchor" href="#config-files"></a>
</h3>
<p>nf-core pipelines make use of Nextflow’s configuration files to
specify how the pipelines runs, define custom parameters and what
software management system to use e.g. docker, singularity or conda.</p>
<p>Nextflow can load pipeline configurations from multiple locations.
nf-core pipelines load configuration in the following order:</p>
<figure><img src="fig/nfcore_config.png" title="config" alt="A diagram explaining the structure and hierarchy of nextflow.config files. The diagram shows that the default ‘base’ config is always loaded. It also includes core profiles, such as docker, conda, and test, and server profiles from nf-core/config. Additionally, it highlights that your local config files, located in $HOME/.nextflow/config or specified with -c custom.config, are also considered." class="figure mx-auto d-block"><div class="figcaption">A diagram explaining the structure and hierarchy
of nextflow.config files. The diagram shows that the default ‘base’
config is always loaded. It also includes core profiles, such as docker,
conda, and test, and server profiles from nf-core/config. Additionally,
it highlights that your local config files, located in
$HOME/.nextflow/config or specified with -c custom.config, are also
considered.</div>
</figure><ol style="list-style-type: decimal">
<li>Pipeline: Default ‘base’ config</li>
</ol>
<ul>
<li>Always loaded. Contains pipeline-specific parameters and “sensible
defaults” for things like computational requirements</li>
<li>Does not specify any method for software packaging. If nothing else
is specified, Nextflow will expect all software to be available on the
command line.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Core config profiles</li>
</ol>
<ul>
<li>All nf-core pipelines come with some generic config profiles. The
most commonly used ones are for software packaging: docker, singularity
and conda</li>
<li>Other core profiles are debug and two test profiles. There two test
profile, a small test profile (nf-core/test-datasets) for quick test and
a full test profile which provides the path to full sized data from
public repositories.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Server profiles</li>
</ol>
<ul>
<li>At run time, nf-core pipelines fetch configuration profiles from the
<a href="https://github.com/nf-core/configs" class="external-link">configs remote
repository</a>. The profiles here are specific to clusters at different
institutions.</li>
<li>Because this is loaded at run time, anyone can add a profile here
for their system and it will be immediately available for all nf-core
pipelines.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Local config files given to Nextflow with the <code>-c</code>
flag</li>
</ol>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">$</span> nextflow run nf-core/rnaseq <span class="at">-r</span> 3.0 <span class="at">-c</span> mylocal.config</span></code></pre>
</div>
<p>5. Command line configuration: pipeline parameters can be passed on
the command line using the <code>--&lt;parameter&gt;</code> syntax.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">$</span> nextflow run nf-core/rnaseq <span class="at">-r</span> 3.0 <span class="at">--email</span> <span class="st">"my@email.com"</span><span class="kw">`</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="config-profiles">Config Profiles<a class="anchor" aria-label="anchor" href="#config-profiles"></a>
</h4>
<p>nf-core makes use of Nextflow configuration <code>profiles</code> to
make it easy to apply a group of options on the command line.</p>
<p>Configuration files can contain the definition of one or more
profiles. A profile is a set of configuration attributes that can be
activated/chosen when launching a pipeline execution by using the
<code>-profile</code> command line option. Common profiles are
<code>conda</code>, <code>singularity</code> and <code>docker</code>
that specify which software manager to use.</p>
<p>Multiple profiles are comma-separated. When there are differing
configuration settings provided by different profiles, the right-most
profile takes priority.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">$</span> nextflow run nf-core/rnaseq <span class="at">-r</span> 3.0 <span class="at">-profile</span> test,conda</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="ex">$</span> nextflow run nf-core/rnaseq <span class="at">-r</span> 3.0 <span class="at">-profile</span> <span class="op">&lt;</span>institutional_config_profile<span class="op">&gt;</span>, test, conda</span></code></pre>
</div>
<p><strong>Note</strong> The order in which config profiles are
specified matters. Their priority increases from left to right.</p>
<div id="multiple-nextflow-configuration-locations" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="multiple-nextflow-configuration-locations" class="callout-inner">
<h3 class="callout-title">Multiple Nextflow configuration locations<a class="anchor" aria-label="anchor" href="#multiple-nextflow-configuration-locations"></a>
</h3>
<div class="callout-content">
<p>Be clever with multiple Nextflow configuration locations. For
example, use <code>-profile</code> for your cluster configuration, the
file <code>$HOME/.nextflow/config</code> for your personal config such
as <code>params.email</code> and a working directory
&gt;<code>nextflow.config</code> file for reproducible run-specific
configuration.</p>
</div>
</div>
</div>
<div id="exercise-create-a-custom-config" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-create-a-custom-config" class="callout-inner">
<h3 class="callout-title">Exercise create a custom config<a class="anchor" aria-label="anchor" href="#exercise-create-a-custom-config"></a>
</h3>
<div class="callout-content">
<p>Add the <code>params.email</code> to a file called
<code>nfcore-custom.config</code></p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>A line similar to one below in the file custom.config</p>
<pre><code><span><span class="va">params.email</span> <span class="op">=</span> <span class="st">"myemail@address.com"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="running-pipelines-with-test-data"><h2 class="section-heading">Running pipelines with test data<a class="anchor" aria-label="anchor" href="#running-pipelines-with-test-data"></a>
</h2>
<hr class="half-width">
<p>The nf-core config profile <code>test</code> is special profile,
which defines a minimal data set and configuration, that runs quickly
and tests the workflow from beginning to end. Since the data is minimal,
the output is often nonsense. Real world example output are instead
linked on the nf-core pipeline web page, where the workflow has been run
with a full size data set:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">$</span> nextflow run nf-core/<span class="op">&lt;</span>pipeline_name<span class="op">&gt;</span> -profile test</span></code></pre>
</div>
<div id="software-configuration-profile" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="software-configuration-profile" class="callout-inner">
<h3 class="callout-title">Software configuration profile<a class="anchor" aria-label="anchor" href="#software-configuration-profile"></a>
</h3>
<div class="callout-content">
<p>Note that you will typically still need to combine this with a
software configuration profile for your system - e.g.
<code>-profile test,conda</code>. Running with the test profile is a
great way to confirm that you have Nextflow configured properly for your
system before attempting to run with real data</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="using-nf-core-pipelines-offline">Using nf-core pipelines offline<a class="anchor" aria-label="anchor" href="#using-nf-core-pipelines-offline"></a>
</h3>
<p>Many of the techniques and resources described above require an
active internet connection at run time - pipeline files, configuration
profiles and software containers are all dynamically fetched when the
pipeline is launched. This can be a problem for people using secure
computing resources that do not have connections to the internet.</p>
<p>To help with this, the <code>nf-core download</code> command
automates the fetching of required files for running nf-core pipelines
offline. The command can download a specific release of a pipeline with
<code>-r</code>/<code>--release</code> .<br>
By default, the pipeline will download the pipeline code and the
institutional nf-core/configs files.</p>
<p>If you specify the flag <code>--singularity</code>, it will also
download any singularity image files that are required (this needs
Singularity to be installed). All files are saved to a single directory,
ready to be transferred to the cluster where the pipeline will be
executed.</p>
<pre><code>$ nf-core download nf-core/rnaseq -r 3.4</code></pre>
<blockquote>

</blockquote>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>                                          <span class="ex">,--./,-.</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>          <span class="ex">___</span>     __   __   __   ___     /,-._.--~<span class="dt">\</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    <span class="kw">|</span><span class="ex">\ </span><span class="kw">|</span> <span class="kw">|</span><span class="ex">__</span>  __ /  <span class="kw">`</span> <span class="ex">/</span>  <span class="dt">\ </span><span class="kw">|</span><span class="ex">__</span><span class="er">)</span> <span class="kw">|</span><span class="ex">__</span>         }  {</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>    <span class="kw">|</span> <span class="ex">\|</span> <span class="kw">|</span>       <span class="ex">\__,</span> <span class="dt">\_</span>_/ <span class="kw">|</span>  <span class="ex">\ </span><span class="kw">|</span><span class="ex">___</span>     <span class="dt">\`</span>-._,-<span class="kw">`</span><span class="at">-,</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>                                          <span class="kw">`</span><span class="ex">._,._,</span><span class="st">'</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="st">    nf-core/tools version 2.1</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="st">INFO     Saving nf-core/rnaseq                                                                                                                                                                                                                                         download.py:148</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="st">          Pipeline release: '</span><span class="ex">3.4</span><span class="st">'</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="st">          Pull singularity containers: '</span><span class="ex">No</span><span class="st">'</span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="st">          Output file: '</span><span class="ex">nf-core-rnaseq-3.4.tar.gz</span><span class="st">'</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a><span class="st">INFO     Downloading workflow files from GitHub                                                                                                                                                                                                                        download.py:151</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a><span class="st">INFO     Downloading centralised configs from GitHub                                                                                                                                                                                                                   download.py:155</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="st">INFO     Compressing download..                                                                                                                                                                                                                                        download.py:166</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a><span class="st">INFO     Command to extract files: tar -xzf nf-core-rnaseq-3.4.tar.gz                                                                                                                                                                                                  download.py:653</span></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a><span class="st">INFO     MD5 checksum for nf-core-rnaseq-3.4.tar.gz: f0e0c239bdb39c613d6a080f1dee88e9</span></span></code></pre>
</div>
<div id="exercise-run-a-test-nf-core-pipeline" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-run-a-test-nf-core-pipeline" class="callout-inner">
<h3 class="callout-title">Exercise Run a test nf-core pipeline<a class="anchor" aria-label="anchor" href="#exercise-run-a-test-nf-core-pipeline"></a>
</h3>
<div class="callout-content">
<p>Run the nf-core/hlatyping pipeline release 1.2.0 with the provided
test data using the profile <code>test</code> and <code>conda</code>.
Add the parameter <code>--max_memory 3G</code> on the command line.
Include the config file, <code>nfcore-custom.config</code>, from the
previous exercise using the option <code>-c</code>, to send an email
when your pipeline finishes.</p>
<pre><code>$ nextflow run nf-core/hlatyping -r 1.2.0 -profile test,conda  --max_memory 3G -c nfcore-custom.config</code></pre>
<p>The pipeline does next-generation sequencing-based Human Leukozyte
Antigen (HLA) typing and should run quickly.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> N E X T F L O W  ~  version 21.04.0
Launching `nf-core/hlatyping` [pedantic_engelbart] - revision: 6998794795 [1.2.0]
BAM file format detected. Initiate remapping to HLA alleles with yara mapper.
----------------------------------------------------
                                       ,--./,-.
       ___     __   __   __   ___     /,-._.--~'
 |\ | |__  __ /  ` /  \ |__) |__         }  {
 | \| |       \__, \__/ |  \ |___     \`-._,-`-,
                                       `._,._,'
nf-core/hlatyping v1.2.0
----------------------------------------------------

Pipeline Release  : 1.2.0
Run Name          : pedantic_engelbart
File Type         : BAM
Seq Type          : dna
Index Location    : /home/training/.nextflow/assets/nf-core/hlatyping/data/indices/yara/hla_reference_dna
IP Solver         : glpk
Enumerations      : 1
Beta              : 0.009
Max Memory        : 3G
Max CPUs          : 2
Max Time          : 2d
Input             : https://github.com/nf-core/test-datasets/raw/hlatyping/bam/example_pe.bam
Data Type         : Paired-End
Output Dir        : results
Launch Dir        : /home/training
Working Dir       : /home/training/work
Script Dir        : /home/training/.nextflow/assets/nf-core/hlatyping
User              : training
Max Resources     : 3G memory, 2 cpus, 2d time per job
Config Profile    : conda,test
Config Profile Description: Minimal test dataset to check pipeline function
Config Files      : /home/training/.nextflow/assets/nf-core/hlatyping/nextflow.config, /home/training/nextflow.config, /home/training/.nextflow/assets/nf-&gt; &gt; &gt; &gt;core/hlatyping/nextflow.config
----------------------------------------------------
BAM file format detected. Initiate remapping to HLA alleles with yara mapper.
[-        ] process &gt; remap_to_hla          -
executor &gt;  local (6)
[05/084b41] process &gt; remap_to_hla (1)      [100%] 1 of 1 ✔
[5a/9bec8b] process &gt; make_ot_config        [100%] 1 of 1 ✔
[54/8bc5d7] process &gt; run_optitype (1)      [100%] 1 of 1 ✔
[a9/2cbea8] process &gt; output_documentation  [100%] 1 of 1 ✔
[df/d3dac5] process &gt; get_software_versions [100%] 1 of 1 ✔
[e1/903ed9] process &gt; multiqc (1)           [100%] 1 of 1 ✔
-[nf-core/hlatyping] Pipeline completed successfully-
WARN: To render the execution DAG in the required format it is required to install Graphviz -- See http://www.graphviz.org for more info.
Completed at: 26-Oct-2021 10:07:27
Duration    : 4m 14s
CPU hours   : (a few seconds)
Succeeded   : 6</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h3>
<p>If you run into issues running your pipeline you can you the nf-core
website to troubleshoot common mistakes and issues <a href="https://nf-co.re/usage/troubleshooting" class="external-link">https://nf-co.re/usage/troubleshooting</a>
.</p>
<div class="section level4">
<h4 id="extra-resources-and-getting-help">Extra resources and getting help<a class="anchor" aria-label="anchor" href="#extra-resources-and-getting-help"></a>
</h4>
<p>If you still have an issue with running the pipeline then feel free
to contact the nf-core community via the Slack channel . The nf-core
Slack organisation has channels dedicated for each pipeline, as well as
specific topics (eg. <code>#help</code>, <code>#pipelines</code>,
<code>#tools</code>, <code>#configs</code> and much more). The nf-core
Slack can be found at <a href="https://nfcore.slack.com" class="external-link">https://nfcore.slack.com</a> (NB: no
hyphen in nfcore!). To join you will need an invite, which you can get
at <a href="https://nf-co.re/join/slack" class="external-link">https://nf-co.re/join/slack</a>.</p>
<p>You can also get help by opening an issue in the respective pipeline
repository on GitHub asking for help.</p>
<p>If you have problems that are directly related to Nextflow and not
our pipelines or the nf-core framework tools then check out the <a href="https://gitter.im/nextflow-io/nextflow" class="external-link">Nextflow gitter
channel</a> or the <a href="https://groups.google.com/forum/#!forum/nextflow" class="external-link">google
group</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="referencing-a-pipeline">Referencing a Pipeline<a class="anchor" aria-label="anchor" href="#referencing-a-pipeline"></a>
</h3>
<div class="section level4">
<h4 id="publications">Publications<a class="anchor" aria-label="anchor" href="#publications"></a>
</h4>
<p>If you use an nf-core pipeline in your work you should cite the main
publication for the main nf-core paper, describing the community and
framework, as follows:</p>
<blockquote>
<p><strong>The nf-core framework for community-curated bioinformatics
pipelines.</strong> Philip Ewels, Alexander Peltzer, Sven Fillinger,
Harshil Patel, Johannes Alneberg, Andreas Wilm, Maxime Ulysse Garcia,
Paolo Di Tommaso &amp; Sven Nahnsen. Nat Biotechnol. 2020 Feb 13. doi:
<a href="https://dx.doi.org/10.1038/s41587-020-0439-x" class="external-link">10.1038/s41587-020-0439-x</a>.
ReadCube: <a href="https://rdcu.be/b1GjZ" class="external-link">Full Access Link</a></p>
</blockquote>
<p>Many of the pipelines have a publication listed on the nf-core
website that can be found <a href="https://nf-co.re/publications" class="external-link">here</a>.</p>
</div>
<div class="section level4">
<h4 id="dois">DOIs<a class="anchor" aria-label="anchor" href="#dois"></a>
</h4>
<p>In addition, each release of an nf-core pipeline has a digital object
identifiers (DOIs) for easy referencing in literature The DOIs are
generated by Zenodo from the pipeline’s github repository.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>nf-core is a community-led project to develop a set of best-practice
pipelines built using the Nextflow workflow management system.</li>
<li>The nf-core tool (<code>nf-core</code>) is a suite of helper tools
that aims to help people run and develop nf-core pipelines.</li>
<li>nf-core pipelines can be found using <code>nf-core list</code>, or
by checking the nf-core website.</li>
<li>
<code>nf-core launch nf-core/&lt;pipeline&gt;</code> can be used to
write a parameter file for an nf-core pipeline. This can be supplied to
the pipeline using the <code>-params-file</code> option.</li>
<li>An nf-core workflow is run using
<code>nextflow run nf-core/&lt;pipeline&gt;</code> syntax.</li>
<li>nf-core pipelines can be reconfigured by using custom config files
and/or adding command line parameters.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries-incubator/workflows-nextflow/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/carpentries-incubator/workflows-nextflow/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/workflows-nextflow/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/workflows-nextflow/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:graeme.grimes@igmm.ed.ac.uk&amp;amp;quot;">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.4" class="external-link">sandpaper (0.16.4)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.5" class="external-link">pegboard (0.7.5)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.2" class="external-link">varnish (1.0.2)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/workflows-nextflow/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/workflows-nextflow/aio.html",
  "identifier": "https://carpentries-incubator.github.io/workflows-nextflow/aio.html",
  "dateCreated": "2021-02-01",
  "dateModified": "2024-05-31",
  "datePublished": "2024-05-31"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

